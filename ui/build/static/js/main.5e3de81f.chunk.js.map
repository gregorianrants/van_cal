{"version":3,"sources":["utilities/timeConversions.js","../../api/model/job.js","Layout/LeftDrawer.js","features/auth/auth0.js","features/api/apiSlice.js","features/errors/errorsSlice.js","features/errors/Error.js","features/errors/ErrorHandler.js","features/auth/PrivateRoute.js","features/Calendar/Contexts.js","utilities/dateUtilities.js","features/Calendar/DayLabels.js","features/Calendar/HourTicks.js","features/Calendar/Header.js","Model/gcalEvents.js","features/Calendar/calendarSlice.js","utilities/utilities.js","features/Calendar/EventHeading.js","features/Calendar/Event.js","features/Calendar/useDetectBottomEdge.js","features/Calendar/useDrag.js","features/Calendar/gcalEvent.js","eventGeometry/groupEvents.js","eventGeometry/eventGeometry.js","utilities/batchProcess.js","features/Calendar/Events.js","features/Calendar/Hours.js","features/Calendar/Calendar.js","components/Modal.js","features/jobDetails/JobDetails.js","features/Calendar/GcalDetails.js","features/forms/AddressInput.js","utilities/processMongooseError.js","features/forms/JobForm.js","features/forms/EditJobForm.js","features/forms/CreateJobForm.js","Model/user.js","features/googleCalendar/gcalApi.js","features/auth/authSlice.js","features/auth/Auth.js","features/googleCalendar/AuthorizeGcalButton.js","features/auth/LoginPage.js","features/googleCalendar/Oauthcallback.js","Layout/Content.js","features/auth/AuthenticationButton.js","Layout/TopBar.js","App.js","reportWebVitals.js","app/store.js","index.js"],"names":["require","setHours","setMinutes","module","exports","asDecimal","dateTime","value","places","hours","getHours","fractionOfHour","getMinutes","Math","floor","getTimeFromPosition","position","height","minutes","Date","mongoose","cuid","validator","customerObj","nextDay","name","type","String","required","validate","v","length","message","mobile","isMobilePhone","email","isEmail","customerSchema","Schema","chargesObj","hourlyRate","Number","fuelCharge","travelTime","chargesSchema","addressObj","_id","default","addressSchema","operativeObj","operativeSchema","jobSchema","start","end","customer","charges","items","addresses","operatives","markCompleted","Boolean","sub","Job","model","getPagination","skip","limit","count","from","to","min","of","filter","$gte","$lte","query","find","countDocuments","console","log","pagination","data","job","save","get","id","findById","deleteOne","change","Object","keys","forEach","key","deleteMany","insertMany","list","create","remove","resetData","edit","useStyles","makeStyles","theme","root","display","appBar","zIndex","drawer","width","flexShrink","drawerPaper","drawerContainer","overflow","content","flexGrow","padding","spacing","wrapper","LeftDrawer","classes","Drawer","className","variant","paper","Toolbar","List","ListItem","component","Link","ListItemIcon","ListItemText","createAuth0Client","domain","process","client_id","audience","apiSlice","createApi","reducerPath","baseQuery","fetchBaseQuery","baseUrl","prepareHeaders","headers","a","getState","token","auth","set","tagTypes","endpoints","builder","getJobs","transformResponse","response","providesTags","result","r","map","editJob","mutation","url","method","body","invalidatesTags","error","arg","getJob","addJob","getGcal","gcalEvent","reshape","useGetJobsQuery","useGetJobQuery","useEditJobMutation","useAddJobMutation","useGetGcalQuery","usePrefetch","errorsSlice","createSlice","initialState","status","statusCode","reducers","clearErrors","state","action","extraReducers","addMatcher","matchRejected","payload","actions","Error","code","useSelector","errors","history","useHistory","location","useLocation","dispatch","useDispatch","onClick","push","ErrorHandler","children","rest","isError","render","pathname","PrivateRoute","isAuthenticated","SettingsContext","React","createContext","addDays","format","nextMonday","isSameDay","weekContaining","date","difference","day","sundayIndexed","getDay","weekIndex","diff","monthAndYear","mergeDateAndTime","time","setTimeDayStart","setTimeDayEnd","defaultExports","dayOfWeek","previousMonday","fitsInWeek","firstDayOfWeek","endOfWeek","startOfDay","endOfDay","DayLabelsStyled","styled","div","DayLabels","days","i","du","getDate","HourTicksStyled","TickValuesStyled","TickLinesStyled","TickValues","useContext","settingsContext","borderWidth","hourHeight","Array","index","TickLines","border","HourTicks","headerHeight","Header","currentDate","incrementWeek","decrementWeek","Button","ArrowBack","Typography","ArrowForward","getWeek","increment","firstDay","lastDay","toISOString","events","gcalEvents","scrollPosition","calendarSlice","dataLoaded","gcalDataLoaded","idToChange","findIndex","event","cloneDeep","createJob","updateScrollPositions","incrementWeekThunk","decrementWeekThunk","calendarSelectors","parseISO","calendar","fromTop","fromBottom","containerHeight","roundToNearest","inputValue","nearest","round","StyledSummaryText","p","TimeText","EventHeading","summary","StyledEvent","props","backgroundColor","overEdge","Event","topProp","top","bottomProp","bottom","left","right","useState","setTop","setBottom","isLoading","useEffect","setOverEdge","isCursorOverEdgeState","handleMouseMove","e","bottomOfEl","target","getBoundingClientRect","pointerY","clientY","handleMouseLeave","useDetectBottomEdge","startTime","endTime","eventHeight","useRef","initialTop","initialBottom","drag","onDragStart","dragElementF","dragBottomEdgeF","mouseUpF","setDrag","totalTranslationY","handleDragElement","useCallback","current","movementY","handleDragBottomEdge","handleMouseUp","window","addEventListener","removeEventListener","preventDefault","useDrag","translationY","tracked","snappedTop","trackedBottom","snappedBottom","onMouseDown","onMouseMove","onMouseLeave","draggable","style","GcalEvent","updateEvent","updateDisplayEvent","idGenerator","asPeriod","reduce","b","getStart","max","getEnd","overlaps","period1","period2","arrayA","arrayB","ids","includes","extractSet","periods","condition","arr","sort","period","extractSetWith","buildSets","extractionF","sets","buildSetsWith","configure","widthOfCol","cols","colIndex","flatDeep","d","acc","val","concat","isArray","slice","withColumns","f","groupEvents","overlappingGroup","col","eventIndex","eventGeometry","Infinity","addBatchNumber","number","obj","batch","removeBatchProps","removeBatchProp","filterByStartDate","unSerialiseEvents","unSerialiseEvent","Events","eventsGeometry","prefetchGcal","selectJobsForDate","useMemo","createSelector","res","compose","jobsForDate","selectFromResult","selectGcalForDate","array1","array2","batch1","batch2","batchProcess","gcalForDate","eventsProcessed","gcalProcessed","evnt","HoursStyled","HourStyled","Hours","hour","formatISO","representation","CalendarStyled","Corner","Row","WeekStyled","DayStyled","ScrollPortal","Calendar","rowEl","initialScrollSet","scrollTop","Fragment","ref","BackGround","Modal","title","fontSize","fontWeight","fontVariant","color","group","marginBottom","paddingTop","li","listStyle","margin","container","marginTop","pricing","textAlign","whiteSpace","row","JobDetails","displayEvent","close","useParams","isFetching","CustomerDetails","Card","card","CardHeader","CardContent","primary","secondary","Charges","Grid","item","xs","subheader","Times","Operatives","operative","Addresses","address","IconButton","header","paddingBottom","overflowY","maxHeight","description","modal","toolbar","justifyContent","minHeight","firstItem","GcalDetails","selectGcalEvent","htmlBlob","formatDateString","primaryTypographyProps","alignItems","replace","replaceAll","ListBuilder","onChange","label","itemName","addAddress","updatedValue","produce","draft","wrap","input","setInput","getError","dense","ListItemAvatar","disableTypography","ListItemSecondaryAction","el","removeAddress","TextField","fullWidth","isValidatorError","err","getValidatorMessage","isCastError","getCastMessage","kind","processMongooseError","entries","path","match","dateTimeFromInput","FlexRow","flexItem","flex","marginRight","inputRow","textField","JobForm","initialValues","handleSubmit","values","doc","Document","validateSync","validationResult","processed","onSubmit","as","helperText","utils","DateFnsUtils","TimePicker","setFieldValue","DatePicker","multiline","rows","handleChange","EditJobForm","goBack","CreateJobForm","search","URLSearchParams","useQuery","addNewJob","getInitialValuesFromQuery","unwrap","getUser","auth0Client","auth0","getTokenSilently","fetch","Authorization","then","catch","createUser","JSON","stringify","getOrCreateUser","previouslyCreatedUser","json","newUser","authorize","BASE_URL","authSlice","isAuthorizedToGcal","loading","startLoading","stopLoading","authenticationSuccess","authorizedToGcalSuccess","logOut","loginThunk","loginWithRedirect","redirect_uri","onloadThunk","authorizedToGcal","authorizeGcalThunk","logoutThunk","logout","returnTo","Auth","handleRedirectCallback","AuthorizeGcalButton","href","LoginPage","OauthCallback","asyncHandler","settingsValue","Content","Provider","Spinner","CircularProgress","Login","Logout","AuthenticationButton","TopBar","AppBar","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","configureStore","reducer","calendarReducer","authReducer","errorsReducer","middleware","getDefaultMiddleware","store","ReactDOM","document","getElementById"],"mappings":"6EAAA,MAA8BA,EAAQ,IAA/BC,EAAP,EAAOA,SAASC,EAAhB,EAAgBA,WAqBhBC,EAAOC,QAAU,CACbC,UAhBJ,SAAmBC,GACf,IALWC,EAAMC,EAKXC,EAAQH,EAASI,WACjBC,EAAiBL,EAASM,aAAa,GAC7C,OAPWL,EAOEE,EAAME,EAPFH,EAOiB,EAN3BK,KAAKC,MAAMP,EAAK,SAAG,GAAIC,IAAvBK,KAAA,IAA+B,GAAIL,IAoB1CO,oBAXwB,SAACC,EAAUC,GACnC,IAAMZ,EAAcW,EAAWC,EAAU,GACnCR,EAAQI,KAAKC,MAAMT,GACnBa,EAA4B,IAAjBb,EAAUI,GAC3B,OAAOP,EAAWD,EAAS,IAAIkB,KAAOV,GAAOS,M,kDChB3CE,EAAWpB,EAAQ,KACnBqB,EAAOrB,EAAQ,KAEfsB,EAAYtB,EAAQ,KAKpBuB,GAHWvB,EAAQ,KACLA,EAAQ,IAApBwB,QAEY,CAClBC,KAAM,CACJC,KAAMC,OACNC,UAAU,EACVC,SAAU,CACR,CACEP,UAAW,SAACQ,GACV,OAAOA,EAAEC,OAAS,GAEpBC,QAAS,2CAIfC,OAAQ,CACNP,KAAMC,OACNE,SAAU,CACRP,UAAW,SAACQ,GACV,OAAOR,EAAUY,cAAcJ,EAAG,CAAC,WAErCE,QAAS,kCAGbG,MAAO,CACLT,KAAMC,OACNE,SAAU,CACRP,UAAWA,EAAUc,QACrBJ,QAAS,4BAKTK,EAAiBjB,EAASkB,OAAOf,GAEjCgB,EAAa,CACjBC,WAAY,CAAEd,KAAMe,QACpBC,WAAY,CAAEhB,KAAMe,QACpBE,WAAY,CAAEjB,KAAMe,SAGhBG,EAAgBxB,EAASkB,OAAOC,GAEhCM,EAAa,CACjBC,IAAK,CACHpB,KAAMC,OACNoB,QAAS1B,GAEXd,MAAO,CACLsB,SAAU,CACRP,UAAW,SAACQ,GACV,OAAOA,EAAEC,OAAS,GAEpBC,QAAS,4CAEXN,KAAMC,SAIJqB,EAAgB5B,EAASkB,OAAOO,GAEhCI,EAAe,CACnBH,IAAK,CACHpB,KAAMC,OACNoB,QAAS1B,GAEXd,MAAO,CACLsB,SAAU,CACRP,UAAW,SAACQ,GACV,OAAOA,EAAEC,OAAS,GAEpBC,QAAS,8CAEXN,KAAMC,SAIJuB,EAAkB9B,EAASkB,OAAOW,GAElCE,EAAY,IAAI/B,EAASkB,OAAO,CACpCQ,IAAK,CACHpB,KAAMC,OACNoB,QAAS1B,GAEX+B,MAAO,CACL1B,KAAMP,KACNS,UAAU,GAEZyB,IAAK,CACH3B,KAAMP,KACNS,UAAU,GAEZ0B,SAAUjB,EACVkB,QAASX,EACTY,MAAO7B,OACP8B,UAAW,CAACT,GACZU,WAAY,CAACR,GACbS,cAAeC,QACfC,IAAK,CACHnC,KAAMC,UAINmC,EAAM1C,EAAS2C,MAAM,MAAOZ,EAAW,QAE3C,SAASa,EAAcC,EAAKC,EAAMC,GAChC,MAAM,CACJC,KAAMH,EAAM,EACZI,GAAIxD,KAAKyD,IAAIL,EAAOC,EAAMC,GAC1BI,GAAIJ,G,gCAIR,0GAAsBC,EAAtB,EAAsBA,KAAMC,EAA5B,EAA4BA,GAAIJ,EAAhC,EAAgCA,KAAMC,EAAtC,EAAsCA,MAAOL,EAA7C,EAA6CA,IACrCW,EAAS,GACZJ,IAAMI,EAAOpB,MAAQ,CAAEqB,KAAML,IAC7BC,IAAIG,EAAOnB,IAAM,CAAEqB,KAAML,IAC5BG,EAAOX,IAAMA,EACPc,EAASb,EACVc,KAAKJ,GANZ,SAQsBV,EAAIe,eAAeL,GARzC,cAQQL,EARR,OASEW,QAAQC,IAAIZ,GACTF,GAAQC,GACTS,EAAMT,MAAMzB,OAAOyB,IACdD,KAAKxB,OAAOwB,IAZrB,UAcoBU,EAdpB,eAcMnB,EAdN,yBAeS,CAACA,QACNwB,WAAYhB,EAAcC,EAAKC,EAAMC,GACrCA,MAAOX,EAAMzB,SAjBjB,6C,sDAqBA,WAAsBkD,EAAMpB,GAA5B,4EACMqB,EAAM,IAAIpB,EAAJ,OAAamB,GAAb,IAAmBpB,SAD/B,SAEQqB,EAAIC,OAFZ,gCAGSD,GAHT,4C,+BAMeE,E,kEAAf,WAAmBC,GAAnB,qFACoBvB,EAAIwB,SAASD,GADjC,cACQH,EADR,yBAESA,GAFT,4C,sDAKA,WAAsBG,GAAtB,qFACmBvB,EAAIyB,UAAU,CAAEzC,IAAKuC,IADxC,cACMJ,EADN,yBAESA,GAFT,4C,sDAKA,WAAoBnC,EAAK0C,GAAzB,qFAMoBJ,EAAItC,GANxB,cAMQoC,EANR,OAOEO,OAAOC,KAAKF,GAAQG,SAAQ,SAAUC,GACpCV,EAAIU,GAAOJ,EAAOI,MARtB,SAUQV,EAAIC,OAVZ,gCAWSD,GAXT,4C,sDAcA,WAAyBD,GAAzB,+EACQnB,EAAI+B,aADZ,cAEEf,QAAQC,IAAIE,GAFd,SAGQnB,EAAIgC,WAAWb,GAHvB,4C,sBAMA9E,EAAOC,QAAU,CACf2F,K,4CACAC,O,8CACAZ,MACAa,O,4CACAC,U,4CACAC,K,8CACAhD,aAGF/C,EAAQ0D,IAAMA,G,2PCjLRsC,EAAYC,aAAW,SAACC,GAAD,MAAY,CAUrCC,KAAM,CACFC,QAAS,QAEbC,OAAQ,CACJC,OAAQJ,EAAMI,OAAOC,OAAS,GAElCA,OAAQ,CACJC,MAnBY,IAoBZC,WAAY,GAEhBC,YAAa,CACTF,MAvBY,KA0BhBG,gBAAiB,CACbC,SAAU,QAEdC,QAAS,CACLC,SAAU,EACVC,QAASb,EAAMc,QAAQ,IAE3BC,QAAS,CAACb,QAAS,YAgCRc,MA5Bf,WACI,IAAMC,EAAUnB,IAChB,OACI,cAACoB,EAAA,EAAD,CACIC,UAAWF,EAAQZ,OACnBe,QAAQ,YACRH,QAAS,CACLI,MAAOJ,EAAQT,aAJvB,SAQI,sBAAKW,UAAWF,EAAQR,gBAAxB,UACG,cAACa,EAAA,EAAD,IACC,eAACC,EAAA,EAAD,WACI,eAACC,EAAA,EAAD,CAAUC,UAAWC,IAAM3D,GAAG,YAA9B,UACI,cAAC4D,EAAA,EAAD,UAAc,cAAC,IAAD,MACd,cAACC,EAAA,EAAD,0BAEJ,eAACJ,EAAA,EAAD,CAAUC,UAAWC,IAAM3D,GAAG,QAA9B,UACI,cAAC4D,EAAA,EAAD,UAAc,cAAC,IAAD,MACd,cAACC,EAAA,EAAD,0C,2FCxDTC,cAAkB,CAC/BC,OAPaC,4BAQbC,UAPeD,mCAQfE,SAPeF,yBCgBJG,EAAWC,YAAU,CAC9BC,YAAa,MACbC,UAAWC,YAAe,CACtBC,QAAS,+BAETC,eAAe,WAAD,4BAAE,WAAOC,EAAP,oBAAAC,EAAA,6DAAiBC,EAAjB,EAAiBA,UACvBC,EAAQD,IAAWE,KAAKD,QAE1BH,EAAQK,IAAI,gBAAZ,iBAAuCF,IAH/B,kBAKLH,GALK,2CAAF,qDAAC,KAQnBM,SAAU,CAAC,QACXC,UAAW,SAAAC,GAAO,MAAK,CACnBC,QAASD,EAAQ5E,MAAM,CACnBA,MAAO,gBAAEP,EAAF,EAAEA,KAAMC,EAAR,EAAQA,GAAR,2BAA8BD,EAA9B,eAAyCC,IAChDoF,kBAAmB,SAAAC,GACf,OAAOA,EAASzE,KAAKzB,OAEzBmG,aAAc,WAAyB,IAAxBC,EAAuB,uDAAhB,GAClB9E,QAAQC,IAAI6E,GACZ,IAAMC,EAAC,CACH,QADG,mBAEAD,EAAOE,KAAI,kBAAY,CAACpI,KAAM,OAAQ2D,GAA3B,EAAEvC,UAGpB,OADAgC,QAAQC,IAAI,KAAK8E,GACVA,KAGfE,QAASR,EAAQS,SAAS,CACtBrF,MAAO,SAAAO,GAAG,MAAK,CACX+E,IAAI,SAAD,OAAW/E,EAAIpC,KAClBoH,OAAQ,MACRC,KAAMjF,IAEVkF,gBAAiB,SAACR,EAAQS,EAAOC,GAE7B,MADU,CAAC,CAAC5I,KAAM,OAAQ2D,GAAIiF,EAAIxH,SAI1CyH,OAAQhB,EAAQ5E,MAAM,CAClBA,MAAO,SAAAU,GAAE,MAAK,CACV4E,IAAI,SAAD,OAAW5E,KAElBoE,kBAJkB,SAIAC,GACd,OAAOA,EAASzE,MAEpB0E,aAAc,SAACC,EAAOS,EAAMC,GAAd,MAAoB,CAAC,CAAC5I,KAAM,OAAQ2D,GAAIiF,OAE1DE,OAAQjB,EAAQS,SAAS,CACrBrF,MAAO,SAAAO,GAAG,MAAK,CACX+E,IAAI,QACJC,OAAQ,OACRC,KAAMjF,IAEVkF,gBAAiB,CAAC,UAEtBK,QAASlB,EAAQ5E,MAAM,CACnBA,MAAO,gBAAEP,EAAF,EAAEA,KAAMC,EAAR,EAAQA,GAAR,kCAAqCD,EAArC,eAAgDC,IACvDoF,kBAAmB,SAAAC,GACf,OAAOA,EAASzE,KAAK6E,KAAI,SAAAY,GAAS,OAOlD,SAAiBA,GACb,IAAOtH,EAAkBsH,EAAlBtH,MAAOC,EAAWqH,EAAXrH,IAAKgC,EAAMqF,EAANrF,GACnB,OAAO,2BACAqF,GADP,IAEItH,MAAOA,EAAM9C,SACb+C,IAAKA,EAAI/C,SACToB,KAAM,YACNoB,IAAKuC,IAdyCsF,CAAQD,aAmBvD,IACHE,EAMApC,EANAoC,gBACAC,EAKArC,EALAqC,eACAC,EAIAtC,EAJAsC,mBACAC,EAGAvC,EAHAuC,kBACAC,EAEAxC,EAFAwC,gBACAC,EACAzC,EADAyC,YCvGSC,EAAcC,YAAY,CACnC1J,KAAM,SACN2J,aAAc,CACVpJ,QAAS,GACTqJ,OAAQ,KACRC,WAAY,MAEhBC,SAAU,CACVC,YAAa,SAACC,EAAMC,GACZ,MAAO,CACH1J,QAAS,GACTqJ,OAAQ,KACRC,WAAY,QAIxBK,cAAe,SAACpC,GACZA,EAAQqC,WACJpD,EAASc,UAAUE,QAAQqC,eAC3B,SAACJ,EAAD,GAAoB,IACL,IADPK,EAAW,EAAXA,QACDA,IACCL,EAAMzJ,QAAN,UAAgB8J,EAAQ7G,YAAxB,aAAgB,EAAcjD,QAC9ByJ,EAAMJ,OAAN,UAAaS,EAAQ7G,YAArB,aAAa,EAAcoG,OAC3BI,EAAMH,WAAaQ,EAAQT,cAOjCG,EAAeN,EAAYa,QAA3BP,YAICN,IAAf,QC/Be,SAASc,IACpB,IAAMC,EAAOC,aAAY,SAAAT,GAAK,OAAIA,EAAMU,OAAOb,cACzCtJ,EAAUkK,aAAY,SAAAT,GAAK,OAAGA,EAAMU,OAAOnK,WAC3CoK,EAAUC,cACVC,EAAWC,cACXC,EAAWC,cAOjB,OACI,gCACI,2DACA,6CAAgBR,KAChB,gDAAmBjK,KACnB,wBAAQ0K,QAVK,WACjBF,EAAShB,KACTY,EAAQO,KAAKL,EAASb,MAAMrH,OAQxB,wB,4BClBG,SAASwI,EAAT,GAA0C,IAAnBC,EAAkB,EAAlBA,SAAYC,EAAM,iBAC9CC,EAAUb,aAAY,SAACT,GAAD,OAAUA,EAAMU,OAAOd,UAKnD,OACI,cAAC,IAAD,2BACQyB,GADR,IAEIE,OAAQ,YAAmB,IAAhBV,EAAe,EAAfA,SACP,OAAOS,EACH,cAAC,IAAD,CACI1I,GAAI,CACA4I,SAAU,SACVxB,MAAO,CAAErH,KAAMkI,MAIvBO,M,mBCpBL,SAASK,EAAT,GAA8C,IAAtBL,EAAqB,EAArBA,SAAaC,EAAQ,iBACpDK,EAAkBjB,aAAY,SAACT,GAAD,OAAWA,EAAMtC,KAAKgE,mBAE1D,OACE,cAAC,IAAD,2BACML,GADN,IAEEE,OAAQ,YAAmB,IAAhBV,EAAe,EAAfA,SACT,OAAOa,EACLN,EAEA,cAAC,IAAD,CACExI,GAAI,CACF4I,SAAU,SACVxB,MAAO,CAAErH,KAAMkI,UCd7B,IAEec,EAFSC,IAAMC,gB,mCCA9B,GAA8CtN,EAAQ,IAA/CuN,GAAP,GAAOA,QAAQC,GAAf,GAAeA,OAAOC,GAAtB,GAAsBA,WAAWC,GAAjC,GAAiCA,UAgB1B,SAASC,GAAeC,GAC3B,IACMC,EADa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GACR/D,KAAI,SAAAgE,GAAG,OAAIA,EAZtC,SAAmBF,GACtB,OAJyB,KADCG,EAKLH,EAAKI,UAJG,EAAID,EAAgB,EAD9C,IAAuBA,EAgBqBE,CAAUL,MACzD,OAAOC,EAAW/D,KAAI,SAAAoE,GAAI,OAAIX,GAAQK,EAAMM,MAOzC,SAASC,GAAaP,GACzB,MAAM,GAAN,OAAUJ,GAAOI,EAAK,OAAtB,YAAgCJ,GAAOI,EAAK,SAUzC,IAQMQ,GAAmB,SAACR,EAAKS,GAClC,IAAM5N,EAAQ4N,EAAK3N,WACbQ,EAAUmN,EAAKzN,aACrB,OAAOV,YAAWD,mBAAS2N,EAAKnN,GAAOS,IAGpC,SAASoN,GAAgBV,GAC5B,OAAO1N,YAAWD,mBAAS2N,EAAK,GAAG,GAGhC,SAASW,GAAcX,GAC1B,OAAOU,GAAgBf,GAAQK,EAAK,IAGxC,I,YAYeY,GAZQ,CACnBb,kBACAc,UAvCG,SAAmBb,GACtB,OAAOJ,GAAOI,EAAK,QAuCnBO,gBACAZ,WACAmB,eAlCG,SAAwBd,GAC3B,IAAMhE,EAAQ6D,GAAWF,GAAQK,GAAM,IAGvC,OAFAhE,EAAO3J,SAAS,GAChB2J,EAAO1J,WAAW,GACX0J,GA+BP+E,WA5BoB,SAACC,EAAehB,GACpC,IAAMiB,EAAYtB,GAAQqB,EAAe,GACzC,SAAIlB,GAAUkB,EAAehB,KAASF,GAAUmB,EAAUjB,KAGlDA,GAAOgB,GAAkBhB,GAAOiB,GAwBxCT,oBACAU,WAAYR,GACZS,SAAUR,IChERS,GAAgBC,IAAOC,IAAR,0rBA2BN,SAASC,GAAT,GAA2B,IAAPC,EAAM,EAANA,KAC/B,OACI,cAACJ,GAAD,UACSI,EACItF,KAAI,SAAC8D,EAAKyB,GAAN,OACD,sBAAK5H,UAAU,MAAf,UACI,4BAAI6H,GAAGb,UAAUb,KACjB,4BAAIA,EAAK2B,cAFaF,QChClD,IAAMG,GAAkBP,IAAOC,IAAV,mEAKfO,GAAmBR,IAAOC,IAAV,wZAqBhBQ,GAAkBT,IAAOC,IAAV,yRAiBrB,SAASS,KACL,MAA+BtC,IAAMuC,WAAWC,GAAzCC,EAAP,EAAOA,YAAYC,EAAnB,EAAmBA,WAEnB,OACI,cAACN,GAAD,CACIM,WAAYA,EACZD,YAAaA,EAFjB,SAKK,YAAIE,MAAM,IAAItK,QACVoE,KAAI,SAACmG,GAAD,OACD,qBAAKxI,UAAU,aAAf,SAGC,4BAAIwI,KAFIA,QAU7B,SAASC,KACL,MAA+B7C,IAAMuC,WAAWC,GAAzCC,EAAP,EAAOA,YAAYC,EAAnB,EAAmBA,WACnB,OAAQ,cAACL,GAAD,CACJK,WAAYA,EACZD,YAAaA,EAFT,SAIH,YAAIE,MAAM,IAAItK,QACVoE,KAAI,SAACmG,GAAD,OACD,qBAAKxI,UAAU,YAEXxG,OAAQ8O,EACRI,OAAQL,GAFHG,QAQV,SAASG,GAAT,GAAmC,IAAfC,EAAc,EAAdA,aAC/B,EAA+BhD,IAAMuC,WAAWC,GAAzCC,EAAP,EAAOA,YAAYC,EAAnB,EAAmBA,WAEnB,OACI,eAACP,GAAD,CAAiBa,aAAcA,EAA/B,UACI,cAACV,GAAD,IACA,cAACO,GAAD,CAAWjP,OAAQ8O,EAAYI,OAAQL,O,2CCvFpC,SAASQ,GAAT,GAIX,IAHFC,EAGC,EAHDA,YACAC,EAEC,EAFDA,cACAC,EACC,EADDA,cAIA,OACE,eAAC7I,EAAA,EAAD,WACE,cAAC8I,GAAA,EAAD,CAAQhE,QAAS+D,EAAjB,SACE,cAACE,GAAA,EAAD,MAEF,cAACC,GAAA,EAAD,CAAYlJ,QAAQ,KAApB,SAA0ByG,GAAaoC,KAEvC,cAACG,GAAA,EAAD,CAAQhE,QAAS8D,EAAjB,SACE,cAACK,GAAA,EAAD,S,uBCkBR,I,+BC3BO,SAASC,GAAQlD,GAAsB,IAAhBmD,EAAe,uDAAH,EAClCR,EAAchD,aAAQ,IAAIpM,KAAKyM,GAAmB,EAAZmD,GACtC3B,EAAOzB,GAAe4C,GACtBS,EAAW1C,GAAgB,IAAInN,KAAKiO,EAAK,KACzC6B,EAAU1C,GAAc,IAAIpN,KAAKiO,EAAKA,EAAKrN,OAAS,KAC1D,MAAO,CACLwO,YAAaA,EAAYW,cACzB9B,KAAMA,EAAKtF,KAAI,SAAAgE,GAAG,OAAEA,EAAIoD,iBACxBF,SAAUA,EAASE,cACnBD,QAASA,EAAQC,eAkBrB,IAAM9F,GAAY,2BACb0F,GAAQ,IAAI3P,OADC,IAEhBgQ,OAAQ,GACRC,WAAY,GACZC,eAAgB,MAGZC,GAAgBnG,YAAY,CAChC1J,KAAM,WACN2J,gBACAG,SAAU,CACRgG,WADQ,SACG9F,EAAOC,GAChBD,EAAM0F,OAASzF,EAAOI,SAExB0F,eAJQ,SAIO/F,EAAMC,GACnBD,EAAM2F,WAAa1F,EAAOI,SAE5B0E,cAPQ,SAOM/E,EAAOC,GACnB,OAAO,2BACFoF,GAAQrF,EAAM8E,YAAa,IADhC,IAEEY,OAAQ,GACRC,WAAY,MAGhBX,cAdQ,SAcMhF,GACZ,OAAO,2BACFqF,GAAQrF,EAAM8E,aAAc,IADjC,IAEEY,OAAQ,GACRC,WAAY,MAGhBrH,QArBQ,SAqBA0B,EAAOC,GACb,IAAQI,EAAYJ,EAAZI,QACF2F,EAAahG,EAAM0F,OAAOO,WAC9B,SAACC,GAAD,OAAWA,EAAM7O,KAAOgJ,EAAQhJ,QAEd,IAAhB2O,IACFhG,EAAM0F,OAAOM,GAAcG,aAAU9F,KAGzC+F,UA9BQ,SA8BEpG,EAAOC,GACfD,EAAM0F,OAAOxE,KAAKjB,EAAOI,UAE3BgG,sBAjCQ,SAiCcrG,EAAMC,GAC1BD,EAAM4F,eAAiB3F,EAAOI,YAK5BC,GAAYuF,GAAZvF,QA0CKgG,IAxC2BhG,GAAzB+F,sBAwCmB,SAACtF,EAAUvD,GAC3CuD,EAAST,GAAQyE,mBAINwB,GAAqB,SAACxF,EAAUvD,GAC3CuD,EAAST,GAAQ0E,kBAiDNwB,GACE,SAACxG,GAAD,OAASyG,aAASzG,EAAM0G,SAAS5B,cADnC0B,GAEL,SAACxG,GAAD,OAASA,EAAM0G,SAAS/C,KAAKtF,KAAI,SAAAgE,GAAG,OAAEoE,aAASpE,OAgBxCwD,MAAf,Q,SCpMO,SAASc,GAAQC,EAAWC,GAC/B,OAAOA,EAAgBD,EAOpB,IAAME,GAAe,SAACC,EAAWC,GACpC,OAAO5R,KAAK6R,MAAMF,EAAWC,GAASA,G,iCCbpCE,GAAoB1D,IAAO2D,EAAV,oIAQjBC,GAAW5D,IAAO2D,EAAV,yJASC,SAASE,GAAT,GAA8C,IAAvB1P,EAAsB,EAAtBA,MAAOC,EAAe,EAAfA,IAAK0P,EAAU,EAAVA,QAE9C,OACI,qCACI,cAACF,GAAD,UAAWrF,aAAOpK,EAAO,KAAO,MAAQoK,aAAOnK,EAAK,OACpD,cAACsP,GAAD,CAAmBjL,QAAQ,YAA3B,SAAwCqL,OCPpD,I,GAAMC,GAAc/D,IAAOC,IAAV,kJAEK,SAAC+D,GAAD,OAAWA,EAAMC,mBAE3B,SAACD,GAAD,OAAYA,EAAME,SAAW,aAAe,aAMzC,SAASC,GAAT,GAUmB,IATKC,EASN,EATCC,IACQC,EAQT,EARCC,OACAC,EAOD,EAPCA,KACAC,EAMD,EANCA,MACA5Q,EAKD,EALCA,IACAM,EAID,EAJCA,MACAC,EAGD,EAHCA,IACAC,EAED,EAFCA,SAED,IADC4P,uBACD,MADmB,MACnB,EAC7B,EAAsB7F,IAAMsG,SAASN,GAArC,oBAAOC,EAAP,KAAYM,EAAZ,KACA,EAA4BvG,IAAMsG,SAASJ,GAA3C,oBAAOC,EAAP,KAAeK,EAAf,KACO9D,EAAc1C,IAAMuC,WAAWC,GAA/BE,WAED3D,EAAUC,cAIhB,GAFiBI,cAEc3B,KAA/B,oBAAOf,EAAP,UAAiB+J,UAEjBzG,IAAM0G,WAAU,WACZH,EAAOP,GACPQ,EAAUN,KACX,CAACF,EAASE,IAEb,IAUA,EC/DW,WACX,MAA6BlG,IAAMsG,UAAS,GAA5C,oBAAOR,EAAP,KAAgBa,EAAhB,KAkBA,MAAO,CAACC,sBAAuBd,EAASe,gBAhBhB,SAACC,GACrB,IAAMC,EAAaD,EAAEE,OAAOC,wBAAwBd,OAC9Ce,EAAWJ,EAAEK,QAIfR,EADAO,EAAWH,GAAcG,EAFfH,EAAa,KAayBK,iBAJjC,SAACN,GACpBH,GAAY,KDgDZU,GADGT,EAAP,EAAOA,sBAAuBC,EAA9B,EAA8BA,gBAAiBO,EAA/C,EAA+CA,iBAG/C,SAASE,EAAUrB,GACf,OAAOvS,+BAAoBuS,EAAkB,GAAbvD,GAGpC,SAAS6E,EAAQpB,GACb,OAAOzS,+BAAiC,GAAbgP,EAAkByD,EAAqB,GAAbzD,GAGzD,IAAM8E,EAAcxH,IAAMyH,OAAO,GAC3BC,EAAa1H,IAAMyH,OAAO,GAC1BE,EAAgB3H,IAAMyH,OAAO,GAwC7BG,EEfK,SAAiBC,EAAYC,EAAaC,EAAgBC,EAASlC,GAC9E,MAAqB9F,IAAMsG,UAAS,GAApC,oBAAOsB,EAAP,KAAYK,EAAZ,KACMC,EAAoBlI,IAAMyH,OAAO,GAGjCU,EAAoBnI,IAAMoI,aAAY,SAACtB,GACzCoB,EAAkBG,SAAWvB,EAAEwB,UAC/BR,EAAaI,EAAkBG,QAAQvB,EAAEwB,aAC3C,CAACR,IAEGS,EAAuBvI,IAAMoI,aAAY,SAACtB,GAC5CoB,EAAkBG,SAAWvB,EAAEwB,UAC/BP,EAAgBG,EAAkBG,QAAQvB,EAAEwB,aAC9C,CAACP,IAEGS,EAAgBxI,IAAMoI,aAAY,SAACtB,GACtCmB,GAAQ,GACPD,EAASE,EAAkBG,WAC7B,CAACL,IAoBH,OAlBAhI,IAAM0G,WAAU,WAWZ,MAVU,SAAPkB,IACCa,OAAOC,iBAAiB,YAAaP,GACrCM,OAAOC,iBAAiB,UAAUF,IAG5B,SAAPZ,IACCa,OAAOC,iBAAiB,YAAaH,GACrCE,OAAOC,iBAAiB,UAAUF,IAG/B,WACCC,OAAOE,oBAAoB,YAAYR,GACvCM,OAAOE,oBAAoB,YAAYJ,GACvCE,OAAOE,oBAAoB,UAAUH,MAE/C,CAACZ,EAAKO,EAAkBI,EAAqBC,IAExC,SAAC1B,GACJA,EAAE8B,iBACFX,EAAQnC,EAAW,OAAS,QAC5B+B,IACAK,EAAkBG,QAAU,GF3BnBQ,CAtCO7I,IAAMoI,aAAY,WAClCV,EAAWW,QAAUpC,EACrB0B,EAAcU,QAAUlC,EACxBqB,EAAYa,QAAUtD,GAAQoB,EAAQ,GAAKzD,GAAcuD,IAC1D,CAACA,EAAKE,EAAQzD,KAQK,SAACoG,GACnB,IAAMC,EAAUrB,EAAWW,QAAUS,EAC/BE,EAAa9D,GAAe6D,EAASrG,GAC3C6D,EAAOyC,GACP,IAAM7C,EFpFP,SAAoBpB,EAAQE,GAC/B,OAAOA,EAAgBF,EEmFJC,CACXgE,EAAaxB,EAAYa,QACZ,GAAb3F,GAEJ8D,EAAUL,MAdW,SAAC2C,EAAcR,GACpC,IAAMW,EAAgBtB,EAAcU,QAAUS,EACxCI,EAAgBhE,GAAe+D,EAAevG,GAChDqC,GAAQmE,EAA4B,GAAbxG,GAAmBuD,GAAKO,EAAU0C,MAc/C,SAAChB,GACfzQ,QAAQC,IAAIwQ,GACc,IAAtBA,EAEAxL,EAAQ,CACJjH,MACAM,MAAOgL,GAAiBhL,EAAOuR,EAAUrB,IACzCjQ,IAAK+K,GAAiB/K,EAAKuR,EAAQpB,MAtD3CpH,EAAQO,KAAR,+BAAqC7J,MAmErCmR,GAGJ,OACI,cAACjB,GAAD,CACI,iBAAgB,QAChB,UAASlQ,EACT2E,UAAU,QACV+O,YAAa,SAACrC,GACVc,EAAKd,IAETsC,YAAavC,EACbwC,aAAcjC,EACdtB,SAAUc,EACV0C,UAAU,QACVzD,gBAAiBA,EACjB0D,MAAO,CACH1D,gBAAiBA,EACjBI,IAAKA,EAAM,KACXE,OAAQA,EAAS,KACjBC,OACAC,SAjBR,SAoBI,cAACZ,GAAD,CAAc1P,MAAOA,EAAOC,IAAKA,EAAK0P,QAASzP,EAAS7B,SG3IpE,IAAMuR,GAAc/D,IAAOC,IAAV,mJAIL,SAAC+D,GAAD,OAAYA,EAAME,SAAW,aAAe,aAMzC,SAAS0D,GAAT,GAWmB,IAVKxD,EAUN,EAVCC,IACQC,EAST,EATCC,OACAC,EAQD,EARCA,KACAC,EAOD,EAPCA,MACA5Q,EAMD,EANCA,IACAM,EAKD,EALCA,MACAC,EAID,EAJCA,IAGI0P,GACL,EAHC+D,YAGD,EAFCC,mBAED,EADKhE,SAGlC,EAAsB1F,IAAMsG,SAASN,GAArC,oBAAOC,EAAP,KAAYM,EAAZ,KACA,EAA4BvG,IAAMsG,SAASJ,GAA3C,oBAAOC,EAAP,KAAeK,EAAf,KAGIzH,EAAUC,cAWd,OATAgB,IAAM0G,WAAU,WACZH,EAAOP,GACPQ,EAAUN,KACZ,CAACF,EAAQE,IAOP,cAAC,GAAD,CAAa,iBAAgB,QAChB,UAASzQ,EACT2E,UAAU,QAEVmP,MAAO,CACHtD,IAAKA,EAAI,KAAME,OAAQA,EAAO,KAAMC,OAAMC,SAE9ChH,QAZjB,WACIN,EAAQO,KAAR,iCAAuC7J,KAIvC,SASI,cAACgQ,GAAD,CAAc1P,MAAOA,EAAOC,IAAKA,EAAK0P,QAASA,MChD3D,IAAI1N,GANJ,WACI,IAAIA,EAAK,EACT,OAAO,kBAAMA,KAIR2R,GA8BT,SAASC,GAAS7N,GACd,OA7BuBhG,EAoB3B,SAAkBgG,GACd,OAAOA,EAAIU,KAAI,SAAA6H,GAAK,OAAIA,EAAMvO,SAAO8T,QAAO,SAAClO,EAAGmO,GAAJ,OAAU,IAAIhW,KAAKN,KAAKyD,IAAI0E,EAAGmO,OAQzDC,CAAShO,GA7BG/F,EAwBlC,SAAgB+F,GACZ,OAAOA,EAAIU,KAAI,SAAA6H,GAAK,OAAIA,EAAMtO,OAAK6T,QAAO,SAAClO,EAAGmO,GAAJ,OAAU,IAAIhW,KAAKN,KAAKwW,IAAIrO,EAAGmO,OAIxCG,CAAOlO,GA5BjC,CACHhG,MAAOA,EACPC,IAAKA,EACLgC,GAAIA,MAJL,IAAoBjC,EAAOC,EAgClC,SAASkU,GAASC,EAASC,GAEvB,OAAOD,EAAQpU,MAAQqU,EAAQpU,KAAOoU,EAAQrU,MAAQoU,EAAQnU,IAsBlE,SAASwK,GAAW6J,EAAQC,GACxB,IAAIC,EAAMF,EAAO5N,KAAI,SAAA6H,GAAK,OAAIA,EAAM7O,OACpC,OAAO6U,EAAOnT,QAAO,SAAAmN,GAAK,OAAKiG,EAAIC,SAASlG,EAAM7O,QAItD,SAASgV,GAAWC,EAASC,GACzB,OAZmBC,EAaDF,EAZX,YAAIE,GAAKC,MAAK,SAAClP,EAAGmO,GAAJ,OAAUnO,EAAE5F,MAAQ+T,EAAE/T,UAalC8T,QACG,SAAC9N,EAAK+O,GAAN,OAAgC,IAAf/O,EAAIrH,QAAgBiW,EAAUG,EAAQlB,GAAS7N,IAA/C,sBAA2DA,GAA3D,CAAgE+O,IAAU/O,IACzF,IAhBlB,IAAuB6O,EAoBvB,SAASG,GAAeJ,GACpB,OAAO,SAACD,GACJ,OAAOD,GAAWC,EAAQC,IAIlC,SAASK,GAAUN,EAASO,GAAyB,IAAZC,EAAW,uDAAJ,GAC5C,GAAuB,IAAnBR,EAAQhW,OAAc,OAAOwW,EACjC,IAAInP,EAAMkP,EAAYP,GACtB,OAAOM,GACHxK,GAAWzE,EAAK2O,GAChBO,EAFY,sBAGRC,GAHQ,CAGFnP,KAGlB,SAASoP,GAAcF,GACnB,OAAO,SAACP,GACJ,OAAOM,GAAUN,EAAQO,EAAY,KC/FtC,SAASG,GAAUxX,EAAOkP,GAC7B,IAAMnP,EACF,SAACC,EAAQkP,GACT,IAAM1P,EAAQ,SAAC4N,GAAD,OAAUxN,KAAKC,MAAMuN,IAGnC,OAAO,SAACA,GAGJ,OAFAA,EAAOhO,qBAAUgO,GAEV5N,EAAM4N,GAAQpN,GAAUR,EAAM4N,GAAQ,GAAK8B,EAASlP,EAL/C,SAACoN,GAAD,OAAUA,EAAO5N,EAAM4N,GAKiCnN,CAAQmN,IAPhF,CASDpN,EAAOkP,GAEJuI,EAAa,SAACC,GAAD,OAAU,IAAMA,EAAK5W,QAElC0R,EAAO,SAACmF,EAAUD,GAAX,OAAoBC,EAAWF,EAAWC,IAgBvD,SAASE,EAASZ,GAAa,IAARa,EAAO,uDAAH,EACvB,OAAOA,EAAI,EAAIb,EAAIf,QAAO,SAAC6B,EAAKC,GAAN,OAAcD,EAAIE,OAAOjJ,MAAMkJ,QAAQF,GAAOH,EAASG,EAAKF,EAAI,GAAKE,KAAM,IAC/Ff,EAAIkB,QAKd,OAAO,SAAwBhI,GAK3B,IAAIvH,ED0DG,SAAqBuH,GAEhC,IAEIiI,EAFkBZ,GAAcJ,GAAeb,IAA7BiB,CAAwCrH,GAE5BrH,KAAI,SAAAV,GAClC,OAAOoP,GAAcJ,IA7DbiB,EA6DmC9B,GA5DxC,WACH,OAAQ8B,EAAC,WAAD,gBA2DDb,CAAgDpP,GA7D/D,IAAgBiQ,KA+DZ,OAAOD,ECjEWE,CAAYnI,GAAQrH,KAC9B,SAAAyP,GAAgB,OAAIA,EACfzP,KAAI,SAAC0P,EAAKZ,GACP,OAAOY,EAAI1P,KAAI,SAAC6H,EAAO8H,GAAR,OA1B/B,SAAuB9H,EAAMiH,EAASD,GAClC,IAAOvV,EAAcuO,EAAdvO,MAAOC,EAAOsO,EAAPtO,IACd,OAAO,2BACAsO,GADP,IAEI2B,IAAKtS,EAASoC,GACdoQ,OAAgB,GAAPvS,EAAaD,EAASqC,GAC/BoQ,KAAM9R,OAAO8R,EAAKmF,EAASD,IAAS,IACpCjF,MAAO/R,OAAO,KAAO8R,EAAKmF,EAASD,GAAQD,EAAWC,KAAU,MAoBpDe,CAAc/H,EAAMiH,EAASW,YAI7C,OAAOV,EAASjP,EAAO+P,M,iBCtD/B,SAASC,GAAe3B,EAAI4B,GACxB,OAAO5B,EAAInO,KAAI,SAAAgQ,GAAG,kCAAOA,GAAP,IAAWC,MAAOF,OAQxC,SAASG,GAAiB/B,GACtB,OAAOA,EAAInO,KAAI,SAAAgQ,GAAG,OANtB,SAAyBA,GAErB,OADyBA,EAAlBC,MAAP,YAAyBD,EAAzB,IAKoBG,CAAgBH,M,aCIlCI,GAAkB,SAACtM,GAAD,OACpB,SAAAuD,GAAM,OAAGA,EAAO3M,QAAO,SAAAmN,GAAK,OAAI,IAAIxQ,KAAKwQ,EAAMvO,OAAO4K,WAAaJ,EAAKI,cAS5E,IAAMmM,GAAoB,SAAChJ,GAAD,OAAWA,EAAOrH,KAAI,SAAA6H,GAAK,OAPrD,SAA0BA,GACtB,OAAO,2BAAIA,GAAX,IACIvO,MAAO8O,aAASP,EAAMvO,OACtBC,IAAK6O,aAASP,EAAMtO,OAI2B+W,CAAiBzI,OAEzD,SAAS0I,GAAT,GAAyB,IAARzM,EAAO,EAAPA,KAEtB0M,EAAiB7B,GADJpL,IAAMuC,WAAWC,GAA7BE,WACsC,GACvCwK,EAAetP,EAAY,WAE3B+F,EAAW9E,aAAY,SAAAT,GAAK,OAAEA,EAAM0G,SAASnB,YAC7CC,EAAU/E,aAAY,SAAAT,GAAK,OAAEA,EAAM0G,SAASlB,WAElD5D,IAAM0G,WAAU,WACXwG,EAAa,CAACnW,KAAM6M,EAAS5M,GAAIkJ,aAAQ,IAAIpM,KAAK8P,GAAS,GAAGC,gBAC/DqJ,EAAa,CAACnW,KAAMmJ,aAAQ,IAAIpM,KAAK6P,IAAW,GAAGE,cAAe7M,GAAI2M,MACvE,CAACA,EAASC,IAEb,IAAMuJ,EAAoBC,mBACtB,WACI,OAAOC,cACH,SAAAC,GAAG,OAAEA,EAAI1V,MAAQ,MACjB,SAAC0V,EAAI/M,GAAL,OAAYA,KACZ,SAAC3I,EAAK2I,GAAN,OAAagN,KAAQT,GAAkBD,GAAkBtM,GAA5CgN,CAAmD3V,QAEtE,IAEC4V,EAAejQ,EAAgB,CAACxG,KAAM4M,EAAU3M,GAAI4M,GAAS,CAChE6J,iBAAkB,SAAAlR,GAAM,MAAG,CACvBiR,YAAaL,EAAkB5Q,EAAOgE,OAFvCiN,YAMDE,EAAoBN,mBACtB,WACI,OAAOC,cACH,SAAAC,GAAG,OAAEA,EAAI1V,MAAQ,MACjB,SAAC0V,EAAI/M,GAAL,OAAYA,KACZ,SAAC3I,EAAK2I,GAAN,OAAagN,KAAQT,GAAkBD,GAAkBtM,GAA5CgN,CAAmD3V,QAEtE,IAoBN,EDlEG,SAAsB+V,EAAOC,EAAO5B,GAGvC,IAAMzP,EAASyP,EAAE,GAAD,mBAAKO,GAAeoB,EAAO,IAA3B,YAAiCpB,GAAeqB,EAAO,MACjEC,EAAStR,EAAOpF,QAAO,SAAAsV,GAAG,OAAc,IAAZA,EAAIC,SAChCoB,EAASvR,EAAOpF,QAAO,SAAAsV,GAAG,OAAc,IAAZA,EAAIC,SAItC,MAAO,CAACC,GAAiBkB,GAAQlB,GAAiBmB,ICyDVC,CAAaP,EAlB/B7P,EAAgB,CAAC5G,KAAM4M,EAAU3M,GAAI4M,GAAS,CAChE6J,iBAAkB,SAAAlR,GAAM,MAAG,CACvByR,YAAaN,EAAkBnR,EAAOgE,OAFvCyN,aAkByE,GAAGf,GAAnF,oBAAOgB,EAAP,KAAuBC,EAAvB,KAEA,4BAEYD,EACHxR,KACG,SAAC0R,EAAMnM,GACH,OAAO,wBAAC+D,GAAD,2BACCoI,GADD,IAEH5V,IAAK4V,EAAK1Y,WAP9B,YAWeyY,EAAczR,KACjB,SAAC0R,EAAMnM,GACH,OAAO,wBAACwH,GAAD,2BACC2E,GADD,IAEH5V,IAAK4V,EAAKnW,W,sCC5F5BoW,GAAcxM,IAAOC,IAAV,4FAMXwM,GAAazM,IAAOC,IAAV,mPAMK,SAAC+D,GAAD,gBACZA,EAAMnD,YADM,yCAQN,SAAS6L,GAAT,GAAqC,IAApBlU,EAAmB,EAAnBA,UAAWmG,EAAQ,EAARA,KACzC,EAAoCP,IAAMuC,WAAWC,GAA7CC,EAAR,EAAQA,YAAaC,EAArB,EAAqBA,WACf3D,EAAUC,cAWhB,OACE,cAACoP,GAAD,UACG,YAAIzL,MAAM,IAAItK,QAAQoE,KAAI,SAACmG,GAAD,OACzB,cAACyL,GAAD,CAEE,YAAW/Z,OAAOsO,GAClBF,WAAYA,EACZD,YAAaA,EACbrI,UAAWA,EACXkP,UAAU,QACVjK,QAAS,kBAnBIkP,EAmBc3L,OAlBjC7D,EAAQO,KAAR,yCACoChL,OAAOia,GAD3C,qBAC6DC,aACzDjO,EACA,CAAEkO,eAAgB,WAJJ,IAACF,IAaR3L,QCzBf,I,GAAM8L,GAAiB9M,IAAOC,IAAV,8CAId8M,GAAS/M,IAAOC,IAAV,iDAIN+M,GAAMhN,IAAOC,IAAV,+HASHgN,GAAajN,IAAOC,IAAV,gFAEJ,SAAA+D,GAAK,gBAA0B,GAAnBA,EAAMlD,WAAb,SAKXoM,GAAYlN,IAAOC,IAAV,+YAaTkN,GAAenN,IAAOC,IAAV,kXAgBH,SAASmN,KACpB,IAAM7P,EAAWC,cAEVsD,EAAc1C,IAAMuC,WAAWC,GAA/BE,WACkB1C,IAAMsG,SAAS,GAAjCtC,eAuBP,IAAMiL,EAAQjP,IAAMyH,OAAO,MAErByH,EAAmBlP,IAAMyH,OAAO,MAEtCzH,IAAM0G,WAAU,WACRwI,EAAiB7G,UACjB4G,EAAM5G,QAAQ8G,UAAW,IACzB1X,QAAQC,IAAIuX,EAAM5G,QAAQ8G,WAC1BD,EAAiB7G,SAAU,KAEjC,CAAC4G,IAEH,IAQM/L,EAAcrE,YAAY+F,IAC1B7C,EAAOlD,YAAY+F,IAEzB,OACI,cAAC,IAAMwK,SAAP,UACI,eAACV,GAAD,CAAgBhM,WAAYA,EAA5B,UACI,eAACkM,GAAD,WACI,cAACD,GAAD,CAAQvU,UAAU,WAClB,cAAC6I,GAAD,CACIC,YAAaA,EACbC,cAlBE,WAClBhE,EAASuF,KAkBOtB,cAfE,WAClBjE,EAASwF,UAiBD,eAACiK,GAAD,WACI,cAACD,GAAD,IACA,cAAC7M,GAAD,CAAWC,KAAMA,OAErB,cAACgN,GAAD,CAAcM,IAAKJ,EAAnB,SACI,eAACL,GAAD,WACI,cAAC7L,GAAD,IACA,cAAC8L,GAAD,CAAYnM,WAAYA,EAAxB,SACKX,EAAKtF,KAAI,SAAC8D,EAAMyB,GAAP,OACN,eAAC8M,GAAD,WACI,cAAC9B,GAAD,CACIzM,KAAMA,IAEV,cAAC+N,GAAD,CAAO/N,KAAMA,MAJDyB,kBCzIhD,IAAMsN,GAAa1N,IAAOC,IAAV,yNAmBD,SAAS0N,GAAT,GAA2B,IAAX/P,EAAU,EAAVA,SAC3B,OACI,cAAC8P,GAAD,UACa9P,I,yMCIfzG,GAAYC,aAAW,SAACC,GAAD,MAAY,CACrCuW,MAAO,CACHC,SAAU,GACVC,WAAY,OACZC,YAAa,aACbC,MAAO,WAEXC,MAAO,CACHC,aAAc,SAElBlW,QAAS,CACLmW,WAAY,GAEhBC,GAAI,CACAC,UAAW,OACXnW,QAAS,EACToW,OAAQ,GAEZC,UAAW,CACPC,UAAW,GACXvK,gBAAiB,WAErBnN,KAAM,CACFoB,QAAS,EACT,SAAU,CACNA,QAAS,IAGjBuW,QAAS,CACLD,UAAWnX,EAAMc,QAAQ,GACzBuW,UAAW,UAEfna,MAAO,CACHoa,WAAY,YAEhBC,IAAK,CACDJ,UAAWnX,EAAMc,QAAQ,QAK1B,SAAS0W,GAAT,GAAwD,EAAnCC,aAAmC,EAArBC,MAAqB,EAAdlH,YAAe,IACtDvP,EAAUnB,KACVkG,EAAWC,cAIjBzH,QAAQC,IAAIuH,EAASW,UAKrB,IAAMb,EAAUC,cAEXhH,EAAM4Y,cAAN5Y,GAELP,QAAQC,IAAIM,GAMZ,MAA8BwF,EAAexF,GAAlCH,EAAX,EAAKD,KAAWiZ,EAAhB,EAAgBA,WAEhBpZ,QAAQC,IAAIG,GACZJ,QAAQC,IAAImZ,GAQZ,IAAMC,EAAkB,SAAC,GAAD,IAAE7a,EAAF,EAAEA,SAAF,OACpB,eAAC8a,GAAA,EAAD,CAAM3W,UAAWF,EAAQ8W,KAAzB,UACI,cAACC,GAAA,EAAD,CAAYzB,MAAO,qBACnB,cAAC0B,GAAA,EAAD,UACI,eAAC1W,EAAA,EAAD,CAAMJ,UAAWF,EAAQxB,KAAzB,UACI,eAAC+B,EAAA,EAAD,WACI,cAACG,EAAA,EAAD,UACI,cAAC,KAAD,MAEJ,cAACC,EAAA,EAAD,CAAcsW,QAASlb,EAAS7B,KAAMgd,UAAU,YAEpD,eAAC3W,EAAA,EAAD,WACI,cAACG,EAAA,EAAD,UACI,cAAC,KAAD,MAEJ,cAACC,EAAA,EAAD,CACIsW,QAASlb,EAASrB,OAClBwc,UAAU,cAGlB,eAAC3W,EAAA,EAAD,WACI,cAACG,EAAA,EAAD,UACI,cAAC,KAAD,MAEJ,cAACC,EAAA,EAAD,CACIsW,QAASlb,EAASnB,MAClBsc,UAAU,sBAQ5BC,EAAU,SAAC,GAAD,IAAEnb,EAAF,EAAEA,QAAF,OACZ,eAACob,GAAA,EAAD,CAAMnB,WAAS,EAACpW,QAAS,EAAGK,UAAWF,EAAQmW,QAA/C,UACI,cAACiB,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,SACI,cAACT,GAAA,EAAD,UACI,cAACE,GAAA,EAAD,CACIzB,MAAOtZ,EAAQf,WACfsc,UAAW,iBAIvB,cAACH,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,SACI,cAACT,GAAA,EAAD,UACI,cAACE,GAAA,EAAD,CACIzB,MAAOtZ,EAAQb,WACfoc,UAAW,oBAIvB,cAACH,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,SACI,cAACT,GAAA,EAAD,UACI,cAACE,GAAA,EAAD,CACIzB,MAAOtZ,EAAQZ,WACfmc,UAAW,wBAOzBC,EAAQ,SAAC,GAAkB,IAAjB3b,EAAgB,EAAhBA,MAAOC,EAAS,EAATA,IAGnB,OAFAyB,QAAQC,WAAWyI,MAGf,eAACmR,GAAA,EAAD,CAAMnB,WAAS,EAACpW,QAAS,EAAGK,UAAWF,EAAQmW,QAA/C,UACI,cAACiB,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,SACI,cAACT,GAAA,EAAD,UACI,cAACE,GAAA,EAAD,CACIzB,MAAOrP,aAAO,IAAIrM,KAAKiC,GAAQ,MAC/B0b,UAAW,aAIvB,cAACH,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,SACI,cAACT,GAAA,EAAD,UACI,cAACE,GAAA,EAAD,CACIzB,MAAOrP,aAAO,IAAIrM,KAAKiC,GAAQ,KAC/B0b,UAAW,mBAIvB,cAACH,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,SACI,cAACT,GAAA,EAAD,UACI,cAACE,GAAA,EAAD,CACIzB,MAAOrP,aAAO,IAAIrM,KAAKkC,GAAM,KAC7Byb,UAAW,qBAS7BE,EAAa,SAAC,GAAD,IAAEtb,EAAF,EAAEA,WAAF,OACf,eAAC0a,GAAA,EAAD,WACI,cAACE,GAAA,EAAD,CAAYzB,MAAO,eACnB,cAAChV,EAAA,EAAD,WACMnE,GAAc,IAAIoG,KAAI,SAAAmV,GAAS,OAC7B,eAACnX,EAAA,EAAD,WACI,cAACG,EAAA,EAAD,UACI,cAAC,KAAD,MAEJ,cAACC,EAAA,EAAD,CAAcsW,QAASS,EAAU1e,oBAO/C2e,EAAY,SAAC,GAAD,QAAEzb,iBAAF,MAAY,GAAZ,SACd,eAAC2a,GAAA,EAAD,CAAO3W,UAAWF,EAAQsW,IAA1B,UACI,cAACS,GAAA,EAAD,CAAYzB,MAAO,cACnB,cAAChV,EAAA,EAAD,UACKpE,EAAUqG,KAAI,SAAAqV,GAAO,OAClB,eAACrX,EAAA,EAAD,WACI,cAACG,EAAA,EAAD,UACI,cAAC,KAAD,MAEJ,cAACC,EAAA,EAAD,CAAcsW,QAASW,EAAQ5e,oBAQnD,GAAI2d,EACA,OAAO,KAEP,IAAO5a,EAA+D4B,EAA/D5B,SAAUC,EAAqD2B,EAArD3B,QAASC,EAA4C0B,EAA5C1B,MAAOC,EAAqCyB,EAArCzB,UAAWC,EAA0BwB,EAA1BxB,WAAYN,EAAc8B,EAAd9B,MAAOC,EAAO6B,EAAP7B,IAC/D,OACI,cAACuZ,GAAD,UACI,eAACwB,GAAA,EAAD,CAAMxH,MAAO,CAAChQ,MAAO,KAAMsM,gBAAiB,WAA5C,UACI,cAACoL,GAAA,EAAD,CACIzB,MAAOvZ,EAAS7B,KAChBiK,OACI,qCACI,cAAC0T,GAAA,EAAD,CACI1S,QAAS,WACLN,EAAQO,KAAR,kCAAwCtH,KAFhD,SAKI,cAAC,KAAD,MAEJ,cAAC+Z,GAAA,EAAD,CACI1S,QAAS,WACLN,EAAQO,KAAK,cAFrB,SAKI,cAAC,KAAD,WAKhB,cAAC2R,GAAA,EAAD,IACA,cAACC,GAAA,EAAD,CAAa9W,UAAWF,EAAQN,QAAhC,SACI,eAAC0X,GAAA,EAAD,CAAMnB,WAAS,EAACpW,QAAS,EAAzB,UACI,eAACuX,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,UACI,cAACV,EAAD,CAAiB7a,SAAUA,IAC3B,cAACob,EAAD,CAASnb,QAASA,IAClB,cAACwb,EAAD,CAAO3b,MAAOA,EAAOC,IAAKA,OAG9B,cAACsb,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,SACI,eAACT,GAAA,EAAD,WACI,cAACE,GAAA,EAAD,CAAYzB,MAAO,UACnB,cAAC0B,GAAA,EAAD,CAAa9W,UAAWF,EAAQ/D,MAAhC,SAAwCA,SAGlD,eAACmb,GAAA,EAAD,CAAMC,MAAI,EAACC,GAAI,EAAf,UACC,cAACG,EAAD,CAAYtb,WAAYA,IACrB,cAACwb,EAAD,CAAWzb,UAAWA,iB,0DChQ9C2C,GAAYC,aAAW,SAACC,GAAD,MAAU,CACnC+Y,OAAO,CACHC,cAAe,GAEnBrY,QAAS,CACLmW,WAAY,EACZmC,UAAW,OACXC,UAAW,QAEfC,YAAa,CACT7B,WAAY,YAEhB8B,MAAO,CACH9Y,MAAO,KAEX+Y,QAAS,CACLC,eAAgB,WAChBC,UAAW,EACXzC,WAAY9W,EAAMc,QAAQ,IAE9BrB,KAAM,CACFqX,WAAY,GAEhB0C,UAAW,CACP1C,WAAY,OAKFnO,IAAOC,IAAV,mHASR,SAAS6Q,KACZ,IAAO1a,EAAI4Y,cAAJ5Y,GACD+G,EAAUC,cAEhBvH,QAAQC,IAAIM,GAEZ,IAAMkC,EAAUnB,KAGV4Z,EAAkBvF,mBAAQ,WAC5B,OAAOC,cACH,SAAAC,GAEI,OADA7V,QAAQC,IAAI4V,EAAI1V,MACT0V,EAAI1V,MAAQ,MAEvB,SAAC0V,EAAItV,GAAL,OAAYA,KACZ,SAACJ,EAAKI,GAAQ,IAAD,EACTP,QAAQC,IAAIE,GACZH,QAAQC,IAAIM,GACZ,IAAMuE,EAAM,iBAAI3E,QAAJ,IAAIA,OAAJ,EAAIA,EAAML,MAAK,SAAA8F,GAAS,OAAIA,EAAUrF,KAAOA,YAA7C,QAAoD,GAEhE,OADAP,QAAQC,IAAI6E,GACLA,OAIjB,IAEIoH,EAAW9E,aAAY,SAAAT,GAAK,OAAEA,EAAM0G,SAASnB,YAC7CC,EAAU/E,aAAY,SAAAT,GAAK,OAAEA,EAAM0G,SAASlB,WAE3CvG,EAAaM,EAAgB,CAAC5G,KAAM4M,EAAU3M,GAAI4M,GAAS,CAC9D6J,iBAAkB,SAAClR,GAAD,MAAW,CACzBc,UAAWsV,EAAgBpW,EAAOvE,OAFnCqF,UAMP5F,QAAQC,IAAI2F,GAEMA,EAAXqI,QAAP,IAc0BkN,EAZpB7c,EAAQ,IAAIjC,KAAJ,OAASuJ,QAAT,IAASA,OAAT,EAASA,EAAWtH,OAC5BC,EAAM,IAAIlC,KAAJ,OAASuJ,QAAT,IAASA,OAAT,EAASA,EAAWrH,KAuBhC,OArBAyB,QAAQC,IAAI3B,GAsBR,cAACwZ,GAAD,UAEI,eAACwB,GAAA,EAAD,CAAM3W,UAAWF,EAAQmY,MAAzB,UACI,cAAC9X,EAAA,EAAD,CAASH,UAAWF,EAAQoY,QAA5B,SACI,cAACP,GAAA,EAAD,UACI,cAAC,KAAD,CAAW1S,QAV/B,WACIN,EAAQO,KAAK,oBAYL,cAAC4R,GAAA,EAAD,CAAa9W,UAAWF,EAAQN,QAAhC,SACI,eAACY,EAAA,EAAD,CAAMJ,UAAWF,EAAQxB,KAAzB,UACI,eAAC+B,EAAA,EAAD,CAAUL,UAAWF,EAAQuY,UAA7B,UACI,cAAC7X,EAAA,EAAD,UAAc,cAAC,KAAD,MACd,cAACC,EAAA,EAAD,CACIsW,QAAS9T,EAAUqI,QACnB0L,UAlC5B,SAA0Brb,EAAMC,GAC5B,OAAGqK,aAAUtK,EAAMC,GACRmK,aAAOpK,EAAM,sBAAwB,MAAQoK,aAAOnK,EAAI,UAE5DmK,aAAOpK,EAAM,sBAAwB,MAAQoK,aAAOpK,EAAM,sBA8B9B8c,CAAiB9c,EAAMC,GAClC8c,uBAAwB,CAACzY,QAAS,WAG1C,eAACI,EAAA,EAAD,CAAUsY,WAAW,aAArB,UACI,cAACnY,EAAA,EAAD,UAAc,cAAC,KAAD,MACd,cAACC,EAAA,EAAD,CAAcsW,SAjCZyB,EAiCqC,OAACvV,QAAD,IAACA,OAAD,EAACA,EAAW+U,YAhCnEQ,EACGA,EAASI,QAAQ,cAAc,IACjCC,WAAW,WAAW,MACtBA,WAAW,OAAO,IAClBA,WAAW,aAAc,IAJT,IAgCgE7Y,UAAWF,EAAQkY,YAAaU,uBAAwB,CAACzY,QAAS,wB,6HC5HxJ,SAAS6Y,GAAT,GAOH,IANF9e,EAMC,EANDA,KAMC,IALDlB,aAKC,MALO,GAKP,EAJDigB,EAIC,EAJDA,SACAC,EAGC,EAHDA,MACAtU,EAEC,EAFDA,OACAuU,EACC,EADDA,SAYA,IAAMC,EAAa,SAACpgB,EAAO4e,GACzB,IAAMyB,EAAeC,aAAQtgB,GAAO,SAACugB,GACnCA,EAAMnU,KATV,SAAcpM,GACZ,MAAO,CACLuC,IAAKzB,OACLd,SAMWwgB,CAAK5B,OAQlBqB,EANU,CACRnM,OAAQ,CACN9T,MAAOqgB,EACPnf,KAAMA,MAmBZ,EAA0B4L,IAAMsG,SAAS,IAAzC,oBAAOqN,EAAP,KAAcC,EAAd,KAIA,SAASC,EAASjR,GAChB,OAAI9D,GAAUA,EAAO8D,GACZ9D,EAAO8D,GAAO1P,MAEhB,KAGT,OACE,qCACE,cAACsH,EAAA,EAAD,CAAMsZ,OAAK,EAAX,SACG5gB,GACCA,EAAMuJ,KAAI,SAACd,EAAGqG,GAAJ,OACR,eAACvH,EAAA,EAAD,WACE,cAACsZ,GAAA,EAAD,UACE,cAAC,KAAD,MAEF,cAAClZ,EAAA,EAAD,CAEEsW,QACE,qCACE,cAAC5N,GAAA,EAAD,CAAYlJ,QAAS,QAASlB,QAAQ,SAAtC,SACGwC,EAAEzI,QAEJ2gB,EAAS7R,GACR,cAACuB,GAAA,EAAD,CAAYlJ,QAAQ,UAAUuV,MAAM,QAApC,uBACUiE,EAAS7R,MAGnB,eAACuB,GAAA,EAAD,CAAYlJ,QAAQ,UAApB,UACG,IADH,KAEKgZ,EACFrR,EAAI,QAKbgS,mBAAiB,IAEnB,cAACC,GAAA,EAAD,UACE,cAAC,KAAD,CACErE,MAAM,UACNvQ,QAAS,SAACyH,GACRA,EAAE8B,iBA3DE,SAAC1V,EAAO8E,GAC5B,IAAMub,EAAeC,aAAQtgB,GAAO,SAACugB,GACnC,OAAOA,EAAMtc,QAAO,SAAC+c,GAAD,OAAQA,EAAGze,MAAQuC,QAQzCmb,EANU,CACRnM,OAAQ,CACN9T,MAAOqgB,EACPnf,KAAMA,KAqDM+f,CAAcjhB,EAAOyI,EAAElG,YA/BhBkG,EAAElG,UAsCvB,eAAC6b,GAAA,EAAD,CAAMC,MAAI,EAAV,UACE,cAAC6C,GAAA,EAAD,CACEhB,MAAOA,EACPlgB,MAAOygB,EACPU,WAAS,EACTlB,SAAU,SAACrM,GACT8M,EAAS9M,EAAEE,OAAO9T,UAGtB,wBACEmM,QAAS,SAACyH,GACRA,EAAE8B,iBACF0K,EAAWpgB,EAAOygB,GAClBC,EAAS,KAJb,qB,wDChIC7X,GAAQpJ,EAAQ,KAAhBoJ,IAQT,SAASuY,GAAiBC,GACxB,MAAiB,mBAAbA,EAAIngB,KAIV,SAASogB,GAAoBD,GAC3B,OAAOA,EAAI5f,QAGb,SAAS8f,GAAYF,GACnB,MAAiB,cAAbA,EAAIngB,KAIV,SAASsgB,GAAeH,GACtB,MAAM,eAAN,OAAsBA,EAAII,MAG5B,SAASC,GAAqBL,GAC5B,IAAKA,EAAK,OAAO,KAGjB,IAFA,IAAMhY,EAAS,GAEf,MAAyBnE,OAAOyc,QAAQN,EAAIzV,QAA5C,eAAqD,CAAhD,2BAAKvG,EAAL,KAAUrF,EAAV,KACG4hB,EAA8Bvc,EA5Bfya,QAAQ,QAAQ,SAAC+B,GACtC,MAAM,IAAN,OAAWA,EAAX,QA4BAtd,QAAQC,IAAIod,GACRL,GAAYvhB,GAAQ6I,GAAIQ,EAAQuY,EAAMJ,GAAexhB,IAChDohB,GAAiBphB,IACxB6I,GAAIQ,EAAQuY,EAAMN,GAAoBthB,IAG1C,OAAOqJ,ECCT,SAASyY,GAAkBzU,EAAMS,GAC/B,IAAM5N,EAAQ4N,EAAK3N,WACbQ,EAAUmN,EAAKzN,aACjB+Z,EAAM,IAAIxZ,KAAKyM,GAGnB,OAFA+M,EAAI1a,SAASQ,GACbka,EAAIza,WAAWgB,GACRyZ,EAGT,IAAM2H,GAAUrT,IAAOC,IAAV,gDAIP9I,GAAYC,YAAW,CAC3Bkc,SAAU,CACRC,KAAM,QACN,qBAAsB,CACpBC,YAAa,SAGjBC,SAAU,CACRvF,aAAc,QAEhBwF,UAAW,CACT,aAAc,CACZ/E,WAAY,eAKH,SAASgF,GAAT,GAA0D,IAAvCC,EAAsC,EAAtCA,cAAehG,EAAuB,EAAvBA,MAAOiG,EAAgB,EAAhBA,aAChDvb,EAAUnB,KAsCV9E,EAAS,uCAAG,WAAOyhB,GAAP,mBAAA/Z,EAAA,6DACVga,EAAM,IAAI5hB,KAAS6hB,SAASF,EAAQ5f,cAD1B,SAGe6f,EAAIE,eAHnB,cAGVC,EAHU,OAKVC,EAAYnB,GAAqBkB,GALvB,kBAUTC,GAVS,2CAAH,sDAaf,OACE,cAACxG,GAAD,UACE,eAACwB,GAAA,EAAD,WACE,cAACE,GAAA,EAAD,CAAYzB,MAAOA,IACnB,cAAC0B,GAAA,EAAD,UACE,cAAC,KAAD,CACEsE,cAAejR,qBAAUiR,GAAiB,IAC1CQ,SAAUP,EACVjhB,SAAUP,EAHZ,SAKG,SAAC2R,GAAD,mEAEC,cADA,CACA,QAAMoQ,SAAUpQ,EAAM6P,aAAtB,UACE,cAAC,KAAD,CACEQ,GAAI7B,KACJha,UAAWF,EAAQmb,SACnBjhB,KAAK,gBACLgf,MAAM,OACNpW,MAAK,UAAE4I,EAAM9G,cAAR,iBAAE,EAAc7I,gBAAhB,aAAE,EAAwB7B,KAC/B8hB,WAAU,UAAEtQ,EAAM9G,cAAR,iBAAE,EAAc7I,gBAAhB,aAAE,EAAwB7B,KACpCigB,WAAS,IAEX,cAAC,KAAD,CACE4B,GAAI7B,KACJha,UAAWF,EAAQmb,SACnBrY,MAAK,UAAE4I,EAAM9G,cAAR,iBAAE,EAAc7I,gBAAhB,aAAE,EAAwBrB,OAC/BshB,WAAU,UAAEtQ,EAAM9G,cAAR,iBAAE,EAAc7I,gBAAhB,aAAE,EAAwBrB,OACpCR,KAAK,kBACLgf,MAAM,SACNiB,WAAS,IAEX,cAAC,KAAD,CACE4B,GAAI7B,KACJha,UAAWF,EAAQmb,SACnBjhB,KAAK,iBACLgf,MAAM,QACNpW,MAAK,UAAE4I,EAAM9G,cAAR,iBAAE,EAAc7I,gBAAhB,aAAE,EAAwBnB,MAC/BohB,WAAU,UAAEtQ,EAAM9G,cAAR,iBAAE,EAAc7I,gBAAhB,aAAE,EAAwBnB,MACpCuf,WAAS,IAEX,eAACY,GAAD,CAAS7a,UAAWF,EAAQmb,SAA5B,UAEE,cAAC,KAAD,CAAyBc,MAAOC,KAAhC,SASE,cAACC,GAAA,EAAD,CACEjc,UAAWF,EAAQgb,SACnBhiB,MAAO,IAAIY,KAAK8R,EAAM8P,OAAO3f,OAC7Bod,SAAU,SAAC5S,GACTqF,EAAM0Q,cAAc,QAAS/V,GAAM,IAErC6S,MAAM,iBAGV,cAAC,KAAD,CAAyB+C,MAAOC,KAAhC,SACE,cAACC,GAAA,EAAD,CACEjc,UAAWF,EAAQgb,SACnBhiB,MAAO0S,EAAM8P,OAAO1f,IACpBmd,SAAU,SAAC5S,GACTqF,EAAM0Q,cAAc,MAAO/V,GAAM,IAEnC6S,MAAM,eAGV,cAAC,KAAD,CAAyB+C,MAAOC,KAAhC,SACE,cAACG,GAAA,EAAD,CACEnc,UAAWF,EAAQgb,SACnBhiB,MAAO0S,EAAM8P,OAAO3f,MACpBod,SAAU,SAAC5S,GACTqF,EAAM0Q,cACJ,QACAtB,GAAkBzU,EAAMqF,EAAM8P,OAAO3f,QACrC,GAEF6P,EAAM0Q,cACJ,MACAtB,GAAkBzU,EAAMqF,EAAM8P,OAAO1f,MACrC,GAEFyB,QAAQC,IAAI,UAEd0b,MAAM,cAKZ,eAAC6B,GAAD,CAAS7a,UAAWF,EAAQmb,SAA5B,UACE,cAAC,KAAD,CACEjb,UAAWF,EAAQgb,SACnBe,GAAI7B,KACJhgB,KAAK,qBACLgf,MAAM,cACNpW,MAAK,UAAE4I,EAAM9G,cAAR,iBAAE,EAAc5I,eAAhB,aAAE,EAAuBf,WAC9B+gB,WAAU,UAAEtQ,EAAM9G,cAAR,iBAAE,EAAc5I,eAAhB,aAAE,EAAuBf,WACnCkf,WAAS,IAEX,cAAC,KAAD,CACEja,UAAWF,EAAQgb,SACnBe,GAAI7B,KACJhgB,KAAK,qBACLgf,MAAM,aACNpW,MAAK,UAAE4I,EAAM9G,cAAR,iBAAE,EAAc5I,eAAhB,aAAE,EAAuBb,WAC9B6gB,WAAU,UAAEtQ,EAAM9G,cAAR,iBAAE,EAAc5I,eAAhB,aAAE,EAAuBb,WACnCgf,WAAS,IAEX,cAAC,KAAD,CACEja,UAAWF,EAAQgb,SACnBe,GAAI7B,KACJhgB,KAAK,qBACLgf,MAAM,aACNpW,MAAK,UAAE4I,EAAM9G,cAAR,iBAAE,EAAc5I,eAAhB,aAAE,EAAuBZ,WAC9B4gB,WAAU,UAAEtQ,EAAM9G,cAAR,iBAAE,EAAc5I,eAAhB,aAAE,EAAuBZ,WACnC+e,WAAS,OAIb,cAAC,KAAD,CACE4B,GAAI7B,KACJha,UAAWF,EAAQmb,SACnBjhB,KAAK,QACLgf,MAAM,QACNpW,MAAK,UAAE4I,EAAM9G,cAAR,aAAE,EAAc3I,MACrB+f,WAAU,UAAEtQ,EAAM9G,cAAR,aAAE,EAAc3I,MAC1Bke,WAAS,EACTmC,WAAS,EACTC,KAAM,IAER,cAACvD,GAAD,CACEhgB,MAAO0S,EAAM8P,OAAOtf,UACpB+c,SAAUvN,EAAM8Q,aAChBtD,MAAM,cACNhf,KAAK,YACLif,SAAS,UACTvU,OAAM,UAAE8G,EAAM9G,cAAR,aAAE,EAAc1I,YAExB,cAAC8c,GAAD,CACEhgB,MAAO0S,EAAM8P,OAAOrf,WACpB8c,SAAUvN,EAAM8Q,aAChBtD,MAAM,gBACNhf,KAAK,aACLif,SAAS,YACTvU,OAAM,UAAE8G,EAAM9G,cAAR,aAAE,EAAczI,aAGxB,cAACgN,GAAA,EAAD,CACEhP,KAAK,SACLgG,QAAQ,YACRuV,MAAM,UACNyE,WAAS,EAJX,+BCvQD,SAASsC,KACtB,IAAQ3e,EAAO4Y,cAAP5Y,GAEF+G,GADWK,cACDJ,eAIhB,EAA6BxB,EAAexF,GAAjCH,EAAX,EAAKD,KAAUiZ,EAAf,EAAeA,WAEhB,EAA8BpT,IAA9B,oBAAOf,EAAP,UAAgB+J,UAOf,OAAGoK,EAAmB,KAGpB,cAAC0E,GAAD,CAASE,aARU,SAAC7d,GACpB8E,EAAQ9E,GACRmH,EAAQ6X,UAM6BpB,cAAe3d,EAAK2X,MAAM,aCZpD,SAASqH,KACLzX,cAAjB,IACM9H,EARR,WACE,IAAQwf,EAAW5X,cAAX4X,OAER,OAAO9W,IAAMoN,SAAQ,kBAAM,IAAI2J,gBAAgBD,KAAS,CAACA,IAK3CE,GACRjY,EAAUC,cAWhB,MAAgCtB,IAAhC,oBAAOuZ,EAAP,KAIMzB,GAJN,KAAkB/O,UAVlB,WACE,IAAMlG,EAAOsE,aAASvN,EAAMS,IAAI,aAGhC,MAAO,CACLhC,MAHYnD,mBAAS2N,EAA0B,EAApBjJ,EAAMS,IAAI,SAIrC/B,IAHUpD,mBAAS2N,EAA0B,EAApBjJ,EAAMS,IAAI,QAAc,IAW/Bmf,IAEhBzB,EAAY,uCAAG,WAAO7d,GAAP,SAAA+D,EAAA,+EAKXsb,EAAUrf,GAAMuf,SALL,OAMjBpY,EAAQ6X,SANS,+CAQjBnf,QAAQuF,MAAM,8BARG,wDAAH,sDAYlB,OACE,cAACuY,GAAD,CACEE,aAAcA,EACdD,cAAeA,EACfhG,MAAM,gBCjDL,SAAe4H,KAAtB,gC,8CAAO,8BAAAzb,EAAA,sEACiB0b,EADjB,cACGC,EADH,gBAEiBA,EAAMC,mBAFvB,cAEG1b,EAFH,yBAII2b,MAAM,qCAAsC,CAC/C9b,QAAS,CACL+b,cAAc,UAAD,OAAY5b,MAG5B6b,MAAK,SAACpK,GACH,OAAOA,KAEVqK,OAAM,SAACpD,GAAD,OAAS9c,QAAQuF,MAAMuX,OAZ/B,4C,sBAeA,SAAeqD,KAAtB,gC,8CAAO,8BAAAjc,EAAA,sEACiB0b,EADjB,cACGC,EADH,gBAEiBA,EAAMC,mBAFvB,cAEG1b,EAFH,yBAII2b,MAAM,qCAAsC,CAC/C3a,OAAQ,OACRnB,QAAS,CACL,eAAgB,mBAChB+b,cAAc,UAAD,OAAY5b,IAE7BiB,KAAM+a,KAAKC,UAAU,MAEpBJ,MAAK,SAACpK,GACH,OAAOA,KAEVqK,OAAM,SAACpD,GAAD,OAAS9c,QAAQuF,MAAMuX,OAf/B,4C,sBAkBA,SAAewD,KAAtB,gC,8CAAO,8BAAApc,EAAA,+EAEqCyb,KAFrC,UAGqC,OAD9BY,EAFP,QAG2Bha,OAH3B,gCAGuDga,EAAsBC,OAH7E,gEAIuBL,KAJvB,WAKqB,OADdM,EAJP,QAKYla,OALZ,kCAKuCka,EAAQD,OAL/C,uDAOO,IAAItZ,MAAM,sDAPjB,kCAUClH,QAAQuF,MAAR,MAVD,2D,sBChCA,SAAemb,GAAtB,mC,8CAAO,WAAyBvZ,GAAzB,iBAAAjD,EAAA,sEACiB0b,EADjB,cACGC,EADH,gBAEiBA,EAAMC,mBAFvB,cAEG1b,EAFH,gBAIU2b,MAAM,qDAAD,OAAsD5Y,GAAQ,CAC5ElD,QAAS,CACL,eAAgB,mBAChB+b,cAAc,UAAD,OAAY5b,MAP9B,oF,sBCKP,IAOMuc,GAAsE,wBAC5E3gB,QAAQC,IAAI0gB,IAEZ,IAAMC,GAAYva,YAAY,CAC5B1J,KAAM,OACN2J,aAZmB,CACnB+B,iBAAiB,EACjBwY,oBAAoB,EACpBC,SAAS,EACT1c,MAAO,MASPqC,SAAU,CACRsa,aADQ,SACKpa,EAAMC,GACjBD,EAAMma,SAAU,GAElBE,YAJQ,SAIIra,EAAMC,GAChBD,EAAMma,SAAU,GAElBG,sBAPQ,SAOcta,EAAOC,GAC3BD,EAAM0B,iBAAkB,EACxB1B,EAAMvC,MAAQwC,EAAOI,SAEvBka,wBAXQ,SAWgBva,EAAMC,GAC5BD,EAAMka,oBAAqB,GAE7BM,OAdQ,SAcDxa,EAAMC,GACXD,EAAMka,oBAAqB,EAC3Bla,EAAM0B,iBAAkB,EACxB1B,EAAMma,SAAU,MAOTM,GAAU,uCAAG,WAAO1Z,EAAUvD,GAAjB,eAAAD,EAAA,sEACJ0b,EADI,cAClBC,EADkB,gBAElBA,EAAMwB,kBAAkB,CAC5BC,aAAa,GAAD,OAAKX,GAAL,WAHU,2CAAH,wDAQf1Z,GAAY2Z,GAAZ3Z,QAEKsa,GAAW,uCAAG,WAAO7Z,EAASvD,GAAhB,iBAAAD,EAAA,sEAEvBwD,EAAST,GAAQ8Z,gBAFM,SAGHnB,EAHG,cAGjBC,EAHiB,gBAIOA,EAAMxX,kBAJb,2DAKMX,EAAST,GAAQka,WALvB,yBAMHtB,EAAMC,mBANH,eAMjB1b,EANiB,OAOvBsD,EAAST,GAAQga,sBAAsB7c,IAPhB,UAQJkc,KARI,eASfngB,KAAKqhB,kBAAkB9Z,EAAST,GAAQia,2BAChDxZ,EAAST,GAAQ+Z,eAVM,kDAavBhhB,QAAQuF,MAAR,MAbuB,0DAAH,wDAiBXkc,GAAqB,SAACta,GAAD,8CAAS,WAAOO,EAASvD,GAAhB,eAAAD,EAAA,+EAGpByb,KAHoB,uCAIvB,IAAIzY,MAAM,gDAJa,uBAMlBwZ,GAAUvZ,GANQ,cAMjCrC,EANiC,iBAOVA,EAAO0b,OAPG,eAQrBrgB,KAAKqhB,kBAAkB9Z,EAAST,GAAQia,2BARnB,kDAUvClhB,QAAQuF,MAAR,MAVuC,0DAAT,yDA0BrBmc,GAAW,uCAAG,WAAOha,EAAUvD,GAAjB,eAAAD,EAAA,sEACL0b,EADK,cACnBC,EADmB,gBAEnBA,EAAM8B,OAAO,CACjBC,SAAS,GAAD,OAAKjB,GAAL,OAHe,2CAAH,wDAOTC,MAAf,QC5Fe,SAASiB,KACtB,IAAIhiB,EAPN,WACE,IAAQwf,EAAW5X,cAAX4X,OAER,OAAO9W,IAAMoN,SAAQ,kBAAM,IAAI2J,gBAAgBD,KAAS,CAACA,IAI7CE,GACN7X,EAAWC,cACXU,EAAkBjB,aAAY,SAACT,GAAD,OAAWA,EAAMtC,KAAKgE,mBACpDf,EAAUC,cAiBhB,OAfAgB,IAAM0G,WAAU,WACd,IAAM9H,EAAOtH,EAAMS,IAAI,QACjBqG,EAAQ9G,EAAMS,IAAI,SACxBN,QAAQC,IAAI,mBAAoBkH,EAAMR,GAElCQ,GAAQR,IACV3G,QAAQC,IAAI,YACZyH,EDkE6B,uCAAa,WAAOA,EAAUvD,GAAjB,eAAAD,EAAA,sEAC1B0b,EAD0B,cACxCC,EADwC,gBAExCA,EAAMiC,yBAFkC,OAG9Cpa,EAAS6Z,IAHqC,2CAAb,4DChE9B,IAEHhZ,IAAM0G,WAAU,WACV5G,GAAiBf,EAAQO,KAAK,eACjC,CAACQ,IAEG,gDC9BM,SAAS0Z,KAkBpB,OAjBmB3a,aAAY,SAAAT,GAAK,OAAEA,EAAMtC,KAAKwc,sBAoBzC,2EAEA,wBAAQjZ,QAnBhB,WACImY,MAAM,yCACDE,MAAK,SAACpK,GAAD,OAASA,EAAI2K,UAClBP,MAAK,SAACpK,GACH7V,QAAQC,IAAI4V,GACZ7E,OAAOxJ,SAASwa,KAAOnM,EAAI1Q,QAc/B,uBCtBG,SAAS8c,KACpB,OACI,uDCMO,SAASC,KACpB,IAAMriB,EARV,WACI,IAAQwf,EAAW5X,cAAX4X,OAER,OAAO9W,IAAMoN,SAAQ,kBAAM,IAAI2J,gBAAgBD,KAAS,CAACA,IAK3CE,GACR7X,EAAWC,cAYjB,OAVAY,IAAM0G,WAAU,WAAI,4CAChB,4BAAA/K,EAAA,uDACUiD,EAAOtH,EAAMS,IAAI,UAEnBoH,EAAS+Z,GAAmBta,IAHpC,4CADgB,uBAAC,WAAD,wBAOhBgb,KACF,IAEK,sCCVX,IAAMC,GAAgB,CAClBpX,YAAa,EACbC,WAAY,IAIV3J,GAAYC,aAAW,SAACC,GAAD,MAAY,CAUrCC,KAAM,CACFC,QAAS,QAEbC,OAAQ,CACJC,OAAQJ,EAAMI,OAAOC,OAAS,GAElCM,QAAS,CACLC,SAAU,EACVC,QAASb,EAAMc,QAAQ,IAE3BC,QAAS,CAACb,QAAS,YA+DR2gB,OA3Df,WACI,IAAM5f,EAAUnB,KAChB,OACI,cAAC,IAAD,UACI,sBAAKqB,UAAWF,EAAQN,QAAxB,UACI,cAACW,EAAA,EAAD,IACA,cAAC,IAAD,CAAOua,KAAK,SAAZ,SACI,cAAC,EAAD,MAEJ,cAACvV,EAAD,UACI,eAAC,IAAD,WACI,cAAC,IAAD,CAAOuV,KAAK,YAAZ,SACI,eAACjV,EAAD,WACI,cAAC,EAAgBka,SAAjB,CAA0B7mB,MAAO2mB,GAAjC,SACI,cAAC7K,GAAD,MAEJ,eAAC,IAAD,WACI,cAAC,IAAD,CAAO8F,KAAK,4BAAZ,SACI,cAACrE,GAAD,MAEJ,cAAC,IAAD,CAAQqE,KAAK,6BAAb,SACI,cAACpC,GAAD,MAEJ,cAAC,IAAD,CAAOoC,KAAK,8BAAZ,SACI,cAAC6B,GAAD,MAEJ,cAAC,IAAD,CAAO7B,KAAK,4BAAZ,SACI,cAAC+B,GAAD,cAKhB,cAAC,IAAD,CAAO/B,KAAK,QAAZ,SACI,cAACwE,GAAD,MAEJ,cAAC,IAAD,CAAOxE,KAAK,QAAZ,SACI,cAAC0E,GAAD,MAEJ,cAAC,IAAD,CAAO1E,KAAK,SAAZ,SACI,cAAC4E,GAAD,MAIJ,cAAC,IAAD,CAAO5E,KAAK,iBAAZ,SACI,cAAC6E,GAAD,MAEJ,cAAC,IAAD,UACI,cAAC,IAAD,CAAU3iB,GAAG,2B,8BCxFnCgjB,GAAUpY,aAAOqY,KAAPrY,CAAyB,CACvCgO,MAAO,UAIT,SAASsK,KACP,IAAM/a,EAAWC,cAEjB,OAAO,cAACiE,GAAA,EAAD,CAAQhE,QAAS,kBAAMF,EAAS0Z,KAAajJ,MAAM,UAAnD,oBAGT,SAASuK,KACP,IAAMhb,EAAWC,cAEjB,OACE,cAACiE,GAAA,EAAD,CACEhE,QAAS,WACPF,EAASga,KAEXvJ,MAAM,UAJR,qBAWW,SAASwK,GAAT,GAAmD,EAApBxK,MAAqB,IAC3D9P,EAAkBjB,aAAY,SAACT,GAAD,OAAWA,EAAMtC,KAAKgE,mBAG1D,OAFkBjB,aAAY,SAACT,GAAD,OAAUA,EAAMtC,KAAKyc,WAE9B,cAACyB,GAAD,IAEbla,EAAwB,cAACqa,GAAD,IAEpB,cAACD,GAAD,IChCd,IAAMnhB,GAAYC,aAAW,SAACC,GAAD,MAAY,CACrCuW,MAAO,CACL3V,SAAU,GAEZX,KAAM,CACFC,QAAS,QAEbC,OAAQ,CACJC,OAAQJ,EAAMI,OAAOC,OAAS,OAqBvB+gB,OAjBf,WACI,IAAMngB,EAAUnB,KAChB,OACI,qBAAKqB,UAAWF,EAAQhB,KAAxB,SACI,cAACohB,GAAA,EAAD,CAAQ3mB,SAAS,QAAQyG,UAAWF,EAAQd,OAA5C,SACI,eAACmB,EAAA,EAAD,WACI,cAACgJ,GAAA,EAAD,CAAYlJ,QAAQ,KAAKD,UAAWF,EAAQsV,MAA5C,oBAGA,cAAC4K,GAAD,YCZdrhB,GAAYC,aAAW,SAACC,GAAD,MAAY,CACrCe,QAAS,CACLb,QAAS,OACT4Z,WAAY,UACZP,UAAW,QAEftZ,KAAM,CACFtF,OAAQ,YAmBD2mB,OAff,WACI,IAAMrgB,EAAUnB,KAClB,OACE,qBAAKqB,UAAWF,EAAQhB,KAAxB,SACE,eAAC,IAAD,WACE,cAAC,GAAD,IACE,sBAAKkB,UAAWF,EAAQF,QAAxB,UACI,cAAC,EAAD,IACA,cAAC,GAAD,aCxBCwgB,GAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,8BAAqBhD,MAAK,YAAkD,IAA/CiD,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,O,UCCCO,eAAe,CAC5BC,QAAQ,cACNnW,SAAUoW,GACVpf,KAAMqf,GACNrc,OAAQsc,GACPjgB,EAASE,YAAcF,EAAS8f,SAEnCI,WAAY,SAAAC,GAAoB,OAC5BA,IAAuB1P,OAAOzQ,EAASkgB,eCL7CE,GAAMpc,SAAS6Z,IAIfwC,IAAS7b,OAEL,cAAC,IAAD,CAAU4b,MAAOA,GAAjB,SACE,cAAC,GAAD,MAIJE,SAASC,eAAe,SAM1BlB,O","file":"static/js/main.5e3de81f.chunk.js","sourcesContent":["const {setHours,setMinutes} = require('date-fns')\r\n\r\nfunction round(value,places){\r\n    return Math.floor(value * 10**places)/10**places\r\n}\r\n\r\nfunction asDecimal(dateTime){\r\n    const hours = dateTime.getHours()\r\n    const fractionOfHour = dateTime.getMinutes()/60\r\n    return round(hours+fractionOfHour,2)\r\n}\r\n\r\nconst getTimeFromPosition = (position, height) => {\r\n    const asDecimal =  (position / height) * 24\r\n    const hours = Math.floor(asDecimal)\r\n    const minutes = (asDecimal-hours)*60\r\n    return setMinutes(setHours(new Date(),hours),minutes)\r\n}\r\n\r\n\r\n\r\nmodule.exports = {\r\n    asDecimal,\r\n    getTimeFromPosition\r\n}\r\n\r\n\r\n\r\n","const mongoose = require(\"mongoose\");\r\nconst cuid = require(\"cuid\");\r\n/*const addGcalEvent = require('./../googleCalendar')*/\r\nconst validator = require(\"validator\"); //todo can we inmport only a subset\r\n\r\nconst setHours = require(\"date-fns/setHours\");\r\nconst { nextDay } = require(\"date-fns\");\r\n\r\nconst customerObj = {\r\n  name: {\r\n    type: String,\r\n    required: true,\r\n    validate: [\r\n      {\r\n        validator: (v) => {\r\n          return v.length > 4;\r\n        },\r\n        message: `name must have more than 4 characters`,\r\n      },\r\n    ],\r\n  },\r\n  mobile: {\r\n    type: String,\r\n    validate: {\r\n      validator: (v) => {\r\n        return validator.isMobilePhone(v, [\"en-GB\"]);\r\n      }, //TODO restrict this to uk and have anohter field for other phone numbers.\r\n      message: `must be a valid mobile number`,\r\n    },\r\n  },\r\n  email: {\r\n    type: String,\r\n    validate: {\r\n      validator: validator.isEmail,\r\n      message: \"must be a valid email\",\r\n    },\r\n  },\r\n};\r\n\r\nconst customerSchema = mongoose.Schema(customerObj);\r\n\r\nconst chargesObj = {\r\n  hourlyRate: { type: Number },\r\n  fuelCharge: { type: Number },\r\n  travelTime: { type: Number },\r\n};\r\n\r\nconst chargesSchema = mongoose.Schema(chargesObj);\r\n\r\nconst addressObj = {\r\n  _id: {\r\n    type: String,\r\n    default: cuid,\r\n  },\r\n  value: {\r\n    validate: {\r\n      validator: (v) => {\r\n        return v.length > 4;\r\n      },\r\n      message: `address must have more than 4 characters`,\r\n    },\r\n    type: String,\r\n  },\r\n};\r\n\r\nconst addressSchema = mongoose.Schema(addressObj);\r\n\r\nconst operativeObj = {\r\n  _id: {\r\n    type: String,\r\n    default: cuid,\r\n  },\r\n  value: {\r\n    validate: {\r\n      validator: (v) => {\r\n        return v.length > 3;\r\n      },\r\n      message: `operative must have more than 3 characters`,\r\n    },\r\n    type: String,\r\n  },\r\n};\r\n\r\nconst operativeSchema = mongoose.Schema(operativeObj);\r\n\r\nconst jobSchema = new mongoose.Schema({\r\n  _id: {\r\n    type: String,\r\n    default: cuid,\r\n  },\r\n  start: {\r\n    type: Date,\r\n    required: true,\r\n  },\r\n  end: {\r\n    type: Date,\r\n    required: true,\r\n  },\r\n  customer: customerSchema,\r\n  charges: chargesSchema,\r\n  items: String,\r\n  addresses: [addressSchema],\r\n  operatives: [operativeSchema],\r\n  markCompleted: Boolean,\r\n  sub: {\r\n    type: String,//TODO add validation to this using hook as adding it to schema will cause to fail on client\r\n  },\r\n});\r\n\r\nlet Job = mongoose.model(\"Job\", jobSchema, \"jobs\");\r\n\r\nfunction getPagination(skip,limit,count){\r\n  return{\r\n    from: skip +1,\r\n    to: Math.min(skip + limit,count),\r\n    of: count\r\n  }\r\n}\r\n\r\nasync function list({ from, to, skip, limit, sub }) {\r\n  const filter = {}\r\n  if(from) filter.start = { $gte: from }\r\n  if(to) filter.end = { $lte: to }\r\n  filter.sub = sub\r\n  const query  = Job\r\n      .find(filter)\r\n\r\n  const count = await Job.countDocuments(filter)\r\n  console.log(count)\r\n  if(skip && limit){\r\n    query.limit(Number(limit))\r\n        .skip(Number(skip))\r\n  }\r\n  let items = await query;\r\n  return {items,\r\n    pagination: getPagination(skip,limit,count),\r\n    count: items.length\r\n  };\r\n}\r\n\r\nasync function create(data, sub) {\r\n  let job = new Job({ ...data, sub });\r\n  await job.save(); //TODO add some validation start must be before end\r\n  return job;\r\n}\r\n\r\nasync function get(id) {\r\n  const job = await Job.findById(id);\r\n  return job;\r\n}\r\n\r\nasync function remove(id) {\r\n  let data = await Job.deleteOne({ _id: id });\r\n  return data;\r\n}\r\n\r\nasync function edit(_id, change) {\r\n  // let job = await Job.findByIdAndUpdate(_id, change, {\r\n  //   new: true,\r\n  //   runValidators: true,\r\n  // });\r\n  // return job;\r\n  const job = await get(_id);\r\n  Object.keys(change).forEach(function (key) {\r\n    job[key] = change[key];\r\n  });\r\n  await job.save();\r\n  return job;\r\n}\r\n\r\nasync function resetData(data) {\r\n  await Job.deleteMany();\r\n  console.log(data);\r\n  await Job.insertMany(data);\r\n}\r\n\r\nmodule.exports = {\r\n  list,\r\n  create,\r\n  get,\r\n  remove,\r\n  resetData,\r\n  edit,\r\n  jobSchema,\r\n};\r\n\r\nexports.Job = Job;\r\n","import Drawer from \"@material-ui/core/Drawer\";\r\nimport {AppBar, List, ListItem, ListItemIcon, ListItemText, Toolbar} from \"@material-ui/core\";\r\nimport {Link} from \"react-router-dom\";\r\nimport CalendarTodayIcon from \"@material-ui/icons/CalendarToday\";\r\nimport SettingsIcon from \"@material-ui/icons/Settings\";\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    // root: {\r\n    //   flexGrow: 1,\r\n    // },\r\n    // menuButton: {\r\n    //   marginRight: theme.spacing(2),\r\n    // },\r\n    // title: {\r\n    //   flexGrow: 1,\r\n    // },\r\n    root: {\r\n        display: 'flex',\r\n    },\r\n    appBar: {\r\n        zIndex: theme.zIndex.drawer + 1,\r\n    },\r\n    drawer: {\r\n        width: drawerWidth,\r\n        flexShrink: 0,\r\n    },\r\n    drawerPaper: {\r\n        width: drawerWidth,\r\n\r\n    },\r\n    drawerContainer: {\r\n        overflow: 'auto',\r\n    },\r\n    content: {\r\n        flexGrow: 1,\r\n        padding: theme.spacing(3),\r\n    },\r\n    wrapper: {display: 'flex'}\r\n}));\r\n\r\n\r\nfunction LeftDrawer(){\r\n    const classes = useStyles();\r\n    return(\r\n        <Drawer\r\n            className={classes.drawer}\r\n            variant=\"permanent\"\r\n            classes={{\r\n                paper: classes.drawerPaper,\r\n            }}\r\n        >\r\n\r\n            <div className={classes.drawerContainer}>\r\n               <Toolbar/>\r\n                <List>\r\n                    <ListItem component={Link} to='/calendar'>\r\n                        <ListItemIcon><CalendarTodayIcon/></ListItemIcon>\r\n                        <ListItemText>Calendar</ListItemText>\r\n                    </ListItem>\r\n                    <ListItem component={Link} to='/gcal'>\r\n                        <ListItemIcon><SettingsIcon/></ListItemIcon>\r\n                        <ListItemText>google calendar</ListItemText>\r\n                    </ListItem>\r\n                </List>\r\n            </div>\r\n        </Drawer>\r\n    )\r\n}\r\n\r\nexport default LeftDrawer","import createAuth0Client from \"@auth0/auth0-spa-js\";\r\n\r\nconst domain = process.env.REACT_APP_AUTH0_DOMAIN;\r\nconst clientId = process.env.REACT_APP_AUTH0_CLIENT_ID;\r\nconst audience = process.env.REACT_APP_AUTH0_AUDIENCE;\r\n\r\n\r\n// either with async/await\r\nexport default createAuth0Client({\r\n  domain: domain,\r\n  client_id: clientId,\r\n  audience: audience,\r\n});\r\n","// Import the RTK Query methods from the React-specific entry point\r\nimport {createApi, fetchBaseQuery} from '@reduxjs/toolkit/query/react'\r\nimport auth0Client from \"../auth/auth0\";\r\nimport {parseISO} from \"date-fns\";\r\n\r\n\r\nconst proposedDataStructure = {\r\n    ids: [],\r\n    eventsById: {},\r\n    idsByDay: {\r\n        monday: [],\r\n        tuesday: []\r\n    },\r\n    memoizationStrings: {\r\n        monday: [],\r\n        tuesday: []\r\n    }\r\n}\r\n\r\n\r\nexport const apiSlice = createApi({\r\n    reducerPath: 'api',\r\n    baseQuery: fetchBaseQuery({\r\n        baseUrl: 'http://localhost:8000/api/v1',\r\n\r\n        prepareHeaders: async (headers, {getState}) => {\r\n            const token = getState().auth.token\r\n            if (token) {\r\n                headers.set('authorization', `Bearer ${token}`)\r\n            }\r\n            return headers\r\n        },\r\n    }),\r\n    tagTypes: ['Jobs'],\r\n    endpoints: builder => ({\r\n        getJobs: builder.query({\r\n            query: ({from, to}) => `/jobs?from=${from}&to=${to}`,\r\n            transformResponse: response => {\r\n                return response.data.items\r\n            },\r\n            providesTags: (result=[],error,arg)=> {\r\n                console.log(result)\r\n                const r = [\r\n                    'Jobs',\r\n                    ...result.map(({_id}) => ({type: 'Jobs', id: _id}))\r\n                ]\r\n                console.log('47',r)\r\n                return r\r\n            }\r\n        }),\r\n        editJob: builder.mutation({\r\n            query: job => ({\r\n                url: `/jobs/${job._id}`,\r\n                method: 'PUT',\r\n                body: job\r\n            }),\r\n            invalidatesTags: (result, error, arg) => {\r\n                const r = [{type: 'Jobs', id: arg._id}]\r\n                return r\r\n            }\r\n        }),\r\n        getJob: builder.query({\r\n            query: id => ({\r\n                url: `/jobs/${id}`\r\n            }),\r\n            transformResponse(response) {\r\n                return response.data\r\n            },\r\n            providesTags: (result,error,arg)=>[{type: 'Jobs', id: arg}]\r\n        }),\r\n        addJob: builder.mutation({\r\n            query: job => ({\r\n                url: `/jobs`,\r\n                method: 'POST',\r\n                body: job\r\n            }),\r\n            invalidatesTags: ['Jobs']\r\n        }),\r\n        getGcal: builder.query({\r\n            query: ({from, to}) => `/gcal/events?from=${from}&to=${to}`,\r\n            transformResponse: response => {\r\n                return response.data.map(gcalEvent => reshape(gcalEvent))\r\n            },\r\n            //providesTags: ['GCal']\r\n        }),\r\n    })\r\n})\r\n\r\nfunction reshape(gcalEvent) {\r\n    const {start, end, id} = gcalEvent\r\n    return {\r\n        ...gcalEvent,\r\n        start: start.dateTime,\r\n        end: end.dateTime,\r\n        type: 'gcalEvent',\r\n        _id: id\r\n    }\r\n}\r\n\r\n// Export the auto-generated hook for the `getPosts` query endpoint\r\nexport const {\r\n    useGetJobsQuery,\r\n    useGetJobQuery,\r\n    useEditJobMutation,\r\n    useAddJobMutation,\r\n    useGetGcalQuery,\r\n    usePrefetch\r\n} = apiSlice","import { createSlice } from '@reduxjs/toolkit'\r\nimport {apiSlice} from \"../api/apiSlice\";\r\n\r\nexport const errorsSlice = createSlice({\r\n    name: 'errors',\r\n    initialState: {\r\n        message: '',\r\n        status: null,\r\n        statusCode: null,\r\n    },\r\n    reducers: {\r\n    clearErrors: (state,action)=>{\r\n            return {\r\n                message: '',\r\n                status: null,\r\n                statusCode: null,\r\n            }\r\n        }\r\n    },\r\n    extraReducers: (builder)=>{\r\n        builder.addMatcher(\r\n            apiSlice.endpoints.getJobs.matchRejected,\r\n            (state,{payload})=>{\r\n                if(payload){\r\n                    state.message = payload.data?.message\r\n                    state.status=payload.data?.status\r\n                    state.statusCode = payload.status\r\n                }\r\n            }\r\n        )\r\n    }\r\n})\r\n\r\nexport const {clearErrors} = errorsSlice.actions\r\n\r\n\r\n\r\nexport default errorsSlice.reducer","import React from \"react\";\r\nimport {useSelector,useDispatch } from \"react-redux\";\r\nimport {useHistory,useLocation} from \"react-router-dom\";\r\nimport {clearErrors} from \"./errorsSlice\";\r\n\r\n\r\nexport default function Error(){\r\n    const code = useSelector(state => state.errors.statusCode)\r\n    const message = useSelector(state =>state.errors.message)\r\n    const history = useHistory()\r\n    const location = useLocation()\r\n    const dispatch = useDispatch()\r\n\r\n    const handleGoBack = ()=>{\r\n        dispatch(clearErrors())\r\n        history.push(location.state.from)\r\n    }\r\n\r\n    return(\r\n        <div>\r\n            <h1>Oops something went wrong</h1>\r\n            <p>error code: {code}</p>\r\n            <p>error message: {message}</p>\r\n            <button onClick={handleGoBack}>Go Back</button>\r\n        </div>\r\n\r\n    )\r\n}","import { Route, Redirect } from \"react-router-dom\";\r\nimport { useSelector} from \"react-redux\";\r\nimport {clearErrors} from \"./errorsSlice\";\r\n\r\n\r\nexport default function ErrorHandler({children,...rest}){\r\n    const isError = useSelector((state)=> state.errors.status)\r\n\r\n\r\n\r\n\r\n    return (\r\n        <Route\r\n            {...rest}\r\n            render={({ location }) => {\r\n                return isError ? (\r\n                    <Redirect\r\n                        to={{\r\n                            pathname: \"/error\",\r\n                            state: { from: location },\r\n                        }}\r\n                    />\r\n                ) :\r\n                    children\r\n            }}\r\n        />\r\n    )\r\n}","import { Route, Redirect } from \"react-router-dom\";\r\nimport { useSelector } from \"react-redux\";\r\n\r\nexport default function PrivateRoute({ children, ...rest }) {\r\n  const isAuthenticated = useSelector((state) => state.auth.isAuthenticated);\r\n\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={({ location }) => {\r\n        return isAuthenticated ? (\r\n          children\r\n        ) : (\r\n          <Redirect\r\n            to={{\r\n              pathname: \"/login\",\r\n              state: { from: location },\r\n            }}\r\n          />\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React from \"react\";\r\n\r\nconst SettingsContext = React.createContext()\r\n\r\nexport default SettingsContext\r\n\r\n","import {setHours, setMinutes} from \"date-fns\";\r\n\r\nconst {addDays,format,nextMonday,isSameDay} = require(\"date-fns\");\r\n\r\nexport function mondayIndexed(sundayIndexed) {\r\n    return sundayIndexed === 0 ? 6 : sundayIndexed - 1\r\n}\r\n\r\nexport function weekIndex(date) {\r\n    return mondayIndexed(date.getDay())\r\n}\r\n\r\n/*\r\nfunction currentDateTime() {\r\n    return add(new Date(), {minutes: new Date().getTimezoneOffset() * -1})\r\n}\r\n*/\r\n\r\nexport function weekContaining(date) {\r\n    const daysOfWeek = [0, 1, 2, 3, 4, 5, 6]\r\n    const difference = daysOfWeek.map(day => day - weekIndex(date))\r\n    return difference.map(diff => addDays(date, diff))\r\n}\r\n\r\nexport function dayOfWeek(date){\r\n    return format(date,'iii')\r\n}\r\n\r\nexport function monthAndYear(date){\r\n    return `${format(date,'MMM')} ${format(date,'yyyy')}`\r\n}\r\n\r\nexport function previousMonday(date){\r\n    const result =nextMonday(addDays(date,-7))\r\n    result.setHours(0)\r\n    result.setMinutes(0)\r\n    return result\r\n}\r\n\r\nexport const fitsInWeek=(firstDayOfWeek,date)=>{\r\n    const endOfWeek = addDays(firstDayOfWeek,7)\r\n    if (isSameDay(firstDayOfWeek,date) || isSameDay(endOfWeek,date)){\r\n        return true\r\n    }\r\n    return (date >=firstDayOfWeek && date <=endOfWeek)\r\n}\r\n\r\nexport const mergeDateAndTime = (date,time)=>{\r\n    const hours = time.getHours()\r\n    const minutes = time.getMinutes()\r\n    return setMinutes(setHours(date,hours),minutes)\r\n}\r\n\r\nexport function setTimeDayStart(date){\r\n    return setMinutes(setHours(date,0),0)\r\n}\r\n\r\nexport function setTimeDayEnd(date){\r\n    return setTimeDayStart(addDays(date,1))\r\n}\r\n\r\nconst defaultExports = {\r\n    weekContaining,\r\n    dayOfWeek,\r\n    monthAndYear,\r\n    addDays,\r\n    previousMonday,\r\n    fitsInWeek,\r\n    mergeDateAndTime,\r\n    startOfDay: setTimeDayStart,\r\n    endOfDay: setTimeDayEnd\r\n}\r\n\r\nexport default defaultExports","import styled from \"styled-components\";\r\nimport du from \"../../utilities/dateUtilities.js\"\r\n\r\n\r\n\r\n\r\nconst DayLabelsStyled=styled.div`\r\n/*height: 80px;*/\r\n    text-align: center;\r\n    display: flex;\r\n    border-top: 1px solid lightgray;\r\n    height: 100%;\r\n    width: 100%;\r\n    border-bottom: 1px solid lightgray;\r\n    \r\n    .day{\r\n      flex: 1 0 0;\r\n      //TODO had a bit of problem here i getting borders line up\r\n      //with those from day ithink its todo with the way flex distributes \r\n      //extra space need to look into math of grow and shrink\r\n      border-left: 1px solid var(--border-color-light);\r\n      align-items: stretch;\r\n\r\n      &:last-child{\r\n        border-right: 1px solid var(--border-color-light);\r\n      }\r\n      \r\n      p {\r\n        margin: 0.5em auto 0.5em;\r\n      }\r\n  }\r\n`\r\n\r\nexport default function DayLabels({days}){\r\n    return (\r\n        <DayLabelsStyled>\r\n                {days\r\n                    .map((date,i)=>(\r\n                        <div className='day' key={i}>\r\n                            <p>{du.dayOfWeek(date)}</p>\r\n                            <p>{date.getDate()}</p>\r\n                        </div>\r\n                    ))}\r\n        </DayLabelsStyled>\r\n    )\r\n}","\r\nimport settingsContext from './Contexts'\r\nimport React from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\n\r\nconst HourTicksStyled = styled.div`\r\n  display: flex;\r\n  flex: 0 0 60px;\r\n`\r\n\r\nconst TickValuesStyled = styled.div`\r\n  flex: 0 0 15px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  \r\n  div{\r\n    flex: 1 0 0;\r\n  }\r\n  p {\r\n    color: grey;\r\n    margin: 0;\r\n    padding: 0;\r\n    font-size: 12px;\r\n    //transform: translateY(-7px);//TODO this is just a value i tried that seems to work NOW need to look a the math though so it works for all settings\r\n    margin-top: -7px;\r\n  }\r\n`;\r\n\r\n\r\n/*height:  ${props=> `${props.height}px`};*/\r\nconst TickLinesStyled = styled.div`\r\n  flex: 1 0 30px;\r\n  \r\n  display: flex;\r\n  flex-direction: column;\r\n  & .tick-line{\r\n    flex: 1 0 0;\r\n    width: 100%;\r\n    border-top: 1px solid lightgray;\r\n\r\n    &:last-child{\r\n      border-bottom: 1px solid var(--border-color-light);\r\n    }\r\n  }\r\n`\r\n\r\n\r\nfunction TickValues(){\r\n    const {borderWidth,hourHeight}=React.useContext(settingsContext)\r\n\r\n    return(\r\n        <TickValuesStyled\r\n            hourHeight={hourHeight}\r\n            borderWidth={borderWidth}\r\n\r\n        >\r\n            {[...Array(24).keys()]//TODO something weird happens when i set this to 25?\r\n                .map((index) =>\r\n                    <div className='tick-value'\r\n                        key={index}\r\n\r\n                    ><p>{index}</p></div>\r\n                )}\r\n        </TickValuesStyled>\r\n    )\r\n\r\n}\r\n\r\n\r\nfunction TickLines(){\r\n    const {borderWidth,hourHeight}=React.useContext(settingsContext)\r\n    return (<TickLinesStyled\r\n        hourHeight={hourHeight}\r\n        borderWidth={borderWidth}\r\n    >\r\n        {[...Array(24).keys()]//TODO something weird happens when i set this to 25?\r\n            .map((index) =>\r\n                <div className='tick-line'\r\n                    key={index}\r\n                    height={hourHeight}\r\n                    border={borderWidth}\r\n                />\r\n            )}\r\n    </TickLinesStyled>)\r\n}\r\n\r\nexport default function HourTicks({headerHeight}){\r\n    const {borderWidth,hourHeight}=React.useContext(settingsContext)\r\n\r\n    return (\r\n        <HourTicksStyled headerHeight={headerHeight}>\r\n            <TickValues/>\r\n            <TickLines height={hourHeight} border={borderWidth}/>\r\n        </HourTicksStyled>\r\n    )\r\n}\r\n\r\n","import { Toolbar, Typography, Button } from \"@material-ui/core\";\r\nimport { ArrowBack, ArrowForward } from \"@material-ui/icons\";\r\n\r\nimport { monthAndYear } from \"../../utilities/dateUtilities.js\";\r\n\r\n\r\n\r\nexport default function Header({\r\n  currentDate,\r\n  incrementWeek,\r\n  decrementWeek,\r\n}) {\r\n \r\n\r\n  return (\r\n    <Toolbar>\r\n      <Button onClick={decrementWeek}>\r\n        <ArrowBack />\r\n      </Button>\r\n      <Typography variant=\"h4\">{monthAndYear(currentDate)}</Typography>\r\n\r\n      <Button onClick={incrementWeek}>\r\n        <ArrowForward />\r\n      </Button>\r\n\r\n      {/* <Button\r\n        onClick={() => history.push(\"/calendar/job-form\")}\r\n        variant=\"contained\"\r\n        color=\"primary\"\r\n      >\r\n        new job\r\n      </Button> */}\r\n    </Toolbar>\r\n  );\r\n}\r\n","import auth0Client from \"../features/auth/auth0\";\r\n\r\n\r\n//TODO: should this file be in src? what should be in src and outside it generally?\r\n\r\nexport function reshape(gcalEvent){\r\n    const {start,end,id} = gcalEvent\r\n    return{\r\n        ...gcalEvent,\r\n        start: start.dateTime,\r\n        end: end.dateTime,\r\n        type: 'gcalEvent',\r\n        _id: id\r\n    }\r\n}\r\n\r\n\r\nexport async function fetchDays(from, to) {\r\n    //TODO: should we be storing access token in redux store or fetching in\r\n    // a thunk and then passing to the functions in jobs\r\n    const auth0 = await auth0Client;\r\n    const token = await auth0.getTokenSilently();\r\n\r\n    return fetch(`http://localhost:8000/api/v1/gcal/events?from=${from}&to=${to}`, {\r\n        headers: {\r\n            Authorization: `Bearer ${token}`,\r\n        },\r\n    })\r\n        .then((res) => res.json())\r\n        .then((res) => res.data.map(gcalEvent=>reshape(gcalEvent)))\r\n        // .then((data) =>\r\n        //   data.map((job) => ({\r\n        //     ...job,\r\n        //     start: new Date(job.start),\r\n        //     end: new Date(job.end), //TODO create a function that does this\r\n        //   }))\r\n        // )\r\n        .catch((err) => console.error(err));\r\n}\r\n\r\nconst exports = {\r\n    fetchDays\r\n};\r\n\r\nexport default exports\r\n","import { createSlice } from \"@reduxjs/toolkit\";\r\nimport {\r\n  weekContaining,\r\n  setTimeDayStart,\r\n  setTimeDayEnd,\r\n} from \"../../utilities/dateUtilities\";\r\nimport { addDays,parseISO } from \"date-fns\";\r\nimport jobsModel from \"../../Model/Jobs\";\r\nimport gcalEventsModel from '../../Model/gcalEvents'\r\nimport { cloneDeep } from \"lodash-es\";\r\n\r\nimport compose from \"compose-function\";\r\n\r\nexport function getWeek(date, increment = 0) {\r\n  const currentDate = addDays(new Date(date), increment * 7)\r\n  const days = weekContaining(currentDate)\r\n  const firstDay = setTimeDayStart(new Date(days[0])) //TODO\r\n  const lastDay = setTimeDayEnd(new Date(days[days.length - 1])) //TODO\r\n  return {\r\n    currentDate: currentDate.toISOString(),\r\n    days: days.map(day=>day.toISOString()),\r\n    firstDay: firstDay.toISOString(),\r\n    lastDay: lastDay.toISOString(),\r\n  };\r\n}\r\n\r\nfunction serialiseEvent(event){\r\n  return {...event,\r\n    start: event.start.toISOString(),\r\n    end: event.end.toISOString()\r\n  }\r\n}\r\n\r\nfunction unSerialiseEvent(event){\r\n  return {...event,\r\n    start: parseISO(event.start),\r\n    end: parseISO(event.end)\r\n  }\r\n}\r\n\r\nconst initialState = {\r\n  ...getWeek(new Date()),\r\n  events: [],\r\n  gcalEvents: [],\r\n  scrollPosition: 300\r\n};\r\n\r\nconst calendarSlice = createSlice({\r\n  name: \"calendar\",\r\n  initialState,\r\n  reducers: {\r\n    dataLoaded(state, action) {\r\n      state.events = action.payload;\r\n    },\r\n    gcalDataLoaded(state,action){\r\n      state.gcalEvents = action.payload\r\n    },\r\n    incrementWeek(state, action) {\r\n      return {\r\n        ...getWeek(state.currentDate, 1),\r\n        events: [],\r\n        gcalEvents: []\r\n      };\r\n    },\r\n    decrementWeek(state) {\r\n      return {\r\n        ...getWeek(state.currentDate, -1),\r\n        events: [],\r\n        gcalEvents: []\r\n      };\r\n    },\r\n    editJob(state, action) {\r\n      const { payload } = action;\r\n      const idToChange = state.events.findIndex(\r\n        (event) => event._id == payload._id\r\n      );\r\n      if (idToChange !== -1) {\r\n        state.events[idToChange] = cloneDeep(payload);\r\n      }\r\n    },\r\n    createJob(state, action) {\r\n      state.events.push(action.payload);\r\n    },\r\n    updateScrollPositions(state,action) {\r\n      state.scrollPosition = action.payload\r\n    }\r\n  },\r\n});\r\n\r\nconst { actions } = calendarSlice;\r\n\r\nexport const { updateScrollPositions} = actions\r\n\r\nconst fetchEvents = (dispatch, getState) => {\r\n  const state = getState();\r\n  jobsModel\r\n      .fetchDays(\r\n          state.calendar.firstDay.toString(),\r\n          state.calendar.lastDay.toString()\r\n      )\r\n      .then((data) => {\r\n        dispatch(actions.dataLoaded([...data])); //TODO have a look at what we are doing here what if there is no data\r\n      })\r\n      .catch(console.error);\r\n};\r\n\r\n\r\n\r\nconst fetchGcalEvents = async (dispatch,getState)=>{\r\n  const state = getState();\r\n  gcalEventsModel\r\n      .fetchDays(\r\n          state.calendar.firstDay.toString(),\r\n          state.calendar.lastDay.toString()\r\n      )\r\n      .then((data) => {\r\n        dispatch(actions.gcalDataLoaded([...data])); //TODO have a look at what we are doing here what if there is no data\r\n      })\r\n      .catch(console.error);\r\n}\r\n\r\n\r\nexport const fetchData = (dispatch, getState) => {\r\n  dispatch(fetchEvents)\r\n  const state = getState();\r\n  if (!state.auth.isAuthorizedToGcal) return\r\n  dispatch(fetchGcalEvents)\r\n};\r\n\r\n\r\n\r\nexport const incrementWeekThunk = (dispatch, getState) => {\r\n  dispatch(actions.incrementWeek());\r\n  // dispatch(fetchData);\r\n};\r\n\r\nexport const decrementWeekThunk = (dispatch, getState) => {\r\n  dispatch(actions.decrementWeek());\r\n  // dispatch(fetchData);\r\n};\r\n\r\nexport const editJobThunk = (event) => (dispatch, getState) => {\r\n  const data = serialiseEvent(event)\r\n  const { _id } = data;\r\n  console.log(data);\r\n  jobsModel\r\n    .editJob({ _id: _id, data: data })\r\n    .then((response) => {\r\n      if (response.status === \"success\") {\r\n        dispatch(actions.editJob(data));\r\n      } else if (\r\n        response.status === \"fail\" &&\r\n        response.name === \"validationError\"\r\n      ) {\r\n        console.log(\"i need validation\");\r\n      }\r\n    })\r\n    .catch(console.error);\r\n};\r\n\r\nexport const createJobThunk = (event) => (dispatch, getState) => {\r\n  const data = serialiseEvent(event)\r\n  console.log(\"108\", \"helloooooo\");\r\n  jobsModel\r\n    .createJob(data)\r\n    .then((response) => {\r\n      if (response.status === \"success\") {\r\n        console.log(\"113\", \"success\");\r\n        dispatch(actions.createJob(data));\r\n      } else if (\r\n        response.status === \"fail\" &&\r\n        response.name === \"validationError\"\r\n      ) {\r\n        console.log(\"i need validation\");\r\n      }\r\n    })\r\n    .catch(console.error);\r\n};\r\n\r\nconst filterByStartDate=(date)=>\r\n  events=> events.filter(event => new Date(event.start).getDay() === date.getDay())\r\n\r\nconst unSerialiseEvents = (events)=> events.map(event=>unSerialiseEvent(event))\r\n\r\n\r\n//TODO make this more readable\r\nexport const calendarSelectors = {\r\n  currentDate: (state)=>parseISO(state.calendar.currentDate),\r\n  days: (state)=>state.calendar.days.map(day=>parseISO(day)),\r\n  //TODO should i be unserialising here or should i do it where is use the date\r\n  events: state=>state.calendar.events.map(event=>unSerialiseEvent(event)),\r\n  eventsForDate:\r\n          date=> state=> compose(unSerialiseEvents,filterByStartDate(date))(state.calendar.events),\r\n  gcalEvents: state=>state.calendar.gcalEvents.map(event=>unSerialiseEvent(event)),\r\n  gcalEventsForDate:\r\n      date=> state=> compose(unSerialiseEvents,filterByStartDate(date))(state.calendar.gcalEvents),\r\n  eventById: id=>state=> {\r\n    const result = state.calendar.events.find((event) => event._id == id)\r\n    return unSerialiseEvent(result)\r\n  },\r\n  scrollPosition: state=>state.scrollPosition\r\n}\r\n\r\n\r\nexport default calendarSlice.reducer;\r\n","export function getNumPixels(str) {\r\n    return String(str).slice(0, str.length - 2) * 1\r\n}\r\n\r\nexport function addToPixels(withPx, num) {\r\n    return (getNumPixels(withPx) * 1 + num) + 'px'\r\n}\r\n\r\nexport function fromTop(fromBottom,containerHeight){\r\n    return containerHeight-fromBottom\r\n}\r\n\r\nexport function fromBottom(fromTop,containerHeight){\r\n    return containerHeight-fromTop\r\n}\r\n\r\nexport const roundToNearest=(inputValue,nearest)=>{\r\n    return Math.round(inputValue/nearest)*nearest\r\n}\r\n","import styled from \"styled-components\";\r\nimport {format} from \"date-fns\";\r\nimport React from \"react\";\r\n\r\nconst StyledSummaryText = styled.p`\r\n  font-family: Roboto;\r\n  font-size: 12px;\r\n  margin-top: 0px;\r\n  color: white;\r\n  font-weight: 500;\r\n`\r\n\r\nconst TimeText = styled.p`\r\n  font-family: Roboto;\r\n  font-size: 12px;\r\n  margin-top: 0px;\r\n  color: white;\r\n  font-weight: 500;\r\n  margin-bottom: 0;\r\n`\r\n\r\nexport default function EventHeading({start, end, summary}) {\r\n\r\n    return (\r\n        <>\r\n            <TimeText>{format(start, 'p') + ' - ' + format(end, 'p')}</TimeText>\r\n            <StyledSummaryText variant=\"subtitle2\">{summary}</StyledSummaryText>\r\n        </>\r\n    )\r\n\r\n}","import React from \"react\";\r\n\r\nimport useDrag from \"./useDrag\";\r\nimport styled from \"styled-components\";\r\n\r\nimport {fromTop, fromBottom, roundToNearest} from \"../../utilities/utilities\";\r\nimport settingsContext from \"./Contexts\";\r\n\r\nimport {getTimeFromPosition} from \"../../utilities/timeConversions.js\";\r\nimport {mergeDateAndTime} from \"../../utilities/dateUtilities\";\r\nimport useDetectBottomEdge from \"./useDetectBottomEdge\";\r\n\r\nimport {editJobThunk} from \"./calendarSlice\";\r\nimport {useDispatch} from \"react-redux\";\r\nimport {useHistory} from \"react-router\";\r\nimport {useEditJobMutation} from \"../api/apiSlice\";\r\n\r\nimport EventHeading from \"./EventHeading\";\r\n\r\nconst StyledEvent = styled.div`\r\n  position: absolute;\r\n  background-color: ${(props) => props.backgroundColor};\r\n  border: 0.5px solid white;\r\n  cursor: ${(props) => (props.overEdge ? \"row-resize\" : \"default\")};\r\n  padding: 0.25rem;\r\n`;\r\n\r\n\r\n\r\nexport default function Event({\r\n                                  top: topProp,\r\n                                  bottom: bottomProp,\r\n                                  left,\r\n                                  right,\r\n                                  _id,\r\n                                  start,\r\n                                  end,\r\n                                  customer,\r\n                                  backgroundColor = \"red\",\r\n                              }) {\r\n    const [top, setTop] = React.useState(topProp);\r\n    const [bottom, setBottom] = React.useState(bottomProp);\r\n    const {hourHeight} = React.useContext(settingsContext);\r\n\r\n    const history = useHistory();\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const [editJob, {isLoading}] = useEditJobMutation()\r\n\r\n    React.useEffect(() => {\r\n        setTop(topProp);\r\n        setBottom(bottomProp);\r\n    }, [topProp, bottomProp]);\r\n\r\n    const updateDisplayEvent = () => {\r\n        history.push(`calendar/job-details/${_id}`);\r\n    };\r\n\r\n    /*\r\n      TODO: write code that doesnt need this comment to make sense, once you can figure out how to.\r\n      this is used to detect whehter mouse cursor is over bottom edge and its value is then used to set\r\n      correct cursor in css\r\n      it is also used as last arg to useDrag and is checked when the drag is started to see what\r\n      drag behaviour is used*/\r\n    const {isCursorOverEdgeState, handleMouseMove, handleMouseLeave} =\r\n        useDetectBottomEdge();\r\n\r\n    function startTime(top) {\r\n        return getTimeFromPosition(top, hourHeight * 24);\r\n    }\r\n\r\n    function endTime(bottom) {\r\n        return getTimeFromPosition(hourHeight * 24 - bottom, hourHeight * 24);\r\n    }\r\n\r\n    const eventHeight = React.useRef(0);\r\n    const initialTop = React.useRef(0);\r\n    const initialBottom = React.useRef(0);\r\n\r\n    const onDragStart = React.useCallback(() => {\r\n        initialTop.current = top;\r\n        initialBottom.current = bottom;\r\n        eventHeight.current = fromTop(bottom, 24 * hourHeight) - top;\r\n    }, [top, bottom, hourHeight]);\r\n\r\n    const onDragBottomEdge = (translationY, movementY) => {\r\n        const trackedBottom = initialBottom.current - translationY;\r\n        const snappedBottom = roundToNearest(trackedBottom, hourHeight);\r\n        if (fromTop(snappedBottom, hourHeight * 24) > top) setBottom(snappedBottom);\r\n    };\r\n\r\n    const onDragElement = (translationY) => {\r\n        const tracked = initialTop.current + translationY;\r\n        const snappedTop = roundToNearest(tracked, hourHeight);\r\n        setTop(snappedTop);\r\n        const bottom = fromBottom(\r\n            snappedTop + eventHeight.current,\r\n            hourHeight * 24\r\n        );\r\n        setBottom(bottom);\r\n    };\r\n\r\n    const onDragEnd = (totalTranslationY) => {\r\n        console.log(totalTranslationY);\r\n        if (totalTranslationY !== 0) {\r\n\r\n            editJob({\r\n                _id,\r\n                start: mergeDateAndTime(start, startTime(top)),\r\n                end: mergeDateAndTime(end, endTime(bottom)),\r\n            })\r\n\r\n        } else {\r\n            updateDisplayEvent(_id);\r\n        }\r\n    };\r\n\r\n    const drag = useDrag(\r\n        onDragStart,\r\n        onDragElement,\r\n        onDragBottomEdge,\r\n        onDragEnd,\r\n        isCursorOverEdgeState\r\n    );\r\n\r\n    return (\r\n        <StyledEvent\r\n            data-component={\"event\"}\r\n            data-id={_id}\r\n            className=\"event\"\r\n            onMouseDown={(e) => {\r\n                drag(e);\r\n            }}\r\n            onMouseMove={handleMouseMove}\r\n            onMouseLeave={handleMouseLeave}\r\n            overEdge={isCursorOverEdgeState}\r\n            draggable=\"false\"\r\n            backgroundColor={backgroundColor}\r\n            style={{\r\n                backgroundColor: backgroundColor,\r\n                top: top + \"px\",\r\n                bottom: bottom + \"px\",\r\n                left,\r\n                right,\r\n            }}\r\n        >\r\n            <EventHeading start={start} end={end} summary={customer.name}/>\r\n        </StyledEvent>\r\n    );\r\n}\r\n","import React from 'react'\r\n\r\nexport default function useDetectBottomEdge(){\r\n    const [overEdge,setOverEdge]=React.useState(false)\r\n\r\n    const handleMouseMove = (e)=> {\r\n        const bottomOfEl = e.target.getBoundingClientRect().bottom\r\n        const pointerY = e.clientY\r\n        const upper = bottomOfEl - 10\r\n\r\n        if (pointerY < bottomOfEl && pointerY > upper) {\r\n            setOverEdge(true)\r\n        } else {\r\n            setOverEdge(false)\r\n        }\r\n    }\r\n\r\n    const handleMouseLeave=(e)=>{\r\n        setOverEdge(false)\r\n    }\r\n\r\n    return {isCursorOverEdgeState: overEdge,handleMouseMove,handleMouseLeave}\r\n}","import React from \"react\";\r\n\r\n\r\n/*\r\nfunction reducer(state,action){\r\n    if(action.type==='down'){\r\n        return{\r\n            ...state,\r\n            down: true,\r\n            listening: true\r\n        }\r\n    }\r\n    else if(action.type==='mouseUp'){\r\n        return{\r\n            ...state,\r\n            down: false\r\n        }\r\n    }\r\n    else if(action.type==='stopListening'){\r\n        return{\r\n            ...state,\r\n            listening: false\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport default function useDrag(mouseMoveF,mouseUpF){\r\n    const [mouse,dispatch]=React.useReducer(reducer,{\r\n        down: false,\r\n        listening: false,\r\n        up: true,\r\n    })\r\n\r\n    const totalTranslationY = React.useRef(0)\r\n    const initialTop = React.useRef(0)\r\n    const height = React.useRef(0)\r\n\r\n    const handleMouseMove = React.useCallback((e) => {\r\n        totalTranslationY.current += e.movementY\r\n        mouseMoveF(e.movementY,totalTranslationY.current,initialTop.current,height.current)\r\n    },[mouseMoveF])//added this dependancy as suggested by error message, havent givn it much thought might be wort a look if get a bug\r\n\r\n    const handleMouseUp = React.useCallback((e)=>{\r\n        console.log(document.elementFromPoint(e.clientX, e.clientY))\r\n        dispatch({type: 'mouseUp'})\r\n        mouseUpF(totalTranslationY.current)\r\n    },[mouseUpF])//added this dependancy as suggested by error message, havent givn it much thought might be wort a look if get a bug\r\n\r\n    React.useEffect(()=>{\r\n        if(mouse.down) {\r\n            window.addEventListener('mousemove', handleMouseMove)\r\n            window.addEventListener('mouseup',handleMouseUp)\r\n        }\r\n        if(!mouse.down & mouse.listening){\r\n            window.removeEventListener('mousemove',handleMouseMove)\r\n            window.removeEventListener('mouseup',handleMouseUp)\r\n            dispatch({type: 'stopListening'})\r\n        }\r\n\r\n        return ()=>{\r\n            if(mouse.listening){\r\n                window.removeEventListener('mousemove',handleMouseMove)\r\n                window.removeEventListener('mouseup',handleMouseUp)\r\n            }\r\n        }\r\n    },[mouse,handleMouseMove,handleMouseUp])//added handleMOuseMove handleMouseUp dependancy as suggested by error message, havent givn it much thought might be wort a look if get a bug\r\n\r\n    return (top,initialHeight)=>{\r\n        dispatch({type: 'down'})\r\n        totalTranslationY.current = 0\r\n        initialTop.current = top\r\n        height.current = initialHeight\r\n        console.log('height' , height.current)\r\n    }\r\n}\r\n\r\n*/\r\n\r\n\r\n/*function reducer(state,action){\r\n    if(action.type==='down'){\r\n        return{\r\n            ...state,\r\n            down: true,\r\n            listening: true\r\n        }\r\n    }\r\n    else if(action.type==='mouseUp'){\r\n        return{\r\n            ...state,\r\n            down: false\r\n        }\r\n    }\r\n    else if(action.type==='stopListening'){\r\n        return{\r\n            ...state,\r\n            listening: false\r\n        }\r\n    }\r\n}*/\r\n\r\n\r\nexport default function useDrag(onDragStart,dragElementF,dragBottomEdgeF,mouseUpF,overEdge){\r\n    const [drag,setDrag]=React.useState(false)\r\n    const totalTranslationY = React.useRef(0)\r\n\r\n\r\n    const handleDragElement = React.useCallback((e) => {\r\n        totalTranslationY.current += e.movementY\r\n        dragElementF(totalTranslationY.current,e.movementY)\r\n    },[dragElementF])//added this dependancy as suggested by error message, havent givn it much thought might be wort a look if get a bug\r\n\r\n    const handleDragBottomEdge = React.useCallback((e) => {\r\n        totalTranslationY.current += e.movementY\r\n        dragBottomEdgeF(totalTranslationY.current,e.movementY)\r\n    },[dragBottomEdgeF])\r\n\r\n    const handleMouseUp = React.useCallback((e)=>{\r\n       setDrag(false)\r\n        mouseUpF(totalTranslationY.current)\r\n    },[mouseUpF])//added this dependancy as suggested by error message, havent givn it much thought might be wort a look if get a bug\r\n\r\n    React.useEffect(()=>{\r\n        if(drag==='body') {\r\n            window.addEventListener('mousemove', handleDragElement)\r\n            window.addEventListener('mouseup',handleMouseUp)\r\n        }\r\n\r\n        if(drag==='edge') {\r\n            window.addEventListener('mousemove', handleDragBottomEdge)\r\n            window.addEventListener('mouseup',handleMouseUp)\r\n        }\r\n\r\n        return ()=>{\r\n                window.removeEventListener('mousemove',handleDragElement)\r\n                window.removeEventListener('mousemove',handleDragBottomEdge)\r\n                window.removeEventListener('mouseup',handleMouseUp)\r\n        }\r\n    },[drag,handleDragElement,handleDragBottomEdge,handleMouseUp])//added handleMOuseMove handleMouseUp dependancy as suggested by error message, havent givn it much thought might be wort a look if get a bug\r\n\r\n    return (e)=>{\r\n        e.preventDefault()\r\n        setDrag(overEdge ? 'edge' : 'body')\r\n        onDragStart()\r\n        totalTranslationY.current = 0\r\n    }\r\n}\r\n\r\n\r\n","import React from \"react\";\r\n\r\n\r\nimport styled from 'styled-components'\r\nimport EventHeading from \"./EventHeading\";\r\nimport {useHistory} from \"react-router-dom\";\r\n\r\n\r\nconst StyledEvent = styled.div`\r\n  position: absolute;\r\n  background-color: blue;\r\n  border: 0.5px solid white;\r\n  cursor: ${(props) => (props.overEdge ? \"row-resize\" : \"default\")};\r\n  padding: 0.25rem;\r\n`;\r\n\r\n\r\n\r\nexport default function GcalEvent({\r\n                                  top: topProp,\r\n                                  bottom: bottomProp,\r\n                                  left,\r\n                                  right,\r\n                                  _id,\r\n                                  start,\r\n                                  end,\r\n                                  updateEvent,\r\n                                  updateDisplayEvent,\r\n                                      summary\r\n                              }) {\r\n\r\n    const [top, setTop] = React.useState(topProp)\r\n    const [bottom, setBottom] = React.useState(bottomProp)\r\n    //const {hourHeight} = React.useContext(settingsContext)\r\n\r\n    let history = useHistory()\r\n\r\n    React.useEffect(()=>{\r\n        setTop(topProp)\r\n        setBottom(bottomProp)\r\n    },[topProp,bottomProp])\r\n\r\n    function handleCLick(){\r\n        history.push(`/calendar/gcal-details/${_id}`)\r\n    }\r\n\r\n    return (\r\n        <StyledEvent data-component={'event'}\r\n                     data-id={_id}\r\n                     className='event'\r\n\r\n                     style={{\r\n                         top: top+'px', bottom: bottom+'px', left, right\r\n                     }}\r\n                     onClick={handleCLick}\r\n        >\r\n            <EventHeading start={start} end={end} summary={summary}/>\r\n        </StyledEvent>\r\n    )\r\n}\r\n","\r\n\r\nfunction idGenerator() {\r\n    let id = 0\r\n    return () => id++  //TODO might want to look into whether this i cuasing a non unique id anywhere\r\n    //i think all event ids are coming from db now but worth a check at some point.\r\n}\r\n\r\nlet id = idGenerator()\r\n\r\nexport function timePeriod(start, end) {\r\n    return {\r\n        start: start,\r\n        end: end,\r\n        id: id()}\r\n}\r\n\r\n/*let events = [\r\n    new TimePeriod(10, 13.5),\r\n    new TimePeriod(10.5, 11.5),\r\n    new TimePeriod(13, 14),\r\n    new TimePeriod(16, 17),\r\n    new TimePeriod(15.5, 16.5),\r\n    new TimePeriod(21,23)\r\n]*/\r\n\r\n\r\n\r\n/*let groups = events.map(event => [event])*/\r\n\r\nfunction getStart(set) {\r\n    return set.map(event => event.start).reduce((a, b) => new Date(Math.min(a, b)))\r\n}\r\n\r\nfunction getEnd(set) {\r\n    return set.map(event => event.end).reduce((a, b) => new Date(Math.max(a, b)))\r\n}\r\n\r\nfunction asPeriod(set) {\r\n    return timePeriod(getStart(set), getEnd(set))\r\n}\r\n\r\nfunction overlaps(period1, period2) {\r\n    /*return period1.start <= period2.end && period2.start <= period1.end*/\r\n    return period1.start < period2.end && period2.start < period1.end\r\n\r\n}\r\n\r\nfunction negate(f){\r\n    return (...args)=>{\r\n        return !f(...args)\r\n    }\r\n}\r\n\r\n\r\n/*\r\nfunction sortAscending(arr) {\r\n    return [...arr].sort((a, b) => a - b)\r\n}\r\n*/\r\n\r\nfunction sortAscending(arr) {\r\n    return [...arr].sort((a, b) => a.start - b.start)\r\n}\r\n\r\n\r\nfunction difference(arrayA, arrayB) {\r\n    let ids = arrayA.map(event => event._id)\r\n    return arrayB.filter(event => !ids.includes(event._id))\r\n}\r\n\r\n\r\nfunction extractSet(periods, condition) {\r\n    return (\r\n        sortAscending(periods)\r\n            .reduce(\r\n                (set, period) => set.length === 0 || condition(period, asPeriod(set)) ? [...set, period] : set\r\n                , [])\r\n    )\r\n}\r\n\r\nfunction extractSetWith(condition){\r\n    return (periods)=>{\r\n        return extractSet(periods,condition)\r\n    }\r\n}\r\n\r\nfunction buildSets(periods, extractionF, sets = []) {\r\n    if (periods.length === 0) return sets\r\n    let set = extractionF(periods)\r\n    return buildSets(\r\n        difference(set, periods),\r\n        extractionF,\r\n        [...sets, set])\r\n}\r\n\r\nfunction buildSetsWith(extractionF){\r\n    return (periods)=>{\r\n        return buildSets(periods,extractionF,[])\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default function groupEvents(events){\r\n\r\n    let overlappingSets = buildSetsWith(extractSetWith(overlaps))(events)\r\n\r\n    let withColumns = overlappingSets.map(set=>{\r\n        return buildSetsWith(extractSetWith(negate(overlaps)))(set)\r\n    })\r\n    return withColumns\r\n}\r\n\r\n\r\n\r\n//console.log(overlappingSets)\r\n\r\n/*\r\nconsole.log(JSON.stringify(withColumns,null, 2))*/\r\n","import groupEvents from './groupEvents'\r\nimport {asDecimal} from '../utilities/timeConversions.js'\r\n\r\nexport function configure(height,border){\r\n    const position = (\r\n        (height, border) => {\r\n        const hours = (time) => Math.floor(time)\r\n        const minutes = (time) => time - hours(time)\r\n\r\n        return (time) => {\r\n            time = asDecimal(time)  //TODO modifying state here, please refactor.\r\n\r\n            return hours(time) * height + (hours(time) + 1) * border + height * minutes(time)//TODO need to make this more declaritive\r\n        }\r\n    })(height,border)\r\n\r\n    const widthOfCol = (cols) => 100 / cols.length\r\n\r\n    const left = (colIndex, cols) => colIndex * widthOfCol(cols)\r\n\r\n\r\n\r\n\r\n    function eventGeometry(event,colIndex,cols) {\r\n        const {start, end} = event\r\n        return {\r\n            ...event,\r\n            top: position(start),\r\n            bottom: (height*24) - position(end),\r\n            left: String(left(colIndex,cols)) + '%',\r\n            right: String(100 - (left(colIndex,cols) + widthOfCol(cols))) + '%'\r\n        }\r\n    }\r\n\r\n    function flatDeep(arr, d = 1) {\r\n        return d > 0 ? arr.reduce((acc, val) => acc.concat(Array.isArray(val) ? flatDeep(val, d - 1) : val), [])\r\n            : arr.slice();\r\n    };\r\n\r\n\r\n\r\n    return function eventsGeometry(events) {\r\n\r\n\r\n\r\n\r\n        let result =  groupEvents(events).map(\r\n            overlappingGroup => overlappingGroup\r\n                .map((col, colIndex) => {\r\n                    return col.map((event, eventIndex) => (\r\n                        eventGeometry(event,colIndex,overlappingGroup,height,border)\r\n                    ))\r\n                })\r\n        )\r\n        return flatDeep(result,Infinity)\r\n    }\r\n}\r\n\r\n","function addBatchNumber(arr,number){\r\n    return arr.map(obj=>({...obj,batch: number}))\r\n}\r\n\r\nfunction removeBatchProp(obj){\r\n    const {batch ,...rest} = obj;\r\n    return rest\r\n}\r\n\r\nfunction removeBatchProps(arr){\r\n    return arr.map(obj=>removeBatchProp(obj))\r\n}\r\n\r\n\r\n\r\nexport function batchProcess(array1,array2,f){\r\n    //TODO check objects dont already have a batch prop\r\n\r\n    const result = f([...addBatchNumber(array1,1),...addBatchNumber(array2,2)])\r\n    const batch1 = result.filter(obj=>obj.batch===1)\r\n    const batch2 = result.filter(obj=>obj.batch===2)\r\n\r\n\r\n\r\n    return [removeBatchProps(batch1),removeBatchProps(batch2)]\r\n}\r\n\r\n/*\r\nconst one = [{name: 'gregor'},{name: 'gregor'}]\r\nconst two = [{name: 'jimmy'}]\r\n\r\nfunction f(arr){\r\n    return arr.map(obj=> ({...obj,name: obj.name.toUpperCase()}))\r\n}\r\n\r\n\r\nconsole.log(batchProcess(one,two,f))\r\n*/\r\n","import Event from './Event'\r\nimport GcalEvent from \"./gcalEvent\";\r\nimport {configure} from \"../../eventGeometry/eventGeometry\";\r\nimport React, {useCallback, useMemo} from \"react\";\r\nimport settingsContext from \"./Contexts\";\r\nimport {batchProcess} from \"../../utilities/batchProcess\";\r\nimport {useSelector} from \"react-redux\";\r\nimport {calendarSelectors} from \"./calendarSlice\";\r\nimport {useGetJobsQuery,useGetGcalQuery,usePrefetch} from \"../api/apiSlice\";\r\nimport { createSelector } from '@reduxjs/toolkit'\r\nimport compose from \"compose-function\";\r\nimport {parseISO,addDays} from \"date-fns\";\r\n\r\n\r\nconst filterByStartDate=(date)=>\r\n    events=> events.filter(event => new Date(event.start).getDay() === date.getDay())\r\n\r\nfunction unSerialiseEvent(event){\r\n    return {...event,\r\n        start: parseISO(event.start),\r\n        end: parseISO(event.end)\r\n    }\r\n}\r\n\r\nconst unSerialiseEvents = (events)=> events.map(event=>unSerialiseEvent(event))\r\n\r\nexport default function Events({date}) {\r\n    const {hourHeight}=React.useContext(settingsContext)\r\n    const eventsGeometry = configure(hourHeight, 0)\r\n    const prefetchGcal = usePrefetch('getGcal')\r\n\r\n    const firstDay = useSelector(state=>state.calendar.firstDay)\r\n    const lastDay = useSelector(state=>state.calendar.lastDay)\r\n\r\n    React.useEffect(()=>{\r\n         prefetchGcal({from: lastDay, to: addDays(new Date(lastDay),7).toISOString()})\r\n        prefetchGcal({from: addDays(new Date(firstDay),-7).toISOString(), to: firstDay})\r\n     },[firstDay,lastDay])\r\n\r\n    const selectJobsForDate = useMemo(\r\n        ()=>{\r\n            return createSelector(\r\n                res=>res.data || [], //adding this ' || []' solved a bug\r\n                (res,date)=>date,\r\n                (data,date)=>compose(unSerialiseEvents,filterByStartDate(date))(data)\r\n            )\r\n        },[])\r\n\r\n    const {jobsForDate} = useGetJobsQuery({from: firstDay, to: lastDay},{\r\n        selectFromResult: result=>({\r\n            jobsForDate: selectJobsForDate(result,date)\r\n        })\r\n    })\r\n\r\n    const selectGcalForDate = useMemo(\r\n        ()=>{\r\n            return createSelector(\r\n                res=>res.data || [], //adding this ' || []' solved a bug\r\n                (res,date)=>date,\r\n                (data,date)=>compose(unSerialiseEvents,filterByStartDate(date))(data)\r\n            )\r\n        },[])\r\n\r\n    const {gcalForDate} = useGetGcalQuery({from: firstDay, to: lastDay},{\r\n        selectFromResult: result=>({\r\n            gcalForDate: selectGcalForDate(result,date)\r\n        })\r\n    })\r\n\r\n    // const {data: jobs = []} = useGetJobsQuery({from: firstDay, to: lastDay})\r\n    //\r\n    // console.log(jobs)\r\n    //\r\n    // const jobsForDate= compose(unSerialiseEvents,filterByStartDate(date))(jobs)\r\n    //\r\n    // console.log(jobsForDate)\r\n\r\n\r\n    // const events = useSelector(calendarSelectors.eventsForDate(date))\r\n    // const gcalEvents = useSelector(calendarSelectors.gcalEventsForDate(date))\r\n\r\n    const [eventsProcessed,gcalProcessed] = batchProcess(jobsForDate,gcalForDate || [],eventsGeometry)\r\n\r\n    return (\r\n       /* eventsGeometry(events)*/\r\n            [...eventsProcessed\r\n            .map(\r\n                (evnt, i) => {\r\n                    return <Event\r\n                        {...evnt}\r\n                        key={evnt._id}\r\n                    />\r\n                }\r\n                ),\r\n                ...gcalProcessed.map(\r\n                (evnt, i) => {\r\n                    return <GcalEvent\r\n                        {...evnt}\r\n                        key={evnt.id}\r\n                    />\r\n                }\r\n            )\r\n            ]\r\n    )\r\n}\r\n","import React from \"react\";\r\nimport styled from \"styled-components\";\r\nimport settingsContext from \"./Contexts\";\r\nimport { useHistory } from \"react-router\";\r\nimport { formatISO } from \"date-fns\";\r\n\r\nconst HoursStyled = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n`;\r\n\r\nconst HourStyled = styled.div`\r\n  flex: 1 0 0;\r\n  border-top: 1px dotted lightgray;\r\n  scroll-snap-align: center;  //this also requires snap-type property on Scroll Portal component\r\n\r\n  &:last-child {\r\n    border-bottom: ${(props) =>\r\n      `${props.borderWidth}px solid var(--border-color-light)`};\r\n  }\r\n  \r\n  \r\n  \r\n`;\r\n\r\nexport default function Hours({ className, date }) {\r\n  const { borderWidth, hourHeight } = React.useContext(settingsContext);\r\n  const history = useHistory();\r\n\r\n  const handleClick = (hour) => {\r\n    history.push(\r\n      `/calendar/create-job-form?hour=${String(hour)}&iso-date=${formatISO(\r\n        date,\r\n        { representation: \"date\" }\r\n      )}`\r\n    );\r\n  };\r\n\r\n  return (\r\n    <HoursStyled>\r\n      {[...Array(24).keys()].map((index) => (\r\n        <HourStyled\r\n          key={index}\r\n          data-hour={String(index)}\r\n          hourHeight={hourHeight}\r\n          borderWidth={borderWidth}\r\n          className={className}\r\n          draggable=\"false\"\r\n          onClick={() => handleClick(index)}\r\n        >\r\n\r\n        </HourStyled>\r\n      ))}\r\n    </HoursStyled>\r\n  );\r\n}\r\n","import styled from \"styled-components\";\r\n\r\nimport DayLabels from \"./DayLabels\";\r\nimport HourTicks from \"./HourTicks\";\r\n\r\nimport Header from \"./Header\";\r\nimport settingsContext from \"./Contexts\";\r\n\r\nimport React, {useRef} from \"react\";\r\n\r\nimport {incrementWeekThunk, decrementWeekThunk, updateScrollPositions} from \"./calendarSlice\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\n\r\nimport {calendarSelectors} from \"./calendarSlice\";\r\nimport Events from \"./Events\";\r\nimport Hours from \"./Hours\";\r\nimport {useGetJobsQuery} from \"../api/apiSlice\";\r\n\r\nconst CalendarStyled = styled.div`\r\n  margin: 5px;\r\n`;\r\n\r\nconst Corner = styled.div`\r\n  flex: 0 0 60px;\r\n`\r\n\r\nconst Row = styled.div`\r\n  display: flex;\r\n  background-color: transparent;\r\n\r\n  &:nth-child(2) {\r\n    flex: 1 0 0;\r\n  }\r\n`\r\n\r\nconst WeekStyled = styled.div`\r\n  display: flex;\r\n  height: ${props => `${props.hourHeight * 24}px`};\r\n  flex: 1 0 0;\r\n`\r\n\r\n\r\nconst DayStyled = styled.div`\r\n  position: relative;\r\n  //TODO had a bit of problem here i getting borders line up\r\n  //with those from Header ithink its todo with the way flex distributes \r\n  //extra space need to look into math of grow and shrink\r\n  border-left: 1px solid var(--border-color-light);\r\n  flex: 1 0 0;\r\n\r\n  &:last-child {\r\n    border-right: 1px solid var(--border-color-light);\r\n  }\r\n`\r\n\r\nconst ScrollPortal = styled.div`\r\n  width: 100%;\r\n  overflow: scroll;\r\n  margin: 0;\r\n  padding: 0;\r\n  height: 80vh;\r\n  //also requires scroll-snap-align property on Hours component\r\n  //Todo consider making more elegant e.g. not having components depending on css in other components\r\n  scroll-snap-type: y mandatory;  \r\n  &::-webkit-scrollbar {\r\n    display: none;\r\n  }\r\n\r\n`\r\n\r\n\r\nexport default function Calendar() {\r\n    const dispatch = useDispatch();\r\n\r\n    const {hourHeight} = React.useContext(settingsContext);\r\n    const {scrollPosition} = React.useState(0)\r\n\r\n   /* const scrollPosition = useSelector(state => state.calendar.scrollPosition)\r\n\r\n    const rowEl = React.useRef(null)\r\n\r\n    const initialScrollSet = React.useRef(null)\r\n\r\n    React.useEffect(()=>{\r\n      if(!initialScrollSet.current){\r\n        rowEl.current.scrollTop =scrollPosition\r\n        console.log(rowEl.current.scrollTop)\r\n        initialScrollSet.current = true\r\n      }\r\n    },[rowEl])\r\n\r\n    function handleScroll(e) {\r\n        dispatch(updateScrollPositions(e.target.scrollTop))\r\n    }*/\r\n\r\n    function handleScroll(e){\r\n        rowEl.current.scrollTop +=30\r\n    }\r\n    const rowEl = React.useRef(null)\r\n\r\n    const initialScrollSet = React.useRef(null)\r\n\r\n    React.useEffect(()=>{\r\n        if(!initialScrollSet.current){\r\n            rowEl.current.scrollTop =300\r\n            console.log(rowEl.current.scrollTop)\r\n            initialScrollSet.current = true\r\n        }\r\n    },[rowEl])\r\n\r\n    const incrementWeek = () => {\r\n        dispatch(incrementWeekThunk);\r\n    };\r\n\r\n    const decrementWeek = () => {\r\n        dispatch(decrementWeekThunk);\r\n    };\r\n\r\n    const currentDate = useSelector(calendarSelectors.currentDate);\r\n    const days = useSelector(calendarSelectors.days);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <CalendarStyled hourHeight={hourHeight}>\r\n                <Row>\r\n                    <Corner className='corner'/>\r\n                    <Header\r\n                        currentDate={currentDate}\r\n                        incrementWeek={incrementWeek}\r\n                        decrementWeek={decrementWeek}\r\n                    />\r\n                </Row>\r\n                <Row>\r\n                    <Corner/>\r\n                    <DayLabels days={days}/>\r\n                </Row>\r\n                <ScrollPortal ref={rowEl} >\r\n                    <Row>\r\n                        <HourTicks/>\r\n                        <WeekStyled hourHeight={hourHeight}>\r\n                            {days.map((date, i) => (\r\n                                <DayStyled key={i}>\r\n                                    <Events\r\n                                        date={date}\r\n                                    />\r\n                                    <Hours date={date}/>\r\n                                </DayStyled>\r\n                            ))}\r\n                        </WeekStyled>\r\n                    </Row>\r\n                </ScrollPortal>\r\n\r\n            </CalendarStyled>\r\n        </React.Fragment>\r\n    );\r\n}\r\n","import styled from \"styled-components\";\r\nimport React from \"react\";\r\n\r\n\r\nconst BackGround = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  background-color: rgba(1, 1, 1, 0.2);\r\n  display: flex;\r\n  justify-content: space-around;\r\n  align-items: center;\r\n`\r\n\r\n/*\r\nconst ModalStyled = styled.div`\r\n  background-color: white;\r\n  padding: 1.5em;\r\n`\r\n*/\r\n\r\nexport default function Modal({children}){\r\n    return (\r\n        <BackGround>\r\n                    {children}\r\n        </BackGround>\r\n    )\r\n}","import Modal from \"../../components/Modal\";\r\nimport {Card, CardContent, CardHeader, IconButton} from \"@material-ui/core\";\r\n\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport React from \"react\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport PersonIcon from \"@material-ui/icons/Person\";\r\nimport PhoneIcon from \"@material-ui/icons/Phone\";\r\nimport EmailIcon from \"@material-ui/icons/Email\";\r\nimport AccessibilityIcon from '@material-ui/icons/Accessibility';\r\nimport HomeIcon from '@material-ui/icons/Home';\r\n\r\n\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\n\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\n\r\n\r\nimport {useParams, useHistory} from \"react-router\";\r\nimport {useSelector} from \"react-redux\";\r\nimport {useGetJobQuery} from \"../api/apiSlice\";\r\nimport {useLocation} from \"react-router-dom\";\r\n\r\nimport {format} from 'date-fns'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    title: {\r\n        fontSize: 14,\r\n        fontWeight: \"bold\",\r\n        fontVariant: \"small-caps\",\r\n        color: \"#324191\",\r\n    },\r\n    group: {\r\n        marginBottom: \"0.5em\",\r\n    },\r\n    content: {\r\n        paddingTop: 0,\r\n    },\r\n    li: {\r\n        listStyle: \"none\",\r\n        padding: 0,\r\n        margin: 0,\r\n    },\r\n    container: {\r\n        marginTop: 20,\r\n        backgroundColor: \"#F3F3FB\",\r\n    },\r\n    list: {\r\n        padding: 0,\r\n        \"& > li\": {\r\n            padding: 0,\r\n        },\r\n    },\r\n    pricing: {\r\n        marginTop: theme.spacing(2), //TODO use row class for top margin\r\n        textAlign: \"center\",\r\n    },\r\n    items: {\r\n        whiteSpace: \"pre-line\",\r\n    },\r\n    row: {\r\n        marginTop: theme.spacing(2),\r\n    },\r\n}));\r\n\r\n\r\nexport function JobDetails({displayEvent, close, updateEvent}) {\r\n    const classes = useStyles();\r\n    const location = useLocation()\r\n\r\n    //TODO\r\n    //returns /calendar/job-details/ckx30y8w2000jpgvags8peqpc\r\n    console.log(location.pathname)\r\n    //may use to know what screen JobDetails has been launched from and select from the\r\n    //the apropriate query to get the data rather than do another network request.\r\n\r\n\r\n    const history = useHistory();\r\n\r\n    let {id} = useParams();\r\n\r\n    console.log(id);\r\n\r\n    // let job = useSelector((state) =>\r\n    //   state.calendar.events.find((event) => event._id == id)\r\n    // );\r\n\r\n    let {data: job, isFetching} = useGetJobQuery(id);\r\n\r\n    console.log(job)\r\n    console.log(isFetching)\r\n\r\n\r\n    //const { start, end, customer, charges, operatives, items, addresses } = job;\r\n    //const { customer } = displayEvent;\r\n\r\n    //TODO: map over operatives\r\n\r\n    const CustomerDetails = ({customer}) => (\r\n        <Card className={classes.card}>\r\n            <CardHeader title={\"Customer Details\"}></CardHeader>\r\n            <CardContent>\r\n                <List className={classes.list}>\r\n                    <ListItem>\r\n                        <ListItemIcon>\r\n                            <PersonIcon/>\r\n                        </ListItemIcon>\r\n                        <ListItemText primary={customer.name} secondary=\"name\"/>\r\n                    </ListItem>\r\n                    <ListItem>\r\n                        <ListItemIcon>\r\n                            <PhoneIcon/>\r\n                        </ListItemIcon>\r\n                        <ListItemText\r\n                            primary={customer.mobile}\r\n                            secondary=\"mobile\"\r\n                        />\r\n                    </ListItem>\r\n                    <ListItem>\r\n                        <ListItemIcon>\r\n                            <EmailIcon/>\r\n                        </ListItemIcon>\r\n                        <ListItemText\r\n                            primary={customer.email}\r\n                            secondary=\"email\"\r\n                        />\r\n                    </ListItem>\r\n                </List>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n\r\n    const Charges = ({charges}) => (\r\n        <Grid container spacing={1} className={classes.pricing}>\r\n            <Grid item xs={4}>\r\n                <Card>\r\n                    <CardHeader\r\n                        title={charges.hourlyRate}\r\n                        subheader={\"per hour\"}\r\n                    />\r\n                </Card>\r\n            </Grid>\r\n            <Grid item xs={4}>\r\n                <Card>\r\n                    <CardHeader\r\n                        title={charges.fuelCharge}\r\n                        subheader={\"fuel charge\"}\r\n                    />\r\n                </Card>\r\n            </Grid>\r\n            <Grid item xs={4}>\r\n                <Card>\r\n                    <CardHeader\r\n                        title={charges.travelTime}\r\n                        subheader={\"travel time\"}\r\n                    />\r\n                </Card>\r\n            </Grid>\r\n        </Grid>\r\n    )\r\n\r\n    const Times = ({start, end}) => {\r\n        console.log(typeof format)\r\n\r\n        return (\r\n            <Grid container spacing={1} className={classes.pricing}>\r\n                <Grid item xs={4}>\r\n                    <Card>\r\n                        <CardHeader\r\n                            title={format(new Date(start), 'PP')}\r\n                            subheader={\"date\"}\r\n                        />\r\n                    </Card>\r\n                </Grid>\r\n                <Grid item xs={4}>\r\n                    <Card>\r\n                        <CardHeader\r\n                            title={format(new Date(start), 'p')}\r\n                            subheader={\"start time\"}\r\n                        />\r\n                    </Card>\r\n                </Grid>\r\n                <Grid item xs={4}>\r\n                    <Card>\r\n                        <CardHeader\r\n                            title={format(new Date(end), 'p')}\r\n                            subheader={\"end time\"}\r\n                        />\r\n                    </Card>\r\n                </Grid>\r\n            </Grid>\r\n        )\r\n\r\n    }\r\n\r\n    const Operatives = ({operatives})=>(\r\n        <Card>\r\n            <CardHeader title={\"operatives\"}/>\r\n            <List>\r\n                {(operatives || []).map(operative=>(\r\n                    <ListItem>\r\n                        <ListItemIcon>\r\n                            <AccessibilityIcon />\r\n                        </ListItemIcon>\r\n                        <ListItemText primary={operative.value}/>\r\n                    </ListItem>\r\n                ))}\r\n            </List>\r\n        </Card>\r\n    )\r\n\r\n    const Addresses = ({addresses=[]})=>(\r\n        <Card  className={classes.row}>\r\n            <CardHeader title={\"Addresses\"}/>\r\n            <List>\r\n                {addresses.map(address=>(\r\n                    <ListItem>\r\n                        <ListItemIcon>\r\n                            <HomeIcon />\r\n                        </ListItemIcon>\r\n                        <ListItemText primary={address.value}/>\r\n                    </ListItem>\r\n                ))}\r\n            </List>\r\n        </Card>\r\n    )\r\n\r\n\r\n    if (isFetching) {\r\n        return null\r\n    } else {\r\n        const {customer, charges, items, addresses, operatives, start, end} = job;\r\n        return (\r\n            <Modal>\r\n                <Card style={{width: 1200, backgroundColor: \"#F3F3FB\"}}>\r\n                    <CardHeader\r\n                        title={customer.name}\r\n                        action={\r\n                            <>\r\n                                <IconButton\r\n                                    onClick={() => {\r\n                                        history.push(`/calendar/edit-job-form/${id}`);\r\n                                    }}\r\n                                >\r\n                                    <EditIcon/>\r\n                                </IconButton>\r\n                                <IconButton\r\n                                    onClick={() => {\r\n                                        history.push(\"/calendar\");\r\n                                    }}\r\n                                >\r\n                                    <CloseIcon/>\r\n                                </IconButton>\r\n                            </>\r\n                        }\r\n                    />\r\n                    <CardHeader/>\r\n                    <CardContent className={classes.content}>\r\n                        <Grid container spacing={3}>\r\n                            <Grid item xs={4}>\r\n                                <CustomerDetails customer={customer}/>\r\n                                <Charges charges={charges}/>\r\n                                <Times start={start} end={end}/>\r\n                            </Grid>\r\n\r\n                            <Grid item xs={4}>\r\n                                <Card>\r\n                                    <CardHeader title={\"Items\"}/>\r\n                                    <CardContent className={classes.items}>{items}</CardContent>\r\n                                </Card>\r\n                            </Grid>\r\n                          <Grid item xs={4}>\r\n                           <Operatives operatives={operatives}/>\r\n                              <Addresses addresses={addresses}/>\r\n                          </Grid>\r\n                        </Grid>\r\n                    </CardContent>\r\n                </Card>\r\n            </Modal>\r\n\r\n        )\r\n    }\r\n}\r\n","import styled from \"styled-components\";\r\nimport {Card, CardContent, CardHeader, IconButton, ListItemText} from \"@material-ui/core\";\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Modal from  '../../components/Modal'\r\nimport {useParams} from \"react-router-dom\";\r\nimport {useGetGcalQuery} from \"../api/apiSlice\";\r\nimport {useMemo} from \"react\";\r\nimport { createSelector } from '@reduxjs/toolkit'\r\nimport {useSelector} from \"react-redux\";\r\nimport List from \"@material-ui/core/List\";\r\nimport {ListItem,ListItemIcon} from \"@material-ui/core\";\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport EventIcon from '@material-ui/icons/Event';\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\nimport {Toolbar} from \"@material-ui/core\";\r\nimport SubjectIcon from '@material-ui/icons/Subject';\r\nimport {format} from \"date-fns\";\r\nimport {isSameDay} from \"date-fns\";\r\nimport {useHistory} from \"react-router-dom\";\r\n\r\n\r\n\r\nconst useStyles = makeStyles((theme)=>({\r\n    header:{\r\n        paddingBottom: 0\r\n    },\r\n    content: {\r\n        paddingTop: 0,\r\n        overflowY: 'auto',\r\n        maxHeight: '85vh'\r\n    },\r\n    description: {\r\n        whiteSpace: \"pre-wrap\"\r\n    },\r\n    modal: {\r\n        width: 448\r\n    },\r\n    toolbar: {\r\n        justifyContent: \"flex-end\",\r\n        minHeight: 0,\r\n        paddingTop: theme.spacing(2)\r\n    },\r\n    list: {\r\n        paddingTop: 0,\r\n    },\r\n    firstItem: {\r\n        paddingTop: 0\r\n    }\r\n}))\r\n\r\n\r\nconst container = styled.div`\r\n  top: auto;\r\n  bottom: auto;\r\n  left: auto;\r\n  right: auto;\r\n  position: absolute;\r\n`\r\n\r\n\r\nexport function GcalDetails(){\r\n    const {id}=useParams()\r\n    const history = useHistory()\r\n\r\n    console.log(id)\r\n\r\n    const classes = useStyles()\r\n\r\n\r\n    const selectGcalEvent = useMemo(()=>{\r\n        return createSelector(\r\n            res => {\r\n                console.log(res.data)\r\n                return res.data || []\r\n            },\r\n            (res,id) => id,\r\n            (data,id) => {\r\n                console.log(data)\r\n                console.log(id)\r\n                const result =  data?.find(gcalEvent => gcalEvent.id === id) ?? {}\r\n                console.log(result)\r\n                return result\r\n            }\r\n        )\r\n\r\n    },[])\r\n\r\n    const firstDay = useSelector(state=>state.calendar.firstDay)\r\n    const lastDay = useSelector(state=>state.calendar.lastDay)\r\n\r\n    const {gcalEvent} = useGetGcalQuery({from: firstDay, to: lastDay},{\r\n        selectFromResult: (result)=>({\r\n            gcalEvent: selectGcalEvent(result,id)  //name of this field must be the same as name of prop we destructure\r\n        })\r\n    })\r\n\r\n    console.log(gcalEvent)\r\n\r\n    const {summary} = gcalEvent\r\n\r\n    const start = new Date(gcalEvent?.start)\r\n    const end = new Date(gcalEvent?.end)\r\n\r\n    console.log(start)\r\n\r\n    function formatDateString(start,end){\r\n        if(isSameDay(start,end)){\r\n            return format(start,\"EEEE do MMM H':'mm\") + ' - ' + format(end,\"H':'mm\")\r\n        }\r\n        return format(start,\"EEEE do MMM H':'mm\") + ' - ' + format(start,\"EEEE do MMM H':'mm\")\r\n    }\r\n\r\n    function htmlBlobToString(htmlBlob){\r\n        if(!htmlBlob) return ''\r\n        return htmlBlob.replace('<html-blob>','')\r\n            .replaceAll('<br><br>','\\n')\r\n            .replaceAll('<br>','')\r\n            .replaceAll(/<[^<>]+>/gi, \"\")\r\n    }\r\n\r\n    function handleClose(){\r\n        history.push('/calendar')\r\n    }\r\n\r\n    return (\r\n        <Modal >\r\n\r\n            <Card className={classes.modal}  >\r\n                <Toolbar className={classes.toolbar}>\r\n                    <IconButton>\r\n                        <CloseIcon onClick={handleClose}/>\r\n                    </IconButton>\r\n                </Toolbar>\r\n                <CardContent className={classes.content}>\r\n                    <List className={classes.list}>\r\n                        <ListItem className={classes.firstItem}>\r\n                            <ListItemIcon><EventIcon/></ListItemIcon>\r\n                            <ListItemText\r\n                                primary={gcalEvent.summary}\r\n                                secondary={formatDateString(start,end)}\r\n                                primaryTypographyProps={{variant: 'h5'}}\r\n                            />\r\n                        </ListItem>\r\n                        <ListItem alignItems=\"flex-start\">\r\n                            <ListItemIcon><SubjectIcon/></ListItemIcon>\r\n                            <ListItemText primary={htmlBlobToString(gcalEvent?.description)} className={classes.description} primaryTypographyProps={{variant: 'body2'}}/>\r\n                        </ListItem>\r\n                    </List>\r\n                </CardContent>\r\n            </Card>\r\n        </Modal>\r\n    )\r\n}","import React from \"react\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport {\r\n  Grid,\r\n  ListItemAvatar,\r\n  ListItemSecondaryAction,\r\n  ListItemText,\r\n  TextField,\r\n  Typography,\r\n} from \"@material-ui/core\";\r\nimport HouseIcon from \"@material-ui/icons/House\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\n\r\n\r\nimport cuid from \"cuid\";\r\nimport produce from \"immer\";\r\n\r\n\r\n\r\n\r\nexport function ListBuilder({\r\n  name,\r\n  value = [],\r\n  onChange,\r\n  label,\r\n  errors,\r\n  itemName,\r\n}) {\r\n  //TODO should maybe be thinking about a shared constructor for this\r\n  //we are making an object like this on api as well\r\n\r\n  function wrap(value) {\r\n    return {\r\n      _id: cuid(),\r\n      value,\r\n    };\r\n  }\r\n\r\n  const addAddress = (value, address) => {\r\n    const updatedValue = produce(value, (draft) => {\r\n      draft.push(wrap(address));\r\n    });\r\n    const e = {\r\n      target: {\r\n        value: updatedValue,\r\n        name: name,\r\n      },\r\n    };\r\n    onChange(e);\r\n  };\r\n\r\n  const removeAddress = (value, id) => {\r\n    const updatedValue = produce(value, (draft) => {\r\n      return draft.filter((el) => el._id !== id);\r\n    });\r\n    const e = {\r\n      target: {\r\n        value: updatedValue,\r\n        name: name,\r\n      },\r\n    };\r\n    onChange(e);\r\n  };\r\n\r\n  const [input, setInput] = React.useState(\"\");\r\n\r\n\r\n\r\n  function getError(index) {\r\n    if (errors && errors[index]) {\r\n      return errors[index].value;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <List dense>\r\n        {value &&\r\n          value.map((a, i) => (\r\n            <ListItem key={a._id}>\r\n              <ListItemAvatar>\r\n                <HouseIcon></HouseIcon>\r\n              </ListItemAvatar>\r\n              <ListItemText\r\n                //className={classes.inline}\r\n                primary={\r\n                  <>\r\n                    <Typography variant={\"body1\"} display=\"inline\">\r\n                      {a.value}\r\n                    </Typography>\r\n                    {getError(i) ? (\r\n                      <Typography variant=\"caption\" color=\"error\">\r\n                        {`  - ${getError(i)}`}\r\n                      </Typography>\r\n                    ) : (\r\n                      <Typography variant=\"caption\">\r\n                        {\" \"}\r\n                        - {itemName}\r\n                        {i + 1}\r\n                      </Typography>\r\n                    )}\r\n                  </>\r\n                }\r\n                disableTypography\r\n              />\r\n              <ListItemSecondaryAction>\r\n                <CloseIcon\r\n                  color=\"primary\"\r\n                  onClick={(e) => {\r\n                    e.preventDefault();\r\n                    removeAddress(value, a._id);\r\n                  }}\r\n                />\r\n              </ListItemSecondaryAction>\r\n            </ListItem>\r\n          ))}\r\n      </List>\r\n      <Grid item>\r\n        <TextField\r\n          label={label}\r\n          value={input}\r\n          fullWidth\r\n          onChange={(e) => {\r\n            setInput(e.target.value);\r\n          }}\r\n        />\r\n        <button\r\n          onClick={(e) => {\r\n            e.preventDefault();\r\n            addAddress(value, input);\r\n            setInput(\"\");\r\n          }}\r\n        >\r\n          +\r\n        </button>\r\n      </Grid>\r\n    </>\r\n  );\r\n}\r\n","const {  set } = require(\"lodash\");\r\n\r\nfunction convertToLodashDotPath(mongooseDotPath) {\r\n  return mongooseDotPath.replace(/\\d+/g, (match) => {\r\n    return `[${match}]`;\r\n  });\r\n}\r\n\r\nfunction isValidatorError(err) {\r\n  if (err.name === \"ValidatorError\") return true;\r\n  return false;\r\n}\r\n\r\nfunction getValidatorMessage(err) {\r\n  return err.message;\r\n}\r\n\r\nfunction isCastError(err) {\r\n  if (err.name === \"CastError\") return true;\r\n  return false;\r\n}\r\n\r\nfunction getCastMessage(err) {\r\n  return `should be a ${err.kind}`;\r\n}\r\n\r\nfunction processMongooseError(err) {\r\n  if (!err) return null;\r\n  const result = {};\r\n\r\n  for (let [key, value] of Object.entries(err.errors)) {\r\n    const path = convertToLodashDotPath(key);\r\n    console.log(path);\r\n    if (isCastError(value)) set(result, path, getCastMessage(value));\r\n    else if (isValidatorError(value)) {\r\n      set(result, path, getValidatorMessage(value));\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport { processMongooseError, convertToLodashDotPath };\r\n","import React from \"react\";\r\nimport mongoose from \"mongoose\";\r\nimport styled from \"styled-components\";\r\nimport { Formik, Field } from \"formik\";\r\nimport { cloneDeep } from \"lodash\";\r\n\r\nimport { ListBuilder } from \"./AddressInput\";\r\n\r\nimport { TextField, Button } from \"@material-ui/core\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport DateFnsUtils from \"@date-io/date-fns\"; // choose your lib\r\n\r\n\r\n\r\nimport Modal from \"../../components/Modal\";\r\nimport { Card, CardContent, CardHeader } from \"@material-ui/core\";\r\n\r\n\r\n\r\nimport {\r\n  DatePicker,\r\n  TimePicker,\r\n  MuiPickersUtilsProvider,\r\n} from \"@material-ui/pickers\";\r\n\r\n\r\n\r\nimport { jobSchema } from \"api/model/job\"; //TODO change name of buildSchema\r\nimport { processMongooseError } from \"../../utilities/processMongooseError\";\r\n\r\n//es6 import was casuing a bug when building\r\n//const { processMongooseError } = require(\"../../utilities/processMongooseError\")\r\n\r\n// function useQuery() {\r\n//   const { search } = useLocation();\r\n\r\n//   return React.useMemo(() => new URLSearchParams(search), [search]);\r\n// }\r\n\r\nfunction dateTimeFromInput(date, time) {\r\n  const hours = time.getHours();\r\n  const minutes = time.getMinutes();\r\n  let res = new Date(date);\r\n  res.setHours(hours);\r\n  res.setMinutes(minutes);\r\n  return res;\r\n}\r\n\r\nconst FlexRow = styled.div`\r\n  display: flex;\r\n`;\r\n\r\nconst useStyles = makeStyles({\r\n  flexItem: {\r\n    flex: \"1 1 0\",\r\n    \"&:not(:last-child)\": {\r\n      marginRight: \"10px\",\r\n    },\r\n  },\r\n  inputRow: {\r\n    marginBottom: \"10px\",\r\n  },\r\n  textField: {\r\n    \"& textarea\": {\r\n      whiteSpace: \"pre-line\",\r\n    },\r\n  },\r\n});\r\n\r\nexport default function JobForm({ initialValues, title, handleSubmit }) {\r\n  const classes = useStyles();\r\n  // const dispatch = useDispatch();\r\n  // const history = useHistory();\r\n  // const query = useQuery();\r\n\r\n  // const { id } = useParams();\r\n\r\n  // let job = useSelector((state) =>\r\n  //   state.calendar.events.find((event) => event._id == id)\r\n  // );\r\n\r\n  // function isEditForm() {\r\n  //   console.log(id);\r\n  //   if (id) {\r\n  //     return true;\r\n  //   } else {\r\n  //     console.log(\"returning flasot\");\r\n  //     return false;\r\n  //   }\r\n  // }\r\n\r\n  // function getInitialValuesFromQuery() {\r\n  //   const date = parseISO(query.get(\"iso-date\"));\r\n  //   const start = setHours(date, query.get(\"hours\") * 1);\r\n  //   const end = setHours(date, query.get(\"hours\") + 1);\r\n  //   return {\r\n  //     start,\r\n  //     end,\r\n  //   };\r\n  // }\r\n\r\n  // //const initialValues = isEditForm() ? job : getInitialValuesFromQuery();\r\n\r\n  // const handleSubmit = (data) => {\r\n  //   dispatch(editJobThunk(data));\r\n  //   history.goBack();\r\n  // };\r\n\r\n  const validator = async (values) => {\r\n    const doc = new mongoose.Document(values, jobSchema);\r\n\r\n    const validationResult = await doc.validateSync();\r\n\r\n    const processed = processMongooseError(validationResult);\r\n\r\n    //TODO: log an error message if validation fails anything that fails that is not on form will fail silently\r\n    //got caught out already by this and took a while to find.\r\n\r\n    return processed;\r\n  };\r\n\r\n  return (\r\n    <Modal>\r\n      <Card>\r\n        <CardHeader title={title} />\r\n        <CardContent>\r\n          <Formik\r\n            initialValues={cloneDeep(initialValues || {})}\r\n            onSubmit={handleSubmit}\r\n            validate={validator}\r\n          >\r\n            {(props) => (\r\n              //<Typography variant=\"h4\">Create Job</Typography>\r\n              <form onSubmit={props.handleSubmit}>\r\n                <Field\r\n                  as={TextField}\r\n                  className={classes.inputRow}\r\n                  name=\"customer.name\"\r\n                  label=\"name\"\r\n                  error={props.errors?.customer?.name}\r\n                  helperText={props.errors?.customer?.name}\r\n                  fullWidth\r\n                />\r\n                <Field\r\n                  as={TextField}\r\n                  className={classes.inputRow}\r\n                  error={props.errors?.customer?.mobile}\r\n                  helperText={props.errors?.customer?.mobile}\r\n                  name=\"customer.mobile\"\r\n                  label=\"mobile\"\r\n                  fullWidth\r\n                />\r\n                <Field\r\n                  as={TextField}\r\n                  className={classes.inputRow}\r\n                  name=\"customer.email\"\r\n                  label=\"email\"\r\n                  error={props.errors?.customer?.email}\r\n                  helperText={props.errors?.customer?.email}\r\n                  fullWidth\r\n                />\r\n                <FlexRow className={classes.inputRow}>\r\n                  {/*utils prop sets date library to use*/}\r\n                  <MuiPickersUtilsProvider utils={DateFnsUtils}>\r\n                    {/*according to docs https://material-ui-pickers.dev/api/TimePicker\r\n                    type passed to on change is of same type as used by library passed to utils\r\n                    value must be a \"Parseable Date\" - see docs\r\n                    docs say - Pass any value to the picker, and if it won't be parsed as expected\r\n                    see: https://material-ui-pickers.dev/getting-started/parsing\r\n                    i have taken decision to pass date object which is what date-fns uses rather than a string (which seems to work)\r\n                    selector in calendar slice converts dates to objects already.\r\n                    */}\r\n                    <TimePicker\r\n                      className={classes.flexItem}\r\n                      value={new Date(props.values.start)}\r\n                      onChange={(date) => {\r\n                        props.setFieldValue(\"start\", date, true);\r\n                      }}\r\n                      label=\"start time\"\r\n                    />\r\n                  </MuiPickersUtilsProvider>\r\n                  <MuiPickersUtilsProvider utils={DateFnsUtils}>\r\n                    <TimePicker\r\n                      className={classes.flexItem}\r\n                      value={props.values.end}\r\n                      onChange={(date) => {\r\n                        props.setFieldValue(\"end\", date, true);\r\n                      }}\r\n                      label=\"end time\"\r\n                    />\r\n                  </MuiPickersUtilsProvider>\r\n                  <MuiPickersUtilsProvider utils={DateFnsUtils}>\r\n                    <DatePicker\r\n                      className={classes.flexItem}\r\n                      value={props.values.start}\r\n                      onChange={(date) => {\r\n                        props.setFieldValue(\r\n                          \"start\",\r\n                          dateTimeFromInput(date, props.values.start),\r\n                          true\r\n                        );\r\n                        props.setFieldValue(\r\n                          \"end\",\r\n                          dateTimeFromInput(date, props.values.end),\r\n                          true\r\n                        );\r\n                        console.log(\"hello\");\r\n                      }}\r\n                      label=\"date\"\r\n                    />\r\n                  </MuiPickersUtilsProvider>\r\n                </FlexRow>\r\n\r\n                <FlexRow className={classes.inputRow}>\r\n                  <Field\r\n                    className={classes.flexItem}\r\n                    as={TextField}\r\n                    name=\"charges.hourlyRate\"\r\n                    label=\"hourly rate\"\r\n                    error={props.errors?.charges?.hourlyRate}\r\n                    helperText={props.errors?.charges?.hourlyRate}\r\n                    fullWidth\r\n                  />\r\n                  <Field\r\n                    className={classes.flexItem}\r\n                    as={TextField}\r\n                    name=\"charges.fuelCharge\"\r\n                    label=\"fuelCharge\"\r\n                    error={props.errors?.charges?.fuelCharge}\r\n                    helperText={props.errors?.charges?.fuelCharge}\r\n                    fullWidth\r\n                  />\r\n                  <Field\r\n                    className={classes.flexItem}\r\n                    as={TextField}\r\n                    name=\"charges.travelTime\"\r\n                    label=\"travelTime\"\r\n                    error={props.errors?.charges?.travelTime}\r\n                    helperText={props.errors?.charges?.travelTime}\r\n                    fullWidth\r\n                  />\r\n                </FlexRow>\r\n\r\n                <Field\r\n                  as={TextField}\r\n                  className={classes.inputRow}\r\n                  name=\"items\"\r\n                  label=\"items\"\r\n                  error={props.errors?.items}\r\n                  helperText={props.errors?.items}\r\n                  fullWidth\r\n                  multiline\r\n                  rows={5}\r\n                />\r\n                <ListBuilder\r\n                  value={props.values.addresses}\r\n                  onChange={props.handleChange}\r\n                  label=\"add address\"\r\n                  name=\"addresses\"\r\n                  itemName=\"address\"\r\n                  errors={props.errors?.addresses}\r\n                />\r\n                <ListBuilder\r\n                  value={props.values.operatives}\r\n                  onChange={props.handleChange}\r\n                  label=\"add operative\"\r\n                  name=\"operatives\"\r\n                  itemName=\"operative\"\r\n                  errors={props.errors?.operatives}\r\n                />\r\n\r\n                <Button\r\n                  type=\"submit\"\r\n                  variant=\"contained\"\r\n                  color=\"primary\"\r\n                  fullWidth\r\n                >\r\n                  save\r\n                </Button>\r\n              </form>\r\n            )}\r\n          </Formik>\r\n        </CardContent>\r\n      </Card>\r\n    </Modal>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport JobForm from \"./JobForm\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useParams, useHistory } from \"react-router\";\r\nimport { editJobThunk } from \"../Calendar/calendarSlice\";\r\nimport {calendarSelectors} from \"../Calendar/calendarSlice\";\r\nimport {useEditJobMutation, useGetJobQuery} from \"../api/apiSlice\";\r\n\r\nexport default function EditJobForm() {\r\n  const { id } = useParams();\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  //let job = useSelector(calendarSelectors.eventById(id));\r\n\r\n  let {data: job,isFetching} = useGetJobQuery(id);\r\n\r\n const [editJob,{isLoading}] = useEditJobMutation()\r\n\r\n  const handleSubmit = (data) => {\r\n    editJob(data)\r\n    history.goBack();\r\n  };\r\n\r\n  if(isFetching) return null\r\n\r\n  return (\r\n    <JobForm handleSubmit={handleSubmit} initialValues={job} title=\"Edit Job\" />\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport JobForm from \"./JobForm\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { useHistory, useLocation } from \"react-router\";\r\nimport { createJobThunk } from \"../Calendar/calendarSlice\";\r\nimport { parseISO, setHours } from \"date-fns\";\r\n\r\nimport {useAddJobMutation} from \"../api/apiSlice\";\r\n\r\nfunction useQuery() {\r\n  const { search } = useLocation();\r\n\r\n  return React.useMemo(() => new URLSearchParams(search), [search]);\r\n}\r\n\r\nexport default function CreateJobForm() {\r\n  const dispatch = useDispatch();\r\n  const query = useQuery();\r\n  const history = useHistory();\r\n  function getInitialValuesFromQuery() {\r\n    const date = parseISO(query.get(\"iso-date\"));\r\n    const start = setHours(date, query.get(\"hour\") * 1);\r\n    const end = setHours(date, query.get(\"hour\") * 1 + 1);\r\n    return {\r\n      start,\r\n      end,\r\n    };\r\n  }\r\n\r\n  const [addNewJob,{isLoading}] = useAddJobMutation()\r\n\r\n\r\n\r\n  const initialValues = getInitialValuesFromQuery();\r\n\r\n  const handleSubmit = async (data) => {\r\n   /* console.log(\"sadfasdfasdfsadfsad\");\r\n    dispatch(createJobThunk(data));\r\n    history.goBack();*/\r\n    try {\r\n      await addNewJob(data).unwrap()\r\n      history.goBack()\r\n    }catch(err){\r\n      console.error('failed to save the new job')\r\n    }\r\n  };\r\n\r\n  return (\r\n    <JobForm\r\n      handleSubmit={handleSubmit}\r\n      initialValues={initialValues}\r\n      title=\"Create Joby\"\r\n    />\r\n  );\r\n}\r\n","import auth0Client from \"../features/auth/auth0\";\r\n\r\nexport async function getUser(){\r\n    const auth0 = await auth0Client;\r\n    const token = await auth0.getTokenSilently();\r\n\r\n    return fetch(`http://localhost:8000/api/v1/users`, {\r\n        headers: {\r\n            Authorization: `Bearer ${token}`,\r\n        },\r\n    })\r\n        .then((res) => {\r\n            return res\r\n        })\r\n        .catch((err) => console.error(err));\r\n}\r\n\r\nexport async function createUser(){\r\n    const auth0 = await auth0Client;\r\n    const token = await auth0.getTokenSilently();\r\n\r\n    return fetch(`http://localhost:8000/api/v1/users`, {\r\n        method: 'POST',\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify({}),\r\n    })\r\n        .then((res) => {\r\n            return res\r\n        })\r\n        .catch((err) => console.error(err));\r\n}\r\n\r\nexport async function getOrCreateUser(){\r\n    try{\r\n        const previouslyCreatedUser = await getUser()\r\n        if (previouslyCreatedUser.status ===200) return await previouslyCreatedUser.json()\r\n        const newUser = await createUser()\r\n        if(newUser.status===200) return await newUser.json()\r\n\r\n        throw new Error('these are not the status codes you are looking for')\r\n    }\r\n    catch (err){\r\n        console.error(err)\r\n    }\r\n}\r\n\r\n","import auth0Client from \"../auth/auth0\";\r\n\r\n\r\nexport async function authorize(code){\r\n    const auth0 = await auth0Client;\r\n    const token = await auth0.getTokenSilently();\r\n\r\n    return await fetch(`http://localhost:8000/api/v1/gcal/authourize?code=${code}`, {\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`,\r\n        },\r\n    })\r\n}","import { createSlice } from \"@reduxjs/toolkit\";\r\nimport {getUser} from \"../../Model/user\";\r\nimport {getOrCreateUser} from \"../../Model/user\";\r\n\r\nimport auth0Client from \"./auth0\";\r\nimport {authorize} from \"../googleCalendar/gcalApi\";\r\nimport { fetchData } from \"../Calendar/calendarSlice\";\r\n\r\nconst initialState = {\r\n  isAuthenticated: false,\r\n  isAuthorizedToGcal: false,\r\n  loading: true,\r\n  token: null\r\n};\r\n\r\nconst BASE_URL = process.env.NODE_ENV === 'dev' ? 'http://localhost:3000' : 'http://localhost:8000'\r\nconsole.log(BASE_URL)\r\n\r\nconst authSlice = createSlice({\r\n  name: \"auth\",\r\n  initialState,\r\n  reducers: {\r\n    startLoading(state,action){\r\n      state.loading = true\r\n    },\r\n    stopLoading(state,action){\r\n      state.loading = false\r\n    },\r\n    authenticationSuccess(state, action) {\r\n      state.isAuthenticated = true;\r\n      state.token = action.payload\r\n    },\r\n    authorizedToGcalSuccess(state,action){\r\n      state.isAuthorizedToGcal = true\r\n    },\r\n    logOut(state,action){\r\n      state.isAuthorizedToGcal = false\r\n      state.isAuthenticated = false\r\n      state.loading = false\r\n    }\r\n  },\r\n});\r\n\r\n//TODO: need to think about error handling for all these thunks\r\n\r\nexport const loginThunk = async (dispatch, getState) => {\r\n  const auth0 = await auth0Client;\r\n  await auth0.loginWithRedirect({\r\n    redirect_uri: `${BASE_URL}/auth`,\r\n  });\r\n  //logged in. you can get the user profile like this:\r\n}\r\n\r\nconst { actions } = authSlice;\r\n\r\nexport const onloadThunk = async (dispatch,getState) =>{\r\n  try{\r\n    dispatch(actions.startLoading())\r\n    const auth0 = await auth0Client;\r\n    const isAuthenticated = await auth0.isAuthenticated();\r\n    if (!isAuthenticated) return dispatch(actions.logOut())\r\n    const token = await auth0.getTokenSilently()\r\n    dispatch(actions.authenticationSuccess(token))\r\n    const user = await getOrCreateUser()\r\n    if(user.data.authorizedToGcal) dispatch(actions.authorizedToGcalSuccess())\r\n    dispatch(actions.stopLoading())\r\n    // dispatch(fetchData)\r\n  }catch(err){\r\n    console.error(err)\r\n  }\r\n}\r\n\r\nexport const authorizeGcalThunk = (code)=> async (dispatch,getState)=>{\r\n  try{\r\n    //TODO throw error if user hasnt been created or already authorized.\r\n    const user = await getUser()\r\n    if(!user) throw new Error('you cant authorize a user if they dont exist')\r\n    //todo getorcreate user is calling .json before returning result we should make getuser behave the same\r\n    const result = await authorize(code)\r\n    const authorizedUser = await result.json()\r\n    if(authorizedUser.data.authorizedToGcal) dispatch(actions.authorizedToGcalSuccess())\r\n  }catch(err){\r\n    console.error(err)\r\n  }\r\n  //   const authorizedUser = await authorize(code)\r\n  //   console.log(authorizedUser)\r\n  //   if(authorizedUser.data.authorizedToGcal) dispatch(actions.authorizedToGcalSuccess())\r\n  // }catch(err){\r\n  //   console.error(err)\r\n  // }\r\n}\r\n\r\nexport const handleRedirectThunk = (payload) => async (dispatch, getState) => {\r\n  const auth0 = await auth0Client;\r\n  await auth0.handleRedirectCallback();\r\n  dispatch(onloadThunk)\r\n};\r\n\r\nexport const logoutThunk = async (dispatch, getState) => {\r\n  const auth0 = await auth0Client;\r\n  await auth0.logout({\r\n    returnTo: `${BASE_URL}/`,\r\n  });\r\n};\r\n\r\nexport default authSlice.reducer;\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { handleRedirectThunk } from \"./authSlice\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nfunction useQuery() {\r\n  const { search } = useLocation();\r\n\r\n  return React.useMemo(() => new URLSearchParams(search), [search]);\r\n}\r\n\r\nexport default function Auth() {\r\n  let query = useQuery();\r\n  const dispatch = useDispatch();\r\n  const isAuthenticated = useSelector((state) => state.auth.isAuthenticated);\r\n  const history = useHistory();\r\n\r\n  React.useEffect(() => {\r\n    const code = query.get(\"code\");\r\n    const state = query.get(\"state\");\r\n    console.log(\"state your conde\", code, state);\r\n\r\n    if (code && state) {\r\n      console.log(\"fuck off\");\r\n      dispatch(handleRedirectThunk({ code, state }));\r\n    }\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (isAuthenticated) history.push(\"/calendar\");\r\n  }, [isAuthenticated]);\r\n\r\n  return <p>hello from auth</p>;\r\n}\r\n","import React from \"react\";\r\nimport {useSelector} from \"react-redux\";\r\n\r\n\r\nexport default function AuthorizeGcalButton(){\r\n    const authorized = useSelector(state=>state.auth.isAuthorizedToGcal)\r\n\r\n\r\n    function handleAuthorize(){\r\n        fetch(\"http://localhost:8000/api/v1/gcal/url\")\r\n            .then((res) => res.json())\r\n            .then((res) => {\r\n                console.log(res);\r\n                window.location.href = res.url;\r\n            });\r\n    }\r\n\r\n\r\n    \r\n\r\n\r\n\r\n    return (\r\n            authorized\r\n            ?\r\n            <p>you are authorized to Google Calendar yay!</p>\r\n            :\r\n            <button onClick={handleAuthorize}>\r\n                authorize\r\n            </button>\r\n    )\r\n}","\r\n\r\n\r\n\r\n\r\nexport default function LoginPage(){\r\n    return (\r\n        <p>this is the login page</p>\r\n    )\r\n}","import React from 'react'\r\nimport {useLocation} from \"react-router-dom\";\r\nimport {authorizeGcalThunk} from \"../auth/authSlice\";\r\nimport {useDispatch} from \"react-redux\";\r\n\r\n\r\nfunction useQuery() {\r\n    const { search } = useLocation();\r\n\r\n    return React.useMemo(() => new URLSearchParams(search), [search]);\r\n}\r\n\r\n\r\nexport default function OauthCallback(){\r\n    const query = useQuery()\r\n    const dispatch = useDispatch()\r\n\r\n    React.useEffect(()=>{\r\n        async function asyncHandler(){\r\n            const code = query.get(\"code\");\r\n            if(code){\r\n                dispatch(authorizeGcalThunk(code))\r\n            }\r\n        }\r\n        asyncHandler()\r\n    },[])\r\n\r\n    return <p>hello</p>\r\n}","import {Redirect, Route, Switch} from \"react-router-dom\";\r\nimport Error from \"../features/errors/Error\";\r\nimport ErrorHandler from \"../features/errors/ErrorHandler\";\r\nimport PrivateRoute from \"../features/auth/PrivateRoute\";\r\nimport SettingsContext from \"../features/Calendar/Contexts\";\r\nimport Calendar from \"../features/Calendar/Calendar\";\r\nimport {JobDetails} from \"../features/jobDetails/JobDetails\";\r\nimport {GcalDetails} from \"../features/Calendar/GcalDetails\";\r\nimport EditJobForm from \"../features/forms/EditJobForm\";\r\nimport CreateJobForm from \"../features/forms/CreateJobForm\";\r\nimport Auth from \"../features/auth/Auth\";\r\nimport AuthorizeGcalButton from \"../features/googleCalendar/AuthorizeGcalButton\";\r\nimport LoginPage from \"../features/auth/LoginPage\";\r\nimport OauthCallback from \"../features/googleCalendar/Oauthcallback\";\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\nimport {Toolbar} from \"@material-ui/core\";\r\n\r\nconst settingsValue = {\r\n    borderWidth: 1,\r\n    hourHeight: 60,\r\n};\r\n\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    // root: {\r\n    //   flexGrow: 1,\r\n    // },\r\n    // menuButton: {\r\n    //   marginRight: theme.spacing(2),\r\n    // },\r\n    // title: {\r\n    //   flexGrow: 1,\r\n    // },\r\n    root: {\r\n        display: 'flex',\r\n    },\r\n    appBar: {\r\n        zIndex: theme.zIndex.drawer + 1,\r\n    },\r\n    content: {\r\n        flexGrow: 1,\r\n        padding: theme.spacing(3),\r\n    },\r\n    wrapper: {display: 'flex'}\r\n}));\r\n\r\n\r\nfunction Content(){\r\n    const classes = useStyles();\r\n    return (\r\n        <Switch>\r\n            <div className={classes.content}>\r\n                <Toolbar />\r\n                <Route path=\"/error\">\r\n                    <Error />\r\n                </Route>\r\n                <ErrorHandler>\r\n                    <Switch>\r\n                        <Route path=\"/calendar\">\r\n                            <PrivateRoute>\r\n                                <SettingsContext.Provider value={settingsValue}>\r\n                                    <Calendar />\r\n                                </SettingsContext.Provider>\r\n                                <Switch>\r\n                                    <Route path=\"/calendar/job-details/:id\">\r\n                                        <JobDetails />\r\n                                    </Route>\r\n                                    <Route  path=\"/calendar/gcal-details/:id\">\r\n                                        <GcalDetails />\r\n                                    </Route>\r\n                                    <Route path=\"/calendar/edit-job-form/:id\">\r\n                                        <EditJobForm />\r\n                                    </Route>\r\n                                    <Route path=\"/calendar/create-job-form\">\r\n                                        <CreateJobForm />\r\n                                    </Route>\r\n                                </Switch>\r\n                            </PrivateRoute>\r\n                        </Route>\r\n                        <Route path='/auth'>\r\n                            <Auth />\r\n                        </Route>\r\n                        <Route path=\"/gcal\">\r\n                            <AuthorizeGcalButton />\r\n                        </Route>\r\n                        <Route path=\"/login\">\r\n                            <LoginPage />\r\n                        </Route>\r\n\r\n                        {/*auth handles call back from Auth0*/}\r\n                        <Route path=\"/oauthcallback\">\r\n                            <OauthCallback />\r\n                        </Route>\r\n                        <Route>\r\n                            <Redirect to=\"/calendar\" />\r\n                        </Route>\r\n                    </Switch>\r\n                </ErrorHandler>\r\n            </div>\r\n\r\n        </Switch>\r\n\r\n    )\r\n\r\n}\r\n\r\nexport default Content","import Button from \"@material-ui/core/Button\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { loginThunk, logoutThunk } from \"./authSlice\";\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport { styled } from '@material-ui/core/styles';\r\n\r\nconst Spinner = styled(CircularProgress)({\r\n  color: 'white'\r\n})\r\n\r\n\r\nfunction Login() {\r\n  const dispatch = useDispatch();\r\n\r\n  return <Button onClick={() => dispatch(loginThunk)} color='inherit'>Log In</Button>;\r\n}\r\n\r\nfunction Logout() {\r\n  const dispatch = useDispatch();\r\n\r\n  return (\r\n    <Button\r\n      onClick={() => {\r\n        dispatch(logoutThunk);\r\n      }}\r\n      color='inherit'\r\n    >\r\n      Log Out\r\n    </Button>\r\n  );\r\n}\r\n\r\nexport default function AuthenticationButton({color = 'inherit'}) {\r\n  const isAuthenticated = useSelector((state) => state.auth.isAuthenticated);\r\n  const isLoading = useSelector((state) =>state.auth.loading)\r\n\r\n  if(isLoading) return <Spinner/>\r\n\r\n  else if(isAuthenticated) return <Logout />\r\n\r\n  else return <Login />;\r\n}\r\n","import AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport MenuIcon from \"@material-ui/icons/Menu\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport AuthenticationButton from \"../features/auth/AuthenticationButton\";\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    title: {\r\n      flexGrow: 1,\r\n    },\r\n    root: {\r\n        display: 'flex',\r\n    },\r\n    appBar: {\r\n        zIndex: theme.zIndex.drawer + 1,\r\n    },\r\n}));\r\n\r\nfunction TopBar(){\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.root}>\r\n            <AppBar position='fixed' className={classes.appBar}>\r\n                <Toolbar>\r\n                    <Typography variant=\"h6\" className={classes.title}>\r\n                        VanCal\r\n                    </Typography>\r\n                    <AuthenticationButton />\r\n                </Toolbar>\r\n            </AppBar>\r\n        </div>\r\n\r\n    )\r\n}\r\n\r\nexport default TopBar","import \"./App.css\";\r\nimport React from 'react'\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport LeftDrawer from \"./Layout/LeftDrawer\";\r\nimport Content from './Layout/Content'\r\nimport TopBar from './Layout/TopBar'\r\nimport {\r\n  BrowserRouter as Router,\r\n} from \"react-router-dom\";\r\n\r\n//TODO will need to read through code at some point and chekc the math, not sure i am accounting for border width when looking\r\n//at height of each hour/day\r\n//also need to think about the implciations of the fact that a pixel values in css can be rounded may need to put in some code to account for\r\n//border width being set by a user to something that gets rounded\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    wrapper: {\r\n        display: 'flex',\r\n        alignItems: 'stretch',\r\n        minHeight: '100%'\r\n    },\r\n    root: {\r\n        height: '100%'\r\n    }\r\n}));\r\n\r\nfunction App() {\r\n    const classes = useStyles();\r\n  return (\r\n    <div className={classes.root}>\r\n      <Router>\r\n        <TopBar />\r\n          <div className={classes.wrapper}>\r\n              <LeftDrawer />\r\n              <Content />\r\n            </div>\r\n      </Router>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import { configureStore } from \"@reduxjs/toolkit\";\r\nimport authReducer from '../features/auth/authSlice'\r\nimport { apiSlice } from '../features/api/apiSlice'\r\nimport errorsReducer from '../features/errors/errorsSlice'\r\n\r\nimport calendarReducer from \"../features/Calendar/calendarSlice\";\r\n\r\n\r\nexport default configureStore({\r\n  reducer: {\r\n    calendar: calendarReducer,\r\n    auth: authReducer,\r\n    errors: errorsReducer,\r\n    [apiSlice.reducerPath]: apiSlice.reducer,\r\n  },\r\n  middleware: getDefaultMiddleware =>\r\n      getDefaultMiddleware().concat(apiSlice.middleware)\r\n});\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\nimport store from \"./app/store\";\r\nimport { Provider } from \"react-redux\";\r\n\r\nimport {onloadThunk} from \"./features/auth/authSlice\";\r\n\r\n\r\nstore.dispatch(onloadThunk)\r\n\r\n\r\n\r\nReactDOM.render(\r\n  //<React.StrictMode>\r\n    <Provider store={store}>\r\n      <App />\r\n    </Provider>\r\n  //</React.StrictMode>\r\n,\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}